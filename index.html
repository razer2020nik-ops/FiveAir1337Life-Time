<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>FiveAir1337Life-Time ‚Äî Life Simulator</title>
  <meta name="description" content="Life simulator: —Ä–∞–±–æ—Ç–∞, –±–∏–∑–Ω–µ—Å, –≥–æ—Ä–æ–¥, –±–∞–Ω–∫, –∫–ª–∞–Ω—ã, —Å–µ–º—å—è, –¥—É—ç–ª–∏ –∏ —Ç.–¥.">

  <style>
    :root{
      --bg:#070A10;
      --bg2:#0b0f14;
      --panel: rgba(16, 24, 35, .78);
      --panel2: rgba(13, 20, 30, .75);
      --line: rgba(54, 80, 110, .35);
      --text:#E9F1FF;
      --muted:#9DB0C7;
      --accent:#2D7CFF;
      --accent2:#7AA9FF;
      --good:#40D27A;
      --bad:#FF5C5C;
      --warn:#FFCC66;

      --r:18px;
      --r2:14px;
      --shadow: 0 18px 45px rgba(0,0,0,.45);
      --shadow2: 0 12px 28px rgba(0,0,0,.35);

      --t: 220ms;
      --e: cubic-bezier(.2,.9,.2,1);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      background:
        radial-gradient(1200px 680px at 14% 0%, rgba(45,124,255,.26), transparent 58%),
        radial-gradient(900px 520px at 88% 16%, rgba(122,169,255,.14), transparent 56%),
        radial-gradient(780px 420px at 40% 110%, rgba(64,210,122,.08), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      overflow-x:hidden;
    }

    a{color:inherit;text-decoration:none}
    .wrap{max-width:1280px;margin:0 auto;padding:16px}

    /* TOPBAR */
    .topbar{
      position:sticky;top:0;z-index:20;
      backdrop-filter: blur(14px);
      background: rgba(7,10,16,.72);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      max-width:1280px;margin:0 auto;
      padding:12px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{
      display:flex;align-items:center;gap:12px;min-width: 260px;
    }
    .logo{
      width:44px;height:44px;border-radius:16px;
      display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(45,124,255,.95), rgba(122,169,255,.55));
      color:#06101d;
      font-weight: 1000;
      letter-spacing:.4px;
      box-shadow: var(--shadow2);
      user-select:none;
      transform: translateZ(0);
    }
    .brand h1{margin:0;font-size:16px;line-height:1.2}
    .sub{
      margin-top:2px;
      color:var(--muted);
      font-size:12px;
    }

    .top-actions{
      display:flex;align-items:center;justify-content:flex-end;gap:10px;flex-wrap:wrap;
    }

    .pill{
      font-size:12px;
      border:1px solid var(--line);
      background: rgba(10,15,22,.35);
      padding:7px 10px;
      border-radius:999px;
      color:var(--muted);
      white-space:nowrap;
      display:flex;align-items:center;gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--accent2);
      box-shadow: 0 0 0 4px rgba(122,169,255,.12);
    }

    button{
      border:none;
      border-radius:14px;
      padding:11px 14px;
      font-weight: 950;
      cursor:pointer;
      transition: transform var(--t) var(--e), filter var(--t) var(--e), background var(--t) var(--e);
      letter-spacing:.1px;
    }
    .b-primary{
      background: var(--accent);
      color:#07101b;
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
    }
    .b-ghost{
      background: rgba(11,15,20,.28);
      color: var(--text);
      border: 1px solid var(--line);
    }
    .b-danger{
      background: rgba(255,92,92,.12);
      color: var(--bad);
      border: 1px solid rgba(255,92,92,.35);
    }
    .b-primary:hover,.b-ghost:hover,.b-danger:hover{
      transform: translateY(-1px);
      filter: brightness(1.04);
    }
    .b-primary:active,.b-ghost:active,.b-danger:active{
      transform: translateY(0px) scale(.99);
    }

    /* LAYOUT */
    .layout{
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 1020px){
      .layout{grid-template-columns:1fr}
      .brand{min-width:auto}
    }

    .card{
      background: linear-gradient(180deg, rgba(16,24,35,.86), rgba(12,18,28,.78));
      border: 1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:14px;
    }

    .title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .title h2{margin:0;font-size:16px}
    .muted{color:var(--muted);font-size:13px;line-height:1.55}
    .small{color:var(--muted);font-size:12px}

    .sep{height:1px;background: var(--line); margin:12px 0}

    /* KPIs */
    .kpis{display:grid;grid-template-columns:repeat(2, 1fr);gap:10px}
    .kpi{
      background: rgba(11,15,20,.25);
      border:1px solid var(--line);
      border-radius: var(--r2);
      padding:12px;
    }
    .kpi .lab{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:20px;font-weight:1000;margin-top:4px}
    .bar{
      height:10px;border-radius:999px;
      background: rgba(54,80,110,.25);
      overflow:hidden;
      margin-top:7px;
    }
    .bar > div{
      height:100%;
      width:0%;
      background: var(--accent);
      transition: width 420ms var(--e);
    }

    /* MENU */
    .menu{
      display:grid;gap:8px;
    }
    .tab{
      padding:12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(11,15,20,.20);
      color: var(--text);
      text-align:left;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      transition: transform var(--t) var(--e), background var(--t) var(--e), border-color var(--t) var(--e);
    }
    .tab small{color:var(--muted);font-weight:700}
    .tab:hover{transform: translateY(-1px); border-color: rgba(45,124,255,.55)}
    .tab.active{
      background: rgba(45,124,255,.12);
      border-color: rgba(45,124,255,.70);
    }

    /* MAIN */
    .main-grid{
      display:grid;grid-template-columns: 1.15fr .85fr;
      gap:14px;
    }
    @media (max-width: 1020px){
      .main-grid{grid-template-columns:1fr}
    }

    /* ACTIONS */
    .actions{display:grid;gap:10px}
    .action{
      background: rgba(11,15,20,.18);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      transition: transform var(--t) var(--e), border-color var(--t) var(--e);
    }
    .action:hover{transform: translateY(-1px); border-color: rgba(122,169,255,.40)}
    .action .row{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .action b{display:block;margin-bottom:4px}
    .badge{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      background: rgba(15,22,32,.25);
      padding:5px 9px;
      border-radius:999px;
      white-space:nowrap;
    }
    .good{color:var(--good);font-weight:1000}
    .bad{color:var(--bad);font-weight:1000}
    .warn{color:var(--warn);font-weight:1000}

    input, select{
      width:100%;
      background: rgba(11,15,20,.28);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      color: var(--text);
      outline:none;
      transition: border-color var(--t) var(--e);
    }
    input:focus,select:focus{border-color: rgba(45,124,255,.65)}
    .row2{display:flex;gap:10px;flex-wrap:wrap}
    .row2>*{flex:1 1 160px}

    /* LOG */
    .log{
      margin:0;padding:0;list-style:none;
      display:grid;gap:8px;
      max-height: 420px;
      overflow:auto;
      padding-right:4px;
    }
    .log li{
      background: rgba(11,15,20,.16);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      font-size:13px;
      animation: pop 260ms var(--e) both;
    }
    @keyframes pop{from{transform:translateY(6px);opacity:.0}to{transform:translateY(0);opacity:1}}

    /* Lists */
    .list{margin:0;padding:0;list-style:none;display:grid;gap:10px}
    .list li{
      background: rgba(11,15,20,.14);
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }

    /* Screen transition */
    .screen{
      position:relative;
      min-height: 540px;
    }
    .screen-inner{
      animation: fadeIn 260ms var(--e) both;
    }
    @keyframes fadeIn{
      from{opacity:.0; transform: translateY(8px)}
      to{opacity:1; transform: translateY(0)}
    }

    /* MODAL */
    .modal-backdrop{
      position:fixed;inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;justify-content:center;
      padding:16px;
      z-index: 100;
    }
    .modal-backdrop.open{display:flex;animation: fade 160ms var(--e) both}
    @keyframes fade{from{opacity:0}to{opacity:1}}
    .modal{
      width:min(620px, 100%);
      background: linear-gradient(180deg, rgba(16,24,35,.95), rgba(11,15,20,.92));
      border:1px solid rgba(122,169,255,.25);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding:14px;
      transform: translateZ(0);
    }
    .modal h3{margin:0 0 6px}
    .modal .muted{margin:0 0 10px}
    .modal .actions{margin-top:10px}
    .modal .close{
      float:right;
      background: rgba(11,15,20,.28);
      border:1px solid var(--line);
      color: var(--text);
      border-radius: 12px;
      padding:9px 12px;
      box-shadow:none;
    }

    /* TOASTS */
    .toasts{
      position:fixed;
      right:16px;
      bottom:16px;
      display:grid;
      gap:10px;
      z-index: 200;
    }
    .toast{
      width:min(380px, calc(100vw - 32px));
      background: rgba(16,24,35,.92);
      border:1px solid rgba(122,169,255,.20);
      border-radius: 16px;
      padding:12px 12px;
      box-shadow: var(--shadow2);
      animation: toastIn 260ms var(--e) both;
      font-size:13px;
    }
    @keyframes toastIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .toast .t{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .toast .x{
      background: transparent;
      border: none;
      color: var(--muted);
      cursor:pointer;
      font-weight:900;
    }

    footer{padding:18px 0 28px;color:var(--muted);text-align:center;font-size:12px}
    .mono{font-family:var(--mono)}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">5A</div>
        <div>
          <h1>FiveAir1337Life-Time</h1>
          <div class="sub">–≥–æ—Ä–æ–¥ ‚Ä¢ 100 —Ä–∞–±–æ—Ç ‚Ä¢ –±–∞–Ω–∫ ‚Ä¢ –∫–ª–∞–Ω—ã ‚Ä¢ —Å–µ–º—å—è ‚Ä¢ –¥—É—ç–ª–∏ ‚Ä¢ –æ–≥—Ä–∞–±–ª–µ–Ω–∏—è</div>
        </div>
      </div>

      <div class="top-actions">
        <div class="pill"><span class="dot"></span><span id="dayPill">–î–µ–Ω—å 1</span></div>
        <div class="pill">–ù–µ–¥–µ–ª—è: <b id="weekPill">1</b></div>
        <div class="pill">–†–∞–Ω–≥: <b id="rankPill">–ù–æ–≤–∏—á–æ–∫</b></div>
        <button class="b-primary" id="nextDayBtn">üìÖ –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å</button>
        <button class="b-ghost" id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        <button class="b-danger" id="resetBtn">‚ôªÔ∏è –°–±—Ä–æ—Å</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="layout">
      <!-- LEFT -->
      <aside class="card">
        <div class="title">
          <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
          <span class="badge" id="actionsLeft">–•–æ–¥—ã: 3/3</span>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="lab">üí∞ –ù–∞–ª–∏—á–Ω—ã–µ</div>
            <div class="val" id="money">0 ‚ÇΩ</div>
            <div class="small">–ø–æ–∫—É–ø–∫–∏/—Ä–∞–±–æ—Ç–∞</div>
          </div>
          <div class="kpi">
            <div class="lab">üè¶ –ë–∞–Ω–∫</div>
            <div class="val" id="bank">0 ‚ÇΩ</div>
            <div class="small">–¥–µ–ø–æ–∑–∏—Ç</div>
          </div>

          <div class="kpi">
            <div class="lab">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
            <div class="val" id="energy">100</div>
            <div class="bar"><div id="energyBar"></div></div>
          </div>
          <div class="kpi">
            <div class="lab">‚≠ê –£—Ä–æ–≤–µ–Ω—å</div>
            <div class="val"><span id="lvl">1</span> <span class="small mono">XP</span></div>
            <div class="bar"><div id="xpBar"></div></div>
            <div class="small"><span id="xpText">0/100</span></div>
          </div>

          <div class="kpi">
            <div class="lab">üß† –ù–∞–≤—ã–∫</div>
            <div class="val" id="skill">1</div>
            <div class="small">–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—ã</div>
          </div>
          <div class="kpi">
            <div class="lab">üí≥ –î–æ–ª–≥</div>
            <div class="val" id="debt">0 ‚ÇΩ</div>
            <div class="small">–ø—Ä–æ—Ü–µ–Ω—Ç—ã/–¥–µ–Ω—å</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üó∫Ô∏è –ì–æ—Ä–æ–¥</h2>
          <span class="badge" id="netWorth">–ö–∞–ø–∏—Ç–∞–ª: 0 ‚ÇΩ</span>
        </div>

        <div class="menu" id="tabs">
          <button class="tab active" data-tab="home">üè† –î–æ–º <small id="homeSmall">–∞—Ä–µ–Ω–¥–∞</small></button>
          <button class="tab" data-tab="jobs">üíº –†–∞–±–æ—Ç—ã <small id="jobsSmall">100</small></button>
          <button class="tab" data-tab="study">üìë –û–±—É—á–µ–Ω–∏–µ <small>–Ω–∞–≤—ã–∫</small></button>
          <button class="tab" data-tab="biz">üöÄ –ë–∏–∑–Ω–µ—Å <small>–ø–∞—Å—Å–∏–≤</small></button>
          <button class="tab" data-tab="bank">üè¶ –ë–∞–Ω–∫ <small>–∫—Ä–µ–¥–∏—Ç—ã</small></button>
          <button class="tab" data-tab="shop">üè¨ –ú–∞–≥–∞–∑–∏–Ω <small>–µ–¥–∞/—Ç–µ—Ö</small></button>
          <button class="tab" data-tab="realty">üè¢ –ñ–∏–ª—å—ë <small>–∞—Ä–µ–Ω–¥–∞</small></button>
          <button class="tab" data-tab="crypto">üñ•üí∂ –ö—Ä–∏–ø—Ç–∞ <small>—Ä—ã–Ω–æ–∫</small></button>
          <button class="tab" data-tab="arena">ü§∫ –î—É—ç–ª—å <small>—Ä–∏—Å–∫</small></button>
          <button class="tab" data-tab="heist">ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ <small>–æ—á. —Ä–∏—Å–∫</small></button>
          <button class="tab" data-tab="family">üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è <small>–ó–ê–ì–°</small></button>
          <button class="tab" data-tab="clan">üõ° –ö–ª–∞–Ω <small>—Å–∫–ª–∞–¥</small></button>
          <button class="tab" data-tab="tops">Forbes üòéüíµ <small>—Ç–æ–ø—ã</small></button>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
          <span class="badge" id="invBadge">‚Äî</span>
        </div>
        <ul class="list" id="inventoryList"></ul>

        <div class="sep"></div>

        <div class="title">
          <h2>üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          <span class="badge" id="achvBadge">0/0</span>
        </div>
        <ul class="list" id="achievements"></ul>
      </aside>

      <!-- RIGHT -->
      <main class="main-grid">
        <section class="card screen">
          <div class="screen-inner" id="screenRoot">
            <div class="title">
              <h2 id="screenTitle">üè† –î–æ–º</h2>
              <span class="badge" id="screenHint">–≤—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ</span>
            </div>
            <div class="muted" id="screenDesc"></div>
            <div class="sep"></div>
            <div class="actions" id="screenActions"></div>
          </div>
        </section>

        <section class="card">
          <div class="title">
            <h2>üì∞ –°–æ–±—ã—Ç–∏—è</h2>
            <span class="badge" id="economyHint">‚Äî</span>
          </div>
          <ul class="log" id="log"></ul>
          <div class="sep"></div>
          <div class="small">üíæ –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. (–ê –µ—â—ë –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.)</div>
        </section>
      </main>
    </div>

    <footer>¬© FiveAir1337Life-Time ‚Ä¢ Life Simulator</footer>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <button class="close" id="modalClose">‚úï</button>
      <h3 id="modalTitle">‚Äî</h3>
      <p class="muted" id="modalText">‚Äî</p>
      <div class="actions" id="modalActions"></div>
    </div>
  </div>

  <!-- TOASTS -->
  <div class="toasts" id="toasts"></div>

<script>
/* =========================
   FiveAir1337Life-Time v3
   - Smooth UI + 100 jobs
   - Unlock by level/skill
   - Duel / Heist / Clan / Family
   ========================= */

const KEY = "fa_lifetime_v3";
const $ = (id)=>document.getElementById(id);

const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const rub=(n)=>Number(n||0).toLocaleString("ru-RU")+" ‚ÇΩ";
const now=()=>Date.now();

function toast(msg, type="info"){
  const box = $("toasts");
  const t = document.createElement("div");
  t.className="toast";
  t.innerHTML = `
    <div class="t">
      <div>${type==="good"?"‚úÖ":type==="bad"?"‚ö†Ô∏è":type==="warn"?"üí≥":"‚Ä¢"} ${escapeHtml(msg)}</div>
      <button class="x">‚úï</button>
    </div>
  `;
  t.querySelector(".x").onclick=()=>t.remove();
  box.appendChild(t);
  setTimeout(()=>{ if(t.isConnected) t.remove(); }, 4200);
}

function openModal(title, text, buttons=[]){
  $("modalTitle").textContent = title;
  $("modalText").textContent = text;
  const a = $("modalActions");
  a.innerHTML="";
  buttons.forEach(b=>{
    const btn = document.createElement("button");
    btn.className = b.kind==="danger" ? "b-danger"
                 : b.kind==="ghost"  ? "b-ghost"
                 : "b-primary";
    btn.textContent = b.text;
    btn.onclick = ()=>{ closeModal(); b.onClick && b.onClick(); };
    a.appendChild(btn);
  });
  $("modalBackdrop").classList.add("open");
}
function closeModal(){ $("modalBackdrop").classList.remove("open"); }
$("modalClose").onclick=closeModal;
$("modalBackdrop").addEventListener("click",(e)=>{ if(e.target.id==="modalBackdrop") closeModal(); });

/* ---------- DATA: 100 jobs ---------- */
function buildJobs(){
  // 10 —Ç–∏—Ä–æ–≤ * 10 —Ä–∞–±–æ—Ç = 100
  const tiers = [
    {tier:1,  needLvl:1,  needSkill:1,  title:"–°—Ç–∞—Ä—Ç"},
    {tier:2,  needLvl:2,  needSkill:2,  title:"–ü—Ä–æ—Å—Ç–æ–π"},
    {tier:3,  needLvl:3,  needSkill:3,  title:"–û–ø—ã—Ç"},
    {tier:4,  needLvl:4,  needSkill:4,  title:"–£–≤–µ—Ä–µ–Ω–Ω—ã–π"},
    {tier:5,  needLvl:6,  needSkill:5,  title:"–ü—Ä–æ—Ñ–∏"},
    {tier:6,  needLvl:8,  needSkill:6,  title:"–°–∏–ª—å–Ω—ã–π"},
    {tier:7,  needLvl:10, needSkill:7,  title:"–≠–∫—Å–ø–µ—Ä—Ç"},
    {tier:8,  needLvl:12, needSkill:8,  title:"–¢–æ–ø"},
    {tier:9,  needLvl:14, needSkill:9,  title:"–≠–ª–∏—Ç–∞"},
    {tier:10, needLvl:16, needSkill:10, title:"–õ–µ–≥–µ–Ω–¥–∞"},
  ];

  const templates = [
    ["–ö—É—Ä—å–µ—Ä", "–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞"],
    ["–û–ø–µ—Ä–∞—Ç–æ—Ä", "–æ—Ñ–∏—Å"],
    ["–ü–æ–º–æ—â–Ω–∏–∫", "—Å–µ—Ä–≤–∏—Å"],
    ["–ú–µ–Ω–µ–¥–∂–µ—Ä", "–ø—Ä–æ–¥–∞–∂–∏"],
    ["–ú–æ–Ω—Ç–∞–∂—ë—Ä", "–∫–æ–Ω—Ç–µ–Ω—Ç"],
    ["–î–∏–∑–∞–π–Ω–µ—Ä", "–∫—Ä–µ–∞—Ç–∏–≤"],
    ["–í–µ—Ä—Å—Ç–∞–ª—å—â–∏–∫", "web"],
    ["–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", "–∫–æ–¥"],
    ["–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥", "—Ç—Ä–∞—Ñ–∏–∫"],
    ["–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", "—Ä—ã–Ω–æ–∫"],
  ];

  const jobs = [];
  for(const t of tiers){
    for(let i=0;i<10;i++){
      const [role, tag] = templates[i];
      const basePay = Math.floor(120 + t.tier*85 + i*18);
      const energy = clamp(18 + t.tier*3 + Math.floor(i/2), 18, 55);
      const risk = (i>=7 ? 0.22 : i>=4 ? 0.12 : 0.05) + t.tier*0.01; // —Ä–∏—Å–∫ "–ø—Ä–æ–≤–∞–ª–∞"
      const xp = Math.floor(18 + t.tier*7 + i*2);
      jobs.push({
        id: `T${t.tier}-${i}`,
        tier: t.tier,
        name: `${role} ‚Ä¢ ${t.title} #${i+1}`,
        tag,
        needLvl: t.needLvl,
        needSkill: t.needSkill,
        basePay,
        energy,
        risk: clamp(risk, 0.03, 0.35),
        xp
      });
    }
  }
  return jobs;
}
const JOBS = buildJobs();

/* ---------- Achievements ---------- */
const ACH = [
  {id:"a1",  name:"üíº –ü–µ—Ä–≤–∞—è —Ä–∞–±–æ—Ç–∞", desc:"–í—ã–ø–æ–ª–Ω–∏ 1 —Ä–∞–±–æ—Ç—É", ok:S=>S.stats.jobsDone>=1},
  {id:"a2",  name:"‚≠ê –£—Ä–æ–≤–µ–Ω—å 5",     desc:"–î–æ—Å—Ç–∏–≥–Ω–∏ —É—Ä–æ–≤–Ω—è 5", ok:S=>S.lvl>=5},
  {id:"a3",  name:"üß† –ù–∞–≤—ã–∫ 5",       desc:"–ù–∞–≤—ã–∫ 5+", ok:S=>S.skill>=5},
  {id:"a4",  name:"üè¶ –î–µ–ø–æ–∑–∏—Ç",       desc:"–ü–æ–ª–æ–∂–∏ 5 000 ‚ÇΩ –≤ –±–∞–Ω–∫", ok:S=>S.bank>=5000},
  {id:"a5",  name:"üè¢ –ñ–∏–ª—å—ë —É–ª—É—á—à–µ–Ω–æ",desc:"–ö–æ–º–Ω–∞—Ç–∞ –∏–ª–∏ –≤—ã—à–µ", ok:S=>S.homeLevel>=1},
  {id:"a6",  name:"üöÄ –ë–∏–∑–Ω–µ—Å 3",      desc:"–ë–∏–∑–Ω–µ—Å 3+", ok:S=>S.biz>=3},
  {id:"a7",  name:"üñ•üí∂ –ö—Ä–∏–ø—Ç–∞",       desc:"–ö—É–ø–∏ –∫—Ä–∏–ø—Ç—É", ok:S=>S.crypto.coins>0},
  {id:"a8",  name:"ü§∫ –ü–æ–±–µ–¥–∞",        desc:"–í—ã–∏–≥—Ä–∞–π –¥—É—ç–ª—å", ok:S=>S.stats.duelsWin>=1},
  {id:"a9",  name:"ü™ì –†–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–π",   desc:"–£—Å–ø–µ—à–Ω–æ–µ –æ–≥—Ä–∞–±–ª–µ–Ω–∏–µ", ok:S=>S.stats.heistsWin>=1},
  {id:"a10", name:"üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è",     desc:"–°–æ–∑–¥–∞–π —Å–µ–º—å—é (–ø–∞—Ä—Ç–Ω—ë—Ä)", ok:S=>S.family.partner},
  {id:"a11", name:"üë´ –ó–ê–ì–°",          desc:"–ñ–µ–Ω–∏—Å—å/–≤—ã–π–¥–∏ –∑–∞–º—É–∂", ok:S=>S.family.married},
  {id:"a12", name:"üõ° –ö–ª–∞–Ω",          desc:"–í—Å—Ç—É–ø–∏ –≤ –∫–ª–∞–Ω", ok:S=>!!S.clan.name},
  {id:"a13", name:"üòéüíµ Forbes",      desc:"–ö–∞–ø–∏—Ç–∞–ª 200 000 ‚ÇΩ+", ok:S=>netWorth(S)>=200000},
];

/* ---------- State ---------- */
function defaultState(){
  return {
    day: 1,
    actionsLeft: 3,
    money: 800,
    bank: 0,
    debt: 0,
    energy: 100,

    lvl: 1,
    xp: 0,
    xpNeed: 100,

    skill: 1,
    biz: 0,

    homeLevel: 0, // 0 –∞—Ä–µ–Ω–¥–∞, 1 –∫–æ–º–Ω–∞—Ç–∞, 2 –∫–≤–∞—Ä—Ç–∏—Ä–∞, 3 –¥–æ–º
    rentDueIn: 7,

    wanted: 0, // —É—Ä–æ–≤–µ–Ω—å "—Ä–æ–∑—ã—Å–∫–∞" (–∏–≥—Ä–æ–≤–æ–µ)
    safe: 0,   // –∫–æ–ø–∏–ª–∫–∞

    inv: { food: 0, tech: 0, gear: 0, car: 0 },

    crypto: { price: 120, coins: 0 },

    family: { partner:false, married:false, kids:0 },

    clan: { name:"", level:0, storage:0 }, // storage - –¥–µ–Ω—å–≥–∏ –≤ "—Å–∫–ª–∞–¥–µ"
    stats: {
      jobsDone:0,
      duelsWin:0, duelsLose:0,
      heistsWin:0, heistsLose:0
    },

    tops: { bestNW:0, bestDon:0, bestCrypto:0, donations:0 },

    log: [
      {t:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –ò–¥–∏ –≤–æ –≤–∫–ª–∞–¥–∫—É ¬´–†–∞–±–æ—Ç—ã¬ª ‚Äî —Ç–∞–º 100 —Ä–∞–±–æ—Ç. –ß–µ–º –≤—ã—à–µ —É—Ä–æ–≤–µ–Ω—å ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –¥–æ—Å—Ç—É–ø–Ω–æ.", type:"info"}
    ]
  };
}

function load(){
  try{
    const v = localStorage.getItem(KEY);
    return v ? JSON.parse(v) : defaultState();
  }catch(e){
    return defaultState();
  }
}
function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }

let S = load();
let currentTab = "home";

/* ---------- Helpers (economy / rank / net worth) ---------- */
function week(){ return Math.floor((S.day-1)/7)+1; }

function netWorth(state=S){
  const cryptoVal = Math.floor(state.crypto.coins * state.crypto.price);
  const carVal = state.inv.car * 12000;
  const techVal = state.inv.tech * 2500;
  const homeVal = [0, 8000, 25000, 65000][state.homeLevel] || 0;
  const clanVal = state.clan.storage || 0;
  return Math.max(0, (state.money + state.bank + state.safe + cryptoVal + carVal + techVal + homeVal + clanVal) - state.debt);
}

const RANKS = [
  {name:"–ù–æ–≤–∏—á–æ–∫", nw:0},
  {name:"–†–∞–±–æ—Ç—è–≥–∞", nw:6000},
  {name:"–î–µ–ª–µ—Ü", nw:20000},
  {name:"–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", nw:55000},
  {name:"–ë–∏–∑–Ω–µ—Å–º–µ–Ω", nw:120000},
  {name:"Forbes üòéüíµ", nw:200000},
];
function rankName(){
  const nw = netWorth();
  let r = RANKS[0].name;
  for(const x of RANKS){ if(nw >= x.nw) r = x.name; }
  return r;
}

function weeklyCosts(){
  // —Ä–∞—Å—Ö–æ–¥—ã —Ä–∞—Å—Ç—É—Ç —Å –∂–∏–ª—å–µ–º –∏ —Å–µ–º—å—ë–π
  const base = 650 + (S.skill-1)*140;
  const homeMul = [1.0, 1.25, 1.55, 2.1][S.homeLevel] || 1.0;
  const fam = (S.family.partner ? 1.2 : 1.0) * (S.family.married ? 1.1 : 1.0) * (1 + S.family.kids*0.15);
  return Math.floor(base * homeMul * fam);
}
function passiveIncome(){
  // –±–∏–∑–Ω–µ—Å + —Ç–µ—Ö–Ω–∏–∫–∞/–∞–≤—Ç–æ –±–æ–Ω—É—Å
  const techB = Math.min(0.30, S.inv.tech * 0.03);
  const carB  = Math.min(0.25, S.inv.car * 0.05);
  const eff = 1 + techB + carB;
  return Math.floor((S.biz * (420 + S.skill*55)) * eff);
}
function dailyDebtInterest(){
  if(S.debt<=0) return 0;
  // —á–µ–º –≤—ã—à–µ —Ä–æ–∑—ã—Å–∫ ‚Äî —Ç–µ–º —Ö—É–∂–µ —É—Å–ª–æ–≤–∏—è
  const k = 0.03 + Math.min(0.02, S.wanted*0.002);
  return Math.floor(S.debt * k);
}

/* ---------- XP / Leveling ---------- */
function addXP(x){
  S.xp += x;
  while(S.xp >= S.xpNeed){
    S.xp -= S.xpNeed;
    S.lvl += 1;
    S.xpNeed = Math.floor(100 + (S.lvl-1)*35);
    // –Ω–µ–±–æ–ª—å—à–æ–π —Ä–æ—Å—Ç —ç–Ω–µ—Ä–≥–∏–∏ "–≤ –ø–æ—Ç–æ–ª–æ–∫" –Ω–µ –¥–µ–ª–∞–µ–º, –Ω–æ –¥–∞—ë–º –±–æ–Ω—É—Å –¥–µ–Ω—å–≥–∞–º–∏
    const bonus = 250 + S.lvl*25;
    S.money += bonus;
    addLog(`–õ–ï–í–ï–õ –ê–ü! ‚≠ê –£—Ä–æ–≤–µ–Ω—å ${S.lvl}. –ë–æ–Ω—É—Å: +${rub(bonus)}`, "good");
    toast(`–£—Ä–æ–≤–µ–Ω—å ${S.lvl} –æ—Ç–∫—Ä—ã—Ç!`, "good");
  }
}

/* ---------- Logs ---------- */
function addLog(text, type="info"){
  S.log.unshift({t:text, type});
  if(S.log.length>80) S.log.pop();
  save();
  render();
}
function useAction(energyCost){
  if(S.actionsLeft<=0){ addLog("–•–æ–¥–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç. –ñ–º–∏ ¬´–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å¬ª.","bad"); return false; }
  if(S.energy<energyCost){ addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏. –ö—É–ø–∏ –µ–¥—É –∏–ª–∏ –æ—Ç–¥—ã—Ö–∞–π.","bad"); return false; }
  S.actionsLeft -= 1;
  S.energy = clamp(S.energy - energyCost, 0, 100);
  return true;
}

/* ---------- Crypto ---------- */
function nextCryptoPrice(){
  const change = (Math.random()*0.22 - 0.10); // -10..+12%
  S.crypto.price = Math.max(20, Math.floor(S.crypto.price*(1+change)));
}

/* ---------- Screen rendering ---------- */
function setTab(tab){
  currentTab = tab;
  document.querySelectorAll(".tab").forEach(b=>{
    b.classList.toggle("active", b.getAttribute("data-tab")===tab);
  });
  // –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  const root = $("screenRoot");
  root.classList.remove("screen-inner");
  void root.offsetWidth; // restart anim
  root.classList.add("screen-inner");
  renderScreen();
}

function actionCard({title, text, cost, btnText, onClick, extraHTML="", disabled=false}){
  const w = document.createElement("div");
  w.className="action";
  w.innerHTML = `
    <div class="row">
      <div style="min-width:0">
        <b>${title}</b>
        <div class="muted">${text}</div>
        <div class="small" style="margin-top:6px">${cost}</div>
        ${extraHTML ? `<div style="margin-top:10px">${extraHTML}</div>` : ""}
      </div>
      <button class="${disabled ? "b-ghost" : "b-primary"}" ${disabled?"disabled":""} style="${disabled?"opacity:.55;cursor:not-allowed":""}">
        ${btnText}
      </button>
    </div>
  `;
  const btn = w.querySelector("button");
  if(!disabled) btn.onclick = onClick;
  return w;
}

function screenTemplate(title, desc, hint, actions){
  $("screenTitle").textContent = title;
  $("screenDesc").innerHTML = desc;
  $("screenHint").textContent = hint;
  const box = $("screenActions");
  box.innerHTML="";
  actions.forEach(a=>box.appendChild(a));
}

/* ---------- Screens: Home / Jobs / Study / Biz / Bank / Shop / Realty / Crypto / Duel / Heist / Family / Clan / Tops ---------- */
function renderScreen(){
  const actions=[];
  const nw = netWorth();
  const wkCost = weeklyCosts();
  const pass = passiveIncome();
  const debtInt = dailyDebtInterest();

  if(currentTab==="home"){
    const homeName = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"][S.homeLevel] || "–ê—Ä–µ–Ω–¥–∞";
    actions.push(actionCard({
      title:"üçé –°—ä–µ—Å—Ç—å –µ–¥—É",
      text:"–ï–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é. –ù—É–∂–Ω–∞, —á—Ç–æ–±—ã –¥–µ–ª–∞—Ç—å –±–æ–ª—å—à–µ –¥–µ–π—Å—Ç–≤–∏–π.",
      cost:"–•–æ–¥: -1 ‚Ä¢ –¢—Ä–µ–±—É–µ—Ç: 1√ó–ï–¥–∞ ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +30",
      btnText:"–°—ä–µ—Å—Ç—å",
      disabled: S.inv.food<=0,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤.","bad");
        if(S.inv.food<=0) return addLog("–ï–¥—ã –Ω–µ—Ç. –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ üè¨","bad");
        S.actionsLeft-=1;
        S.inv.food-=1;
        S.energy = clamp(S.energy+30, 0, 100);
        addLog("–¢—ã –ø–æ–µ–ª üçé –≠–Ω–µ—Ä–≥–∏—è +30.", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üõå –û—Ç–¥—ã—Ö",
      text:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã (–±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ).",
      cost:"–•–æ–¥: -1 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +45",
      btnText:"–û—Ç–¥—ã—Ö–∞—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤.","bad");
        S.actionsLeft-=1;
        S.energy=clamp(S.energy+45,0,100);
        addLog("–û—Ç–¥—ã—Ö üõå –≠–Ω–µ—Ä–≥–∏—è +45.", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üí∏ –ü–µ—Ä–µ–≤–æ–¥ –≤ –∫–æ–ø–∏–ª–∫—É",
      text:"–ü–µ—Ä–µ–≤–æ–¥–∏ –¥–µ–Ω—å–≥–∏ –≤ –∫–æ–ø–∏–ª–∫—É (—á–∏—Å—Ç–æ –∏–≥—Ä–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è).",
      cost:`–ù–∞–ª–∏—á–Ω—ã–µ ‚Üí –ö–æ–ø–∏–ª–∫–∞ ‚Ä¢ –°–µ–π—á–∞—Å –∫–æ–ø–∏–ª–∫–∞: <span class="mono">${rub(S.safe)}</span>`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>{
        openModal("–ü–µ—Ä–µ–≤–æ–¥ üí∏", "–í–≤–µ–¥–∏ —Å—É–º–º—É –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –∫–æ–ø–∏–ª–∫—É:", [
          {text:"+500", kind:"primary", onClick:()=>doSafe(500)},
          {text:"+1000", kind:"primary", onClick:()=>doSafe(1000)},
          {text:"–°–Ω—è—Ç—å 500", kind:"ghost", onClick:()=>doSafe(-500)},
        ]);
      }
    }));

    function doSafe(v){
      if(v>0){
        if(S.money < v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
        S.money -= v; S.safe += v;
        addLog(`–ü–µ—Ä–µ–≤–æ–¥ üí∏ +${rub(v)} –≤ –∫–æ–ø–∏–ª–∫—É.`, "good");
      } else {
        const x = Math.abs(v);
        if(S.safe < x) return toast("–í –∫–æ–ø–∏–ª–∫–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "bad");
        S.safe -= x; S.money += x;
        addLog(`–°–Ω—è—Ç–∏–µ üí∏ -${rub(x)} –∏–∑ –∫–æ–ø–∏–ª–∫–∏.`, "good");
      }
      save(); render();
    }

    screenTemplate(
      "üè† –î–æ–º",
      `–ö–∞–ø–∏—Ç–∞–ª: <b class="good">${rub(nw)}</b> ‚Ä¢ –†–∞—Å—Ö–æ–¥/–Ω–µ–¥: <b class="bad">${rub(wkCost)}</b> ‚Ä¢ –ü–∞—Å—Å–∏–≤/–Ω–µ–¥: <b class="good">${rub(pass)}</b> ‚Ä¢ % –ø–æ –¥–æ–ª–≥—É/–¥–µ–Ω—å: <b class="warn">${rub(debtInt)}</b>`,
      `${homeName} ‚Ä¢ –†–æ–∑—ã—Å–∫: ${S.wanted}`,
      actions
    );
    return;
  }

  if(currentTab==="jobs"){
    // —Ñ–∏–ª—å—Ç—Ä/–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const unlocked = JOBS.filter(j => S.lvl>=j.needLvl && S.skill>=j.needSkill);
    const locked = JOBS.length - unlocked.length;

    const top = document.createElement("div");
    top.className="action";
    top.innerHTML = `
      <div class="row">
        <div>
          <b>üíº –¶–µ–Ω—Ç—Ä –∑–∞–Ω—è—Ç–æ—Å—Ç–∏</b>
          <div class="muted">–î–æ—Å—Ç—É–ø–Ω–æ —Ä–∞–±–æ—Ç: <b class="good">${unlocked.length}</b> / ${JOBS.length} ‚Ä¢ –ó–∞–∫—Ä—ã—Ç–æ: <b class="bad">${locked}</b></div>
          <div class="small">–ß–µ–º –≤—ã—à–µ ‚≠ê —É—Ä–æ–≤–µ–Ω—å –∏ üß† –Ω–∞–≤—ã–∫ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç –æ—Ç–∫—Ä—ã—Ç–æ.</div>
          <div style="margin-top:10px" class="row2">
            <select id="jobTier">
              <option value="all">–í—Å–µ —Ç–∏—Ä—ã</option>
              ${[1,2,3,4,5,6,7,8,9,10].map(t=>`<option value="${t}">–¢–∏—Ä ${t}</option>`).join("")}
            </select>
            <select id="jobSort">
              <option value="pay">–°–æ—Ä—Ç: –¥–æ—Ö–æ–¥</option>
              <option value="risk">–°–æ—Ä—Ç: —Ä–∏—Å–∫</option>
              <option value="energy">–°–æ—Ä—Ç: —ç–Ω–µ—Ä–≥–∏—è</option>
            </select>
          </div>
        </div>
        <button class="b-primary" id="jobHelpBtn">?</button>
      </div>
    `;
    actions.push(top);

    setTimeout(()=>{
      const help = document.getElementById("jobHelpBtn");
      if(help){
        help.onclick=()=>{
          openModal("–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —Ä–∞–±–æ—Ç—ã üíº",
            "–í—ã–±–∏—Ä–∞–π —Ä–∞–±–æ—Ç—É ‚Üí —Ç—Ä–∞—Ç–∏—à—å —ç–Ω–µ—Ä–≥–∏—é ‚Üí –ø–æ–ª—É—á–∞–µ—à—å –¥–µ–Ω—å–≥–∏ –∏ XP. –ß–µ–º –≤—ã—à–µ —É—Ä–æ–≤–µ–Ω—å/–Ω–∞–≤—ã–∫, —Ç–µ–º –ª—É—á—à–µ —Ä–∞–±–æ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã.",
            [{text:"–ü–æ–Ω—è–ª", kind:"primary", onClick:()=>{}}]
          );
        };
      }
    },0);

    const list = document.createElement("div");
    list.className="actions";
    list.id="jobsListHost";
    actions.push(list);

    function renderJobsList(){
      const tier = (document.getElementById("jobTier")?.value || "all");
      const sort = (document.getElementById("jobSort")?.value || "pay");

      let items = JOBS.slice();
      if(tier!=="all") items = items.filter(j=>String(j.tier)===tier);

      items.sort((a,b)=>{
        if(sort==="pay") return (b.basePay - a.basePay);
        if(sort==="risk") return (a.risk - b.risk);
        if(sort==="energy") return (a.energy - b.energy);
        return 0;
      });

      const host = document.getElementById("jobsListHost");
      if(!host) return;
      host.innerHTML="";

      items.forEach(j=>{
        const ok = (S.lvl>=j.needLvl && S.skill>=j.needSkill);
        const pay = Math.floor(j.basePay * (1 + Math.min(0.30, S.inv.tech*0.03) + Math.min(0.25, S.inv.car*0.05)));
        const riskPct = Math.round(j.risk*100);

        host.appendChild(actionCard({
          title:`${ok ? "‚úÖ" : "üîí"} ${j.name}`,
          text:`–¢–∏—Ä ${j.tier} ‚Ä¢ ${j.tag} ‚Ä¢ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: ‚≠ê${j.needLvl}+ –∏ üß†${j.needSkill}+`,
          cost:`–≠–Ω–µ—Ä–≥–∏—è: -${j.energy} ‚Ä¢ –î–æ—Ö–æ–¥: ~${rub(pay)} ‚Ä¢ –†–∏—Å–∫ –ø—Ä–æ–≤–∞–ª–∞: ${riskPct}% ‚Ä¢ XP: +${j.xp}`,
          btnText: ok ? "–†–∞–±–æ—Ç–∞—Ç—å" : "–ó–∞–∫—Ä—ã—Ç–æ",
          disabled: !ok,
          onClick: ()=>doJob(j)
        }));
      });
    }

    function doJob(job){
      if(!useAction(job.energy)) return;
      // –ø—Ä–æ–≤–∞–ª/—É—Å–ø–µ—Ö (–ø—Ä–æ–≤–∞–ª = —á–∞—Å—Ç—å –¥–æ—Ö–æ–¥–∞ —Ç–µ—Ä—è–µ—Ç—Å—è + —Ä–æ–∑—ã—Å–∫ —á—É—Ç—å —Ä–∞—Å—Ç—ë—Ç –Ω–∞ "—Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö")
      const fail = Math.random() < job.risk;
      const bonus = (1 + Math.min(0.30, S.inv.tech*0.03) + Math.min(0.25, S.inv.car*0.05));
      const pay = Math.floor(job.basePay * bonus);

      if(fail){
        const got = Math.floor(pay * 0.35);
        S.money += got;
        addXP(Math.floor(job.xp * 0.50));
        addLog(`–†–∞–±–æ—Ç–∞ –Ω–µ –∑–∞–¥–∞–ª–∞—Å—å üòµ (${job.name}) +${rub(got)} ‚Ä¢ XP +${Math.floor(job.xp*0.5)}`, "bad");
        toast("–ü—Ä–æ–≤–∞–ª —Ä–∞–±–æ—Ç—ã ‚Äî –Ω–æ —Ö–æ—Ç—å —á—Ç–æ-—Ç–æ –∑–∞—Ä–∞–±–æ—Ç–∞–ª", "warn");
      } else {
        S.money += pay;
        addXP(job.xp);
        addLog(`–†–∞–±–æ—Ç–∞: ${job.name} +${rub(pay)} ‚Ä¢ XP +${job.xp}`, "good");
      }

      S.stats.jobsDone += 1;
      // —à–∞–Ω—Å —Ä–æ—Å—Ç–∞ –Ω–∞–≤—ã–∫–∞
      if(Math.random() < 0.08){
        S.skill += 1;
        addLog(`–ù–∞–≤—ã–∫ –≤—ã—Ä–æ—Å üß† ‚Üí ${S.skill}`, "good");
        toast("–ù–∞–≤—ã–∫ +1", "good");
      }

      save(); render();
      renderJobsList();
    }

    screenTemplate(
      "üíº –†–∞–±–æ—Ç—ã (100)",
      `–ß–µ–º –≤—ã—à–µ ‚≠ê —É—Ä–æ–≤–µ–Ω—å –∏ üß† –Ω–∞–≤—ã–∫ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π. –î–æ—Å—Ç—É–ø–Ω–æ —Å–µ–π—á–∞—Å: <b class="good">${unlocked.length}</b> / ${JOBS.length}.`,
      `–£—Ä–æ–≤–µ–Ω—å ${S.lvl} ‚Ä¢ –ù–∞–≤—ã–∫ ${S.skill}`,
      actions
    );

    setTimeout(()=>{
      const t = document.getElementById("jobTier");
      const s = document.getElementById("jobSort");
      if(t) t.onchange = renderJobsList;
      if(s) s.onchange = renderJobsList;
      renderJobsList();
    },0);

    return;
  }

  if(currentTab==="study"){
    actions.push(actionCard({
      title:"üìë –£—á—ë–±–∞",
      text:"–°—Ç–∞–±–∏–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –Ω–∞–≤—ã–∫. –ù–∞–≤—ã–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—ã.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è: -25 ‚Ä¢ XP: +40 ‚Ä¢ –®–∞–Ω—Å: –ù–∞–≤—ã–∫ +1",
      btnText:"–£—á–∏—Ç—å—Å—è",
      onClick: ()=>{
        if(!useAction(25)) return;
        addXP(40);
        if(Math.random()<0.45){ S.skill += 1; addLog(`–£—á—ë–±–∞: –Ω–∞–≤—ã–∫ –≤—ã—Ä–æ—Å ‚Üí ${S.skill}`, "good"); toast("–ù–∞–≤—ã–∫ +1", "good"); }
        else addLog("–£—á—ë–±–∞: XP –ø–æ–ª—É—á–µ–Ω, –Ω–∞–≤—ã–∫ –Ω–µ –≤—ã—Ä–æ—Å –≤ —ç—Ç–æ—Ç —Ä–∞–∑.", "info");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üî• –ò–Ω—Ç–µ–Ω—Å–∏–≤",
      text:"–î–æ—Ä–æ–≥–æ –ø–æ —ç–Ω–µ—Ä–≥–∏–∏, –Ω–æ –±—ã—Å—Ç—Ä–µ–µ –ø—Ä–æ–∫–∞—á–∏–≤–∞–µ—Ç.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è: -45 ‚Ä¢ XP: +85 ‚Ä¢ –ù–∞–≤—ã–∫ +1..2 (—à–∞–Ω—Å)",
      btnText:"–í–æ–π—Ç–∏",
      onClick: ()=>{
        if(!useAction(45)) return;
        addXP(85);
        const gain = (Math.random()<0.55) ? 2 : 1;
        S.skill += gain;
        addLog(`–ò–Ω—Ç–µ–Ω—Å–∏–≤: –Ω–∞–≤—ã–∫ +${gain} ‚Üí ${S.skill}`, "good");
        toast(`–ù–∞–≤—ã–∫ +${gain}`, "good");
        save(); render();
      }
    }));

    screenTemplate("üìë –û–±—É—á–µ–Ω–∏–µ",
      "–ü—Ä–æ–∫–∞—á–∫–∞ –Ω–∞–≤—ã–∫–∞ –∏ XP. –ë–æ–ª—å—à–µ –Ω–∞–≤—ã–∫–∞ = –±–æ–ª—å—à–µ —Ä–∞–±–æ—Ç –∏ –¥–µ–Ω–µ–≥.",
      "–°–æ–≤–µ—Ç: —É—á—ë–±–∞ + —Ä–∞–±–æ—Ç–∞ = –±—ã—Å—Ç—Ä—ã–π —Ä–æ—Å—Ç",
      actions
    );
    return;
  }

  if(currentTab==="biz"){
    const price = 1500 * (S.biz + 1);
    actions.push(actionCard({
      title:"üöÄ –£–ª—É—á—à–∏—Ç—å –±–∏–∑–Ω–µ—Å",
      text:"–ë–∏–∑–Ω–µ—Å –¥–∞—ë—Ç –ø–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é.",
      cost:`–¶–µ–Ω–∞: ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: -30 ‚Ä¢ –ë–∏–∑–Ω–µ—Å +1`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      onClick: ()=>{
        if(!useAction(30)) return;
        if(S.money < price){
          // –≤–µ—Ä–Ω—É—Ç—å —á–µ—Å—Ç–Ω–æ
          S.actionsLeft += 1;
          S.energy = clamp(S.energy + 30, 0, 100);
          addLog(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥. –ù—É–∂–Ω–æ ${rub(price)}.`, "bad");
          toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥ –Ω–∞ –±–∏–∑–Ω–µ—Å", "bad");
          save(); render();
          return;
        }
        S.money -= price;
        S.biz += 1;
        addXP(30);
        addLog(`–ë–∏–∑–Ω–µ—Å –≤—ã—Ä–æ—Å –¥–æ ${S.biz} ‚úÖ (-${rub(price)})`, "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üí∞ –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ (—Ç–æ–ø)",
      text:"–ß–∏—Å—Ç–æ –∏–≥—Ä–æ–≤–∞—è —Ñ–∏—à–∫–∞ ‚Äî –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–æ–ø –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π.",
      cost:"–•–æ–¥: -1 ‚Ä¢ –ù–∞–ª–∏—á–Ω—ã–µ: -500 ‚ÇΩ ‚Ä¢ –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è: +500",
      btnText:"–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
        if(S.money < 500) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 500 ‚ÇΩ", "bad");
        S.actionsLeft -= 1;
        S.money -= 500;
        S.tops.donations += 500;
        addXP(10);
        addLog("–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ üí∞ +500", "good");
        save(); render();
      }
    }));

    screenTemplate("üöÄ –ë–∏–∑–Ω–µ—Å",
      `–ü–∞—Å—Å–∏–≤ –≤ –Ω–µ–¥–µ–ª—é: <b class="good">${rub(passiveIncome())}</b> ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å –±–∏–∑–Ω–µ—Å–∞: <b class="good">${S.biz}</b>`,
      "–ß–µ–º –≤—ã—à–µ –±–∏–∑–Ω–µ—Å ‚Äî —Ç–µ–º –º–µ–Ω—å—à–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ä–∞–±–æ—Ç",
      actions
    );
    return;
  }

  if(currentTab==="bank"){
    actions.push(actionCard({
      title:"üè¶ –î–µ–ø–æ–∑–∏—Ç",
      text:"–ü–æ–ª–æ–∂–∏—Ç—å/—Å–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏ –∏–∑ –±–∞–Ω–∫–∞.",
      cost:`–°–µ–π—á–∞—Å –≤ –±–∞–Ω–∫–µ: <b class="good">${rub(S.bank)}</b>`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>{
        openModal("–ë–∞–Ω–∫ üè¶", "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", [
          {text:"+1000 –≤ –±–∞–Ω–∫", kind:"primary", onClick:()=>bankMove(+1000)},
          {text:"+5000 –≤ –±–∞–Ω–∫", kind:"primary", onClick:()=>bankMove(+5000)},
          {text:"–°–Ω—è—Ç—å 1000", kind:"ghost", onClick:()=>bankMove(-1000)},
          {text:"–°–Ω—è—Ç—å 5000", kind:"ghost", onClick:()=>bankMove(-5000)},
        ]);
      }
    }));

    actions.push(actionCard({
      title:"üí≥ –ö—Ä–µ–¥–∏—Ç",
      text:"–ë–µ—Ä—ë—à—å –¥–µ–Ω—å–≥–∏ —Å–µ–π—á–∞—Å, –ø–ª–∞—Ç–∏—à—å –ø—Ä–æ—Ü–µ–Ω—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (–∏–≥—Ä–æ–≤–æ–µ).",
      cost:`–î–æ–ª–≥: <b class="warn">${rub(S.debt)}</b> ‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç—ã/–¥–µ–Ω—å: <b class="warn">${rub(dailyDebtInterest())}</b>`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>{
        openModal("–ö—Ä–µ–¥–∏—Ç üí≥", "–í—ã–±–µ—Ä–∏:", [
          {text:"–í–∑—è—Ç—å 2000", kind:"primary", onClick:()=>loan(+2000)},
          {text:"–í–∑—è—Ç—å 10000", kind:"primary", onClick:()=>loan(+10000)},
          {text:"–ü–æ–≥–∞—Å–∏—Ç—å 500", kind:"ghost", onClick:()=>loan(-500)},
          {text:"–ü–æ–≥–∞—Å–∏—Ç—å 2000", kind:"ghost", onClick:()=>loan(-2000)},
        ]);
      }
    }));

    function bankMove(v){
      if(v>0){
        if(S.money < v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
        S.money -= v; S.bank += v;
        addLog(`–ë–∞–Ω–∫: –¥–µ–ø–æ–∑–∏—Ç +${rub(v)}`, "good");
      } else {
        const x = Math.abs(v);
        if(S.bank < x) return toast("–í –±–∞–Ω–∫–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "bad");
        S.bank -= x; S.money += x;
        addLog(`–ë–∞–Ω–∫: —Å–Ω—è—Ç–∏–µ -${rub(x)}`, "good");
      }
      save(); render();
    }
    function loan(v){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      if(v>0){
        S.actionsLeft -= 1;
        S.money += v;
        // –¥–æ–ª–≥ —Ä–∞—Å—Ç–µ—Ç —Å –∫–æ–º–∏—Å—Å–∏–µ–π
        const add = Math.floor(v * (1.10 + Math.min(0.06, S.wanted*0.002)));
        S.debt += add;
        addLog(`–ö—Ä–µ–¥–∏—Ç: +${rub(v)} (–¥–æ–ª–≥ +${rub(add)})`, "warn");
        toast("–ö—Ä–µ–¥–∏—Ç –≤–∑—è—Ç", "warn");
      } else {
        const x = Math.abs(v);
        if(S.money < x) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
        if(S.debt <= 0) return toast("–î–æ–ª–≥–æ–≤ –Ω–µ—Ç", "good");
        S.actionsLeft -= 1;
        S.money -= x;
        S.debt = Math.max(0, S.debt - x);
        addLog(`–ü–æ–≥–∞—à–µ–Ω–∏–µ: -${rub(x)} (–¥–æ–ª–≥ ${rub(S.debt)})`, "good");
      }
      save(); render();
    }

    screenTemplate("üè¶ –ë–∞–Ω–∫",
      "–î–µ–ø–æ–∑–∏—Ç—ã –∏ –∫—Ä–µ–¥–∏—Ç—ã. –ö—Ä–µ–¥–∏—Ç—ã –æ–ø–∞—Å–Ω—ã ‚Äî –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –ø—Ä–æ—Ü–µ–Ω—Ç—ã.",
      "–°–æ–≤–µ—Ç: –Ω–µ –±–µ—Ä–∏ –∫—Ä–µ–¥–∏—Ç —Ä–∞–¥–∏ –∫—Ä–∏–ø—Ç—ã üòÖ",
      actions
    );
    return;
  }

  if(currentTab==="shop"){
    actions.push(actionCard({
      title:"üçé –ï–¥–∞",
      text:"–ù—É–∂–Ω–∞, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é –¥–æ–º–∞.",
      cost:"–¶–µ–Ω–∞: 150 ‚ÇΩ ‚Ä¢ +1 –µ–¥–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<150) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 150 ‚ÇΩ","bad");
        S.actionsLeft -= 1; S.money -= 150; S.inv.food += 1;
        addLog("–ö—É–ø–∏–ª –µ–¥—É üçé +1", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üñ• –¢–µ—Ö–Ω–∏–∫–∞",
      text:"–î–∞—ë—Ç –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥–∞–º/–ø–∞—Å—Å–∏–≤—É (–¥–æ 30% —Å—É–º–º–∞—Ä–Ω–æ).",
      cost:"–¶–µ–Ω–∞: 2 500 ‚ÇΩ ‚Ä¢ +1 —Ç–µ—Ö–Ω–∏–∫–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<2500) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 2 500 ‚ÇΩ","bad");
        S.actionsLeft -= 1; S.money -= 2500; S.inv.tech += 1;
        addLog("–ö—É–ø–∏–ª —Ç–µ—Ö–Ω–∏–∫—É üñ• +1", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üõ° –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ (–∏–≥—Ä–æ–≤–∞—è)",
      text:"–°–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –≤ –¥—É—ç–ª—è—Ö/–æ–≥—Ä–∞–±–ª–µ–Ω–∏—è—Ö (—á—É—Ç—å-—á—É—Ç—å).",
      cost:"–¶–µ–Ω–∞: 1 800 ‚ÇΩ ‚Ä¢ +1 —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<1800) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 1 800 ‚ÇΩ","bad");
        S.actionsLeft -= 1; S.money -= 1800; S.inv.gear += 1;
        addLog("–ö—É–ø–∏–ª —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É üõ° +1", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üöó –ú–∞—à–∏–Ω–∞",
      text:"–î–∞—ë—Ç –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥–∞–º (–¥–æ 25% —Å—É–º–º–∞—Ä–Ω–æ).",
      cost:"–¶–µ–Ω–∞: 12 000 ‚ÇΩ ‚Ä¢ +1 –º–∞—à–∏–Ω–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<12000) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 12 000 ‚ÇΩ","bad");
        S.actionsLeft -= 1; S.money -= 12000; S.inv.car += 1;
        addLog("–ö—É–ø–∏–ª –º–∞—à–∏–Ω—É üöó +1", "good");
        save(); render();
      }
    }));

    screenTemplate("üè¨ –ú–∞–≥–∞–∑–∏–Ω",
      "–ü–æ–∫—É–ø–∫–∏: –µ–¥–∞, —Ç–µ—Ö–Ω–∏–∫–∞, —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞, –º–∞—à–∏–Ω–∞. –í—Å—ë –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–µ–º–ø —Ä–∞–∑–≤–∏—Ç–∏—è.",
      "–°–æ–≤–µ—Ç: —Ç–µ—Ö–Ω–∏–∫–∞ + –±–∏–∑–Ω–µ—Å = –∂–∏—Ä–Ω—ã–π –ø–∞—Å—Å–∏–≤",
      actions
    );
    return;
  }

  if(currentTab==="realty"){
    const names = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"];
    const nextLvl = Math.min(3, S.homeLevel+1);
    const price = [0, 8000, 17000, 40000][nextLvl] || 0;

    actions.push(actionCard({
      title:"üè† –£–ª—É—á—à–∏—Ç—å –∂–∏–ª—å—ë",
      text:`–°–µ–π—á–∞—Å: ${names[S.homeLevel]}. –°–ª–µ–¥—É—é—â–µ–µ: ${names[nextLvl]}.`,
      cost:`–¶–µ–Ω–∞: ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: -25`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      disabled: nextLvl===S.homeLevel,
      onClick: ()=>{
        if(!useAction(25)) return;
        if(S.money<price){
          S.actionsLeft += 1; S.energy = clamp(S.energy+25,0,100);
          addLog(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥. –ù—É–∂–Ω–æ ${rub(price)}.`, "bad");
          return save(), render();
        }
        S.money -= price;
        S.homeLevel = nextLvl;
        S.rentDueIn = Math.min(14, S.rentDueIn+3);
        addXP(35);
        addLog(`–ñ–∏–ª—å—ë —É–ª—É—á—à–µ–Ω–æ: ${names[S.homeLevel]} üè†`, "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üßæ –û–ø–ª–∞—Ç–∏—Ç—å –∂–∏–ª—å—ë –∑–∞—Ä–∞–Ω–µ–µ",
      text:"–ï—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–∏—à—å ‚Äî —à—Ç—Ä–∞—Ñ –∏ —Å—Ç—Ä–µ—Å—Å.",
      cost:`–¶–µ–Ω–∞: 700 ‚ÇΩ ‚Ä¢ –î–æ –æ–ø–ª–∞—Ç—ã: ${S.rentDueIn} –¥–Ω ‚Üí +7 –¥–Ω`,
      btnText:"–û–ø–ª–∞—Ç–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<700) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 700 ‚ÇΩ","bad");
        S.actionsLeft -= 1; S.money -= 700;
        S.rentDueIn = Math.min(21, S.rentDueIn + 7);
        addLog("–ñ–∏–ª—å—ë –æ–ø–ª–∞—á–µ–Ω–æ üßæ", "good");
        save(); render();
      }
    }));

    screenTemplate("üè¢ –ñ–∏–ª—å—ë",
      "–ñ–∏–ª—å—ë –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –∏ –∫–æ–º—Ñ–æ—Ä—Ç, –Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –≤ –Ω–µ–¥–µ–ª—é.",
      `–î–æ –æ–ø–ª–∞—Ç—ã: ${S.rentDueIn} –¥–Ω–µ–π`,
      actions
    );
    return;
  }

  if(currentTab==="crypto"){
    const p = S.crypto.price;
    const val = Math.floor(S.crypto.coins * p);
    actions.push(actionCard({
      title:"üñ•üí∂ –†—ã–Ω–æ–∫ –∫—Ä–∏–ø—Ç—ã",
      text:`–¶–µ–Ω–∞: <b class="good">${rub(p)}</b> –∑–∞ –º–æ–Ω–µ—Ç—É. –£ —Ç–µ–±—è: <b class="good">${S.crypto.coins}</b> (‚âà ${rub(val)}).`,
      cost:"–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ —Ç—Ä–∞—Ç–∏—Ç 1 —Ö–æ–¥",
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>{
        openModal("–ö—Ä–∏–ø—Ç–∞ üñ•üí∂", `–¶–µ–Ω–∞ —Å–µ–π—á–∞—Å: ${rub(p)}. –°–∫–æ–ª—å–∫–æ –∫—É–ø–∏—Ç—å/–ø—Ä–æ–¥–∞—Ç—å?`, [
          {text:"–ö—É–ø–∏—Ç—å 1", kind:"primary", onClick:()=>cryptoBuy(1)},
          {text:"–ö—É–ø–∏—Ç—å 5", kind:"primary", onClick:()=>cryptoBuy(5)},
          {text:"–ü—Ä–æ–¥–∞—Ç—å 1", kind:"ghost", onClick:()=>cryptoSell(1)},
          {text:"–ü—Ä–æ–¥–∞—Ç—å 5", kind:"ghost", onClick:()=>cryptoSell(5)},
        ]);
      }
    }));

    function cryptoBuy(q){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      const cost = q*S.crypto.price;
      if(S.money<cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
      S.actionsLeft -= 1;
      S.money -= cost;
      S.crypto.coins += q;
      addXP(10);
      addLog(`–ö—Ä–∏–ø—Ç–∞: –∫—É–ø–∏–ª +${q} (-${rub(cost)})`, "good");
      save(); render();
    }
    function cryptoSell(q){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      if(S.crypto.coins<q) return toast("–ú–æ–Ω–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "bad");
      const gain = q*S.crypto.price;
      S.actionsLeft -= 1;
      S.crypto.coins -= q;
      S.money += gain;
      addXP(10);
      addLog(`–ö—Ä–∏–ø—Ç–∞: –ø—Ä–æ–¥–∞–ª -${q} (+${rub(gain)})`, "good");
      save(); render();
    }

    screenTemplate("üñ•üí∂ –ö—Ä–∏–ø—Ç–∞",
      "–¶–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –ú–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –∏–ª–∏ —É–ª–µ—Ç–µ—Ç—å –≤ –Ω–æ–ª—å üòÖ",
      "–°–æ–≤–µ—Ç: –∏–∑–±–µ–≥–∞–π –∫—Ä–µ–¥–∏—Ç–∞ —Ä–∞–¥–∏ –∫—Ä–∏–ø—Ç—ã",
      actions
    );
    return;
  }

  if(currentTab==="arena"){
    // –¥—É—ç–ª—å: —à–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è, –Ω–∞–≤—ã–∫–∞ –∏ —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
    const gearB = Math.min(0.20, S.inv.gear*0.04);
    const baseWin = clamp(0.45 + (S.lvl*0.01) + (S.skill*0.015) + gearB - (S.wanted*0.01), 0.08, 0.92);
    const prize = 350 + S.lvl*45;

    actions.push(actionCard({
      title:"ü§∫ –î—É—ç–ª—å (–ø—Ä–æ—Ç–∏–≤ –±–æ—Ç–∞)",
      text:"–®–∞–Ω—Å –ø–æ–±–µ–¥—ã –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è/–Ω–∞–≤—ã–∫–∞/—ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏. –ü—Ä–æ–∏–≥—Ä—ã—à ‚Äî –ø–æ—Ç–µ—Ä—è –¥–µ–Ω–µ–≥.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è: -25 ‚Ä¢ –•–æ–¥: -1 ‚Ä¢ –®–∞–Ω—Å –ø–æ–±–µ–¥—ã: ${Math.round(baseWin*100)}% ‚Ä¢ –ù–∞–≥—Ä–∞–¥–∞: +${rub(prize)} / –®—Ç—Ä–∞—Ñ: -${rub(Math.floor(prize*0.75))}`,
      btnText:"–î—Ä–∞—Ç—å—Å—è",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(25)) return;
        const win = Math.random() < baseWin;
        if(win){
          S.money += prize;
          S.stats.duelsWin += 1;
          addXP(55);
          addLog(`–î—É—ç–ª—å –≤—ã–∏–≥—Ä–∞–Ω–∞ ü§∫ +${rub(prize)} ‚Ä¢ XP +55`, "good");
          toast("–ü–æ–±–µ–¥–∞!", "good");
        } else {
          const loss = Math.floor(prize*0.75);
          S.money = Math.max(0, S.money - loss);
          S.stats.duelsLose += 1;
          addXP(15);
          addLog(`–î—É—ç–ª—å –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞ ü§ï -${rub(loss)} ‚Ä¢ XP +15`, "bad");
          toast("–ü—Ä–æ–∏–≥—Ä—ã—à üòÖ", "bad");
        }
        save(); render();
      }
    }));

    screenTemplate("ü§∫ –î—É—ç–ª—å",
      "–≠—Ç–æ –∏–≥—Ä–æ–≤–∞—è –¥—É—ç–ª—å (—Ç–æ–ª—å–∫–æ —à–∞–Ω—Å/–Ω–∞–≥—Ä–∞–¥–∞/—à—Ç—Ä–∞—Ñ).",
      `–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ –±–æ–Ω—É—Å: +${Math.round(gearB*100)}%`,
      actions
    );
    return;
  }

  if(currentTab==="heist"){
    // –æ–≥—Ä–∞–±–ª–µ–Ω–∏–µ ‚Äî —á–∏—Å—Ç–æ –∏–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ —Ä–∏—Å–∫–∞
    const gearB = Math.min(0.22, S.inv.gear*0.045);
    const base = clamp(0.25 + (S.skill*0.02) + (S.lvl*0.012) + gearB - (S.wanted*0.02), 0.03, 0.80);
    const loot = 900 + S.lvl*110 + S.skill*45;
    const fine = 1000 + S.wanted*220;

    actions.push(actionCard({
      title:"ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ (–æ—á–µ–Ω—å —Ä–∏—Å–∫)",
      text:"–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫. –ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —Ä–∞—Å—Ç—ë—Ç —Ä–æ–∑—ã—Å–∫ –∏ —à—Ç—Ä–∞—Ñ. –≠—Ç–æ –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –∏–≤–µ–Ω—Ç.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è: -40 ‚Ä¢ –•–æ–¥: -1 ‚Ä¢ –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: ${Math.round(base*100)}% ‚Ä¢ –õ—É—Ç: +${rub(Math.floor(loot))} ‚Ä¢ –ü—Ä–æ–≤–∞–ª: -${rub(fine)} –∏ —Ä–æ–∑—ã—Å–∫ +2`,
      btnText:"–†–∏—Å–∫–Ω—É—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(40)) return;
        const ok = Math.random() < base;
        if(ok){
          const gain = Math.floor(loot);
          S.money += gain;
          S.stats.heistsWin += 1;
          addXP(85);
          S.wanted += 1;
          addLog(`–£—Å–ø–µ—Ö ü™ì +${rub(gain)} ‚Ä¢ —Ä–æ–∑—ã—Å–∫ +1 ‚Ä¢ XP +85`, "good");
          toast("–£—Å–ø–µ—Ö!", "good");
        } else {
          S.money = Math.max(0, S.money - fine);
          S.stats.heistsLose += 1;
          addXP(20);
          S.wanted += 2;
          addLog(`–ü—Ä–æ–≤–∞–ª ü™ì -${rub(fine)} ‚Ä¢ —Ä–æ–∑—ã—Å–∫ +2 ‚Ä¢ XP +20`, "bad");
          toast("–ü—Ä–æ–≤–∞–ª üòµ", "bad");
        }
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üßº –°–±—Ä–æ—Å–∏—Ç—å —Ä–æ–∑—ã—Å–∫ (–æ—Ç–∫—É–ø)",
      text:"–ü–ª–∞—Ç–∏, —á—Ç–æ–±—ã —Å–Ω–∏–∑–∏—Ç—å —Ä–æ–∑—ã—Å–∫ (–∏–≥—Ä–æ–≤–æ–µ).",
      cost:`–¶–µ–Ω–∞: ${rub(600 + S.wanted*250)} ‚Ä¢ –†–æ–∑—ã—Å–∫ -1`,
      btnText:"–°–Ω–∏–∑–∏—Ç—å",
      disabled: S.wanted<=0,
      onClick: ()=>{
        const price = 600 + S.wanted*250;
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money < price) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥","bad");
        S.actionsLeft -= 1;
        S.money -= price;
        S.wanted = Math.max(0, S.wanted - 1);
        addLog(`–†–æ–∑—ã—Å–∫ —Å–Ω–∏–∂–µ–Ω üßº (-${rub(price)})`, "good");
        save(); render();
      }
    }));

    screenTemplate("ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ",
      "–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫. –î–µ–ª–∞–π –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫ ‚Äî —á–∏—Å—Ç–æ –≤ –∏–≥—Ä–µ.",
      `–†–æ–∑—ã—Å–∫: ${S.wanted}`,
      actions
    );
    return;
  }

  if(currentTab==="family"){
    actions.push(actionCard({
      title:"üë©‚Äç‚ù§Ô∏è‚Äçüë® –ù–∞–π—Ç–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞",
      text:"–ü–∞—Ä—Ç–Ω—ë—Ä —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã, –Ω–æ –¥–∞—ë—Ç –±–æ–Ω—É—Å –º–æ—Ç–∏–≤–∞—Ü–∏–∏ (XP).",
      cost:"–•–æ–¥: -1 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: -15 ‚Ä¢ –ü–∞—Ä—Ç–Ω—ë—Ä: –¥–∞",
      btnText: S.family.partner ? "–£–∂–µ –µ—Å—Ç—å" : "–ò—Å–∫–∞—Ç—å",
      disabled: S.family.partner,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(15)) return;
        S.family.partner = true;
        addXP(40);
        addLog("–¢—ã –Ω–∞—à—ë–ª –ø–∞—Ä—Ç–Ω—ë—Ä–∞ üë©‚Äç‚ù§Ô∏è‚Äçüë®", "good");
        toast("–ü–∞—Ä—Ç–Ω—ë—Ä –Ω–∞–π–¥–µ–Ω!", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üë´ –ó–ê–ì–° (—Å–≤–∞–¥—å–±–∞)",
      text:"–°–≤–∞–¥—å–±–∞ –ø–æ–≤—ã—à–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã, –Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (–º–∞–ª—ã–π –±–æ–Ω—É—Å –ø–∞—Å—Å–∏–≤–∞).",
      cost:"–¶–µ–Ω–∞: 3000 ‚ÇΩ ‚Ä¢ –•–æ–¥: -1 ‚Ä¢ –°—Ç–∞—Ç—É—Å: –∂–µ–Ω–∞—Ç/–∑–∞–º—É–∂–µ–º",
      btnText: S.family.married ? "–£–∂–µ –≤ –±—Ä–∞–∫–µ" : "–ñ–µ–Ω–∏—Ç—å—Å—è",
      disabled: !S.family.partner || S.family.married,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<3000) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 3000 ‚ÇΩ","bad");
        S.actionsLeft -= 1;
        S.money -= 3000;
        S.family.married = true;
        addXP(60);
        addLog("–°–≤–∞–¥—å–±–∞ –≤ –ó–ê–ì–° üëë", "good");
        toast("–ë—Ä–∞–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üë∂ –†–µ–±—ë–Ω–æ–∫",
      text:"–î–æ—Ä–æ–≥–æ –ø–æ —Ä–∞—Å—Ö–æ–¥–∞–º, –Ω–æ —ç—Ç–æ –∂–∏–∑–Ω—å üòÖ",
      cost:"–•–æ–¥: -1 ‚Ä¢ –¶–µ–Ω–∞: 1500 ‚ÇΩ ‚Ä¢ –î–µ—Ç–∏ +1",
      btnText:"–î–æ–±–∞–≤–∏—Ç—å",
      disabled: !S.family.married,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<1500) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 1500 ‚ÇΩ","bad");
        S.actionsLeft -= 1;
        S.money -= 1500;
        S.family.kids += 1;
        addXP(35);
        addLog(`–°–µ–º—å—è –≤—ã—Ä–æ—Å–ª–∞ üë∂ –î–µ—Ç–∏: ${S.family.kids}`, "good");
        save(); render();
      }
    }));

    screenTemplate("üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è / –ó–ê–ì–°",
      `–ü–∞—Ä—Ç–Ω—ë—Ä: <b>${S.family.partner ? "–µ—Å—Ç—å" : "–Ω–µ—Ç"}</b> ‚Ä¢ –ë—Ä–∞–∫: <b>${S.family.married ? "–¥–∞" : "–Ω–µ—Ç"}</b> ‚Ä¢ –î–µ—Ç–∏: <b>${S.family.kids}</b>`,
      "–°–µ–º—å—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞—Å—Ö–æ–¥—ã –≤ –Ω–µ–¥–µ–ª—é",
      actions
    );
    return;
  }

  if(currentTab==="clan"){
    actions.push(actionCard({
      title:"üõ° –ö–ª–∞–Ω",
      text:"–ö–ª–∞–Ω ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ (–≤ –±—Ä–∞—É–∑–µ—Ä–µ). –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–µ—Ä—Å–∏—é –ø–æ–∑–∂–µ.",
      cost:`–ö–ª–∞–Ω: <b class="good">${S.clan.name || "–Ω–µ—Ç"}</b> ‚Ä¢ –£—Ä–æ–≤–µ–Ω—å: ${S.clan.level} ‚Ä¢ –°–∫–ª–∞–¥: ${rub(S.clan.storage)}`,
      btnText:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
      onClick: ()=>{
        if(!S.clan.name){
          openModal("–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω üõ°", "–í—ã–±–µ—Ä–∏:", [
            {text:"–°–æ–∑–¥–∞—Ç—å –∑–∞ 2000", kind:"primary", onClick:()=>createClan()},
            {text:"–û—Ç–º–µ–Ω–∞", kind:"ghost", onClick:()=>{}},
          ]);
        } else {
          openModal("–ö–ª–∞–Ω üõ°", "–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:", [
            {text:"+1000 –≤ —Å–∫–ª–∞–¥", kind:"primary", onClick:()=>clanStore(+1000)},
            {text:"+5000 –≤ —Å–∫–ª–∞–¥", kind:"primary", onClick:()=>clanStore(+5000)},
            {text:"–°–Ω—è—Ç—å 1000", kind:"ghost", onClick:()=>clanStore(-1000)},
            {text:"–ê–ø–≥—Ä–µ–π–¥ –∫–ª–∞–Ω–∞", kind:"primary", onClick:()=>clanUp()},
          ]);
        }
      }
    }));

    actions.push(actionCard({
      title:"‚öîÔ∏è –ë–∏—Ç–≤–∞ –∫–ª–∞–Ω–æ–≤ (–∏–≤–µ–Ω—Ç)",
      text:"–®–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –∫–ª–∞–Ω–∞ –∏ —Ç–≤–æ–µ–≥–æ —É—Ä–æ–≤–Ω—è.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è: -30 ‚Ä¢ –•–æ–¥: -1 ‚Ä¢ –ü–æ–±–µ–¥–∞: +—Å–∫–ª–∞–¥ ‚Ä¢ –ü–æ—Ä–∞–∂–µ–Ω–∏–µ: -—Å–∫–ª–∞–¥",
      btnText:"–°—Ä–∞–∂–∞—Ç—å—Å—è",
      disabled: !S.clan.name,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(30)) return;
        const chance = clamp(0.45 + (S.clan.level*0.04) + (S.lvl*0.01), 0.10, 0.90);
        const stake = 700 + S.clan.level*250;
        const win = Math.random() < chance;
        if(win){
          S.clan.storage += stake;
          addXP(70);
          addLog(`–ö–ª–∞–Ω –ø–æ–±–µ–¥–∏–ª ‚öîÔ∏è +${rub(stake)} –≤ —Å–∫–ª–∞–¥`, "good");
          toast("–ü–æ–±–µ–¥–∞ –∫–ª–∞–Ω–∞!", "good");
        } else {
          S.clan.storage = Math.max(0, S.clan.storage - stake);
          addXP(20);
          addLog(`–ö–ª–∞–Ω –ø—Ä–æ–∏–≥—Ä–∞–ª ‚öîÔ∏è -${rub(stake)} —Å–æ —Å–∫–ª–∞–¥–∞`, "bad");
          toast("–ü—Ä–æ–∏–≥—Ä—ã—à –∫–ª–∞–Ω–∞", "bad");
        }
        save(); render();
      }
    }));

    function createClan(){
      if(S.money < 2000) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 2000", "bad");
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      S.actionsLeft -= 1;
      S.money -= 2000;
      S.clan.name = "FiveClan";
      S.clan.level = 1;
      S.clan.storage = 0;
      addXP(40);
      addLog("–ö–ª–∞–Ω —Å–æ–∑–¥–∞–Ω üõ° FiveClan", "good");
      toast("–ö–ª–∞–Ω —Å–æ–∑–¥–∞–Ω!", "good");
      save(); render();
    }
    function clanStore(v){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      if(v>0){
        if(S.money < v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
        S.actionsLeft -= 1;
        S.money -= v;
        S.clan.storage += v;
        addLog(`–°–∫–ª–∞–¥ –∫–ª–∞–Ω–∞ üõ† +${rub(v)}`, "good");
      } else {
        const x = Math.abs(v);
        if(S.clan.storage < x) return toast("–í —Å–∫–ª–∞–¥–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "bad");
        S.actionsLeft -= 1;
        S.clan.storage -= x;
        S.money += x;
        addLog(`–°–∫–ª–∞–¥ –∫–ª–∞–Ω–∞ üõ† -${rub(x)} (—Å–Ω—è—Ç–∏–µ)`, "good");
      }
      save(); render();
    }
    function clanUp(){
      const price = 2500 + S.clan.level*1800;
      if(S.money < price) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥", "bad");
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤", "bad");
      S.actionsLeft -= 1;
      S.money -= price;
      S.clan.level += 1;
      addXP(60);
      addLog(`–ö–ª–∞–Ω –∞–ø–Ω—É—Ç –¥–æ —É—Ä–æ–≤–Ω—è ${S.clan.level} üõ° (-${rub(price)})`, "good");
      save(); render();
    }

    screenTemplate("üõ° –ö–ª–∞–Ω",
      "–ö–ª–∞–Ω—ã, –±–∏—Ç–≤—ã, —Å–∫–ª–∞–¥. –ü–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (–≤ –±—Ä–∞—É–∑–µ—Ä–µ), –Ω–æ –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–Ω–ª–∞–π–Ω–æ–≤–æ –ø–æ–∑–∂–µ.",
      "–°–æ–≤–µ—Ç: –≤–ª–æ–∂–∏ –¥–µ–Ω—å–≥–∏ –≤ –∫–ª–∞–Ω–æ–≤—ã–π —Å–∫–ª–∞–¥",
      actions
    );
    return;
  }

  if(currentTab==="tops"){
    // –æ–±–Ω–æ–≤–∏–º —Ä–µ–∫–æ—Ä–¥—ã
    const cryptoVal = Math.floor(S.crypto.coins * S.crypto.price);
    S.tops.bestNW = Math.max(S.tops.bestNW, netWorth());
    S.tops.bestCrypto = Math.max(S.tops.bestCrypto, cryptoVal);

    actions.push(actionCard({
      title:"Forbes üòéüíµ",
      text:"–ü–æ–∫–∞ —Ç–æ–ø—ã –ª–æ–∫–∞–ª—å–Ω—ã–µ (–≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ). –î–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä.",
      cost:"‚Äî",
      btnText:"–û–∫",
      onClick: ()=>{},
      extraHTML: `
        <ul class="list" style="margin:10px 0 0">
          <li><div><b>–¢–æ–ø –±–∞–ª–∞–Ω—Å üí≥</b><div class="small">–†–µ–∫–æ—Ä–¥ –∫–∞–ø–∏—Ç–∞–ª–∞</div></div><span class="badge">${rub(S.tops.bestNW)}</span></li>
          <li><div><b>–¢–æ–ø –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è üí∞</b><div class="small">–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–æ</div></div><span class="badge">${rub(S.tops.donations)}</span></li>
          <li><div><b>–¢–æ–ø –∫—Ä–∏–ø—Ç–∞ üñ•üí∂</b><div class="small">–õ—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç—ã</div></div><span class="badge">${rub(S.tops.bestCrypto)}</span></li>
        </ul>
      `
    }));

    screenTemplate("Forbes üòéüíµ",
      "–¢–æ–ø—ã –∏ —Ä–µ–∫–æ—Ä–¥—ã. –°–µ—Ä–≤–µ—Ä–∞ –Ω–µ—Ç ‚Üí –≤—Å—ë –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –ª–æ–∫–∞–ª—å–Ω–æ ‚úÖ",
      "–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –æ–±—â–∏–π –æ–Ω–ª–∞–π–Ω-—Ç–æ–ø ‚Äî —Å–∫–∞–∂–∏, —Å–¥–µ–ª–∞–µ–º –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–º —Ö–æ—Å—Ç–∏–Ω–≥–µ API",
      actions
    );
    save();
    return;
  }
}

/* ---------- Next day tick ---------- */
function nextDay(){
  // –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É
  const di = dailyDebtInterest();
  if(di>0){
    S.debt += di;
    addLog(`–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É: +${rub(di)} (–¥–æ–ª–≥ ${rub(S.debt)})`, "warn");
  }

  // –∫—Ä–∏–ø—Ç–∞
  const prev = S.crypto.price;
  nextCryptoPrice();
  if(S.crypto.price>prev) addLog(`–ö—Ä–∏–ø—Ç–∞ üìà ${rub(prev)} ‚Üí ${rub(S.crypto.price)}`, "good");
  else if(S.crypto.price<prev) addLog(`–ö—Ä–∏–ø—Ç–∞ üìâ ${rub(prev)} ‚Üí ${rub(S.crypto.price)}`, "bad");

  // –∂–∏–ª—å—ë (—Å—á—ë—Ç—á–∏–∫ –æ–ø–ª–∞—Ç—ã)
  S.rentDueIn -= 1;

  // –Ω–æ–≤—ã–π –¥–µ–Ω—å
  S.day += 1;
  S.actionsLeft = 3;
  S.energy = clamp(S.energy + 25, 0, 100);
  addLog(`–ù–æ–≤—ã–π –¥–µ–Ω—å: ${S.day}. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å.`, "info");

  // –ø—Ä–æ—Å—Ä–æ—á–∫–∞ –∂–∏–ª—å—è
  if(S.rentDueIn <= 0){
    const fine = 900 + S.homeLevel*260 + (S.family.kids*120);
    S.money = Math.max(0, S.money - fine);
    S.rentDueIn = 7;
    addLog(`–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –∂–∏–ª—å—è üßæ –®—Ç—Ä–∞—Ñ -${rub(fine)}.`, "bad");
    toast("–®—Ç—Ä–∞—Ñ –∑–∞ –∂–∏–ª—å—ë!", "bad");
  }

  // —Ä–æ–∑—ã—Å–∫ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø–∞–¥–∞–µ—Ç
  if(S.wanted>0 && Math.random()<0.55){
    S.wanted = Math.max(0, S.wanted-1);
    addLog("–†–æ–∑—ã—Å–∫ —Å–Ω–∏–∑–∏–ª—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º üßº (-1)", "info");
  }

  // –∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏
  if((S.day-1) % 7 === 0){
    const cost = weeklyCosts();
    const pass = passiveIncome();
    S.money = Math.max(0, S.money - cost + pass);
    addLog(`–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏: —Ä–∞—Å—Ö–æ–¥—ã -${rub(cost)}.`, "bad");
    if(pass>0) addLog(`–ü–∞—Å—Å–∏–≤: +${rub(pass)} ‚úÖ`, "good");

    // –±–æ–Ω—É—Å XP –∑–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
    addXP(25);
  }

  // –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–∫–æ—Ä–¥—ã
  S.tops.bestNW = Math.max(S.tops.bestNW, netWorth());
  S.tops.bestCrypto = Math.max(S.tops.bestCrypto, Math.floor(S.crypto.coins * S.crypto.price));

  save(); render();
}

/* ---------- UI render (kpis / inv / achievements / log / screen) ---------- */
function renderInventory(){
  const ul = $("inventoryList");
  ul.innerHTML="";
  const rows = [
    ["–ï–¥–∞ üçé", S.inv.food],
    ["–¢–µ—Ö–Ω–∏–∫–∞ üñ•", S.inv.tech],
    ["–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ üõ°", S.inv.gear],
    ["–ú–∞—à–∏–Ω–∞ üöó", S.inv.car],
  ];
  rows.forEach(([name,val])=>{
    const li = document.createElement("li");
    li.innerHTML = `<div><b>${name}</b><div class="small">–∫–æ–ª-–≤–æ</div></div><span class="badge">${val}</span>`;
    ul.appendChild(li);
  });
  $("invBadge").textContent = `–ö–æ–ø–∏–ª–∫–∞: ${rub(S.safe)} ‚Ä¢ –ö—Ä–∏–ø—Ç–∞: ${S.crypto.coins}ü™ô`;
}

function renderAchievements(){
  const ul = $("achievements");
  ul.innerHTML="";
  let done=0;
  ACH.forEach(a=>{
    const ok = a.ok(S);
    if(ok) done++;
    const li = document.createElement("li");
    li.innerHTML = `
      <div style="min-width:0">
        <b>${a.name} ${ok?'<span class="good">‚úì</span>':''}</b>
        <div class="small">${a.desc}</div>
      </div>
      <span class="badge">${ok?"–û—Ç–∫—Ä—ã—Ç–æ":"–ó–∞–∫—Ä—ã—Ç–æ"}</span>
    `;
    ul.appendChild(li);
  });
  $("achvBadge").textContent = `${done}/${ACH.length}`;
}

function render(){
  // KPI
  $("dayPill").textContent = `–î–µ–Ω—å ${S.day}`;
  $("weekPill").textContent = String(week());
  $("rankPill").textContent = rankName();
  $("actionsLeft").textContent = `–•–æ–¥—ã: ${S.actionsLeft}/3`;

  $("money").textContent = rub(S.money);
  $("bank").textContent = rub(S.bank);
  $("debt").textContent = rub(S.debt);
  $("energy").textContent = String(S.energy);

  $("lvl").textContent = String(S.lvl);
  $("skill").textContent = String(S.skill);

  $("netWorth").textContent = `–ö–∞–ø–∏—Ç–∞–ª: ${rub(netWorth())}`;

  const homeName = ["–∞—Ä–µ–Ω–¥–∞","–∫–æ–º–Ω–∞—Ç–∞","–∫–≤–∞—Ä—Ç–∏—Ä–∞","–¥–æ–º"][S.homeLevel] || "–∞—Ä–µ–Ω–¥–∞";
  $("homeSmall").textContent = homeName;

  // bars
  $("energyBar").style.width = `${Math.round((S.energy/100)*100)}%`;
  $("xpBar").style.width = `${Math.round((S.xp / S.xpNeed)*100)}%`;
  $("xpText").textContent = `${S.xp}/${S.xpNeed}`;

  // economy hint
  $("economyHint").textContent = `–†–∞—Å—Ö–æ–¥/–Ω–µ–¥: ${rub(weeklyCosts())} ‚Ä¢ –ü–∞—Å—Å–∏–≤/–Ω–µ–¥: ${rub(passiveIncome())} ‚Ä¢ %/–¥–µ–Ω—å: ${rub(dailyDebtInterest())}`;

  // log
  const ul = $("log");
  ul.innerHTML="";
  S.log.forEach(x=>{
    const li = document.createElement("li");
    li.innerHTML = x.type==="good" ? `‚úÖ <span class="good">${escapeHtml(x.t)}</span>`
      : x.type==="bad" ? `‚ö†Ô∏è <span class="bad">${escapeHtml(x.t)}</span>`
      : x.type==="warn"? `üí≥ <span class="warn">${escapeHtml(x.t)}</span>`
      : `‚Ä¢ ${escapeHtml(x.t)}`;
    ul.appendChild(li);
  });

  renderInventory();
  renderAchievements();
  renderScreen();
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ---------- Events ---------- */
$("tabs").addEventListener("click",(e)=>{
  const b = e.target.closest("[data-tab]");
  if(!b) return;
  setTab(b.getAttribute("data-tab"));
});

$("nextDayBtn").onclick = nextDay;
$("saveBtn").onclick = ()=>{ save(); toast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ üíæ","good"); };
$("resetBtn").onclick = ()=>{
  openModal("–°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ ‚ôªÔ∏è","–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.",[
    {text:"–°–±—Ä–æ—Å–∏—Ç—å", kind:"danger", onClick:()=>{
      localStorage.removeItem(KEY);
      S = defaultState();
      save();
      toast("–°–±—Ä–æ—à–µ–Ω–æ","warn");
      render();
      setTab("home");
    }},
    {text:"–û—Ç–º–µ–Ω–∞", kind:"ghost", onClick:()=>{}}
  ]);
};

/* ---------- Init ---------- */
render();
</script>
</body>
</html>
