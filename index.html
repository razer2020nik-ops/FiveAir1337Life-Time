<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>FiveAir1337Life-Time ‚Äî Life Simulator</title>

  <style>
    :root{
      /* neon glass theme */
      --bg0:#05070b;
      --bg1:#070a10;
      --panel: rgba(10, 14, 22, .66);
      --panel2: rgba(10, 14, 22, .52);
      --line: rgba(120, 180, 255, .16);

      --text:#EAF3FF;
      --muted:#A9BCD6;

      --a:#00E5FF;     /* cyan */
      --a2:#7C4DFF;    /* purple */
      --g:#40D27A;
      --r:#FF5C5C;
      --w:#FFCC66;

      --r1:18px;
      --r2:14px;
      --shadow: 0 22px 60px rgba(0,0,0,.55);
      --shadow2: 0 14px 34px rgba(0,0,0,.42);

      --t: 220ms;
      --e: cubic-bezier(.2,.9,.2,1);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 700px at 18% 0%, rgba(0,229,255,.22), transparent 55%),
        radial-gradient(1000px 620px at 86% 12%, rgba(124,77,255,.18), transparent 55%),
        radial-gradient(900px 500px at 40% 115%, rgba(64,210,122,.10), transparent 58%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    a{color:inherit;text-decoration:none}
    .wrap{max-width:1280px;margin:0 auto;padding:14px}

    /* topbar */
    .topbar{
      position:sticky;top:0;z-index:30;
      backdrop-filter: blur(14px);
      background: rgba(5,7,11,.72);
      border-bottom:1px solid var(--line);
    }
    .topbar-inner{
      max-width:1280px;margin:0 auto;
      padding:12px 14px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:250px}
    .logo{
      width:44px;height:44px;border-radius:16px;
      display:grid;place-items:center;
      background: linear-gradient(135deg, rgba(0,229,255,.95), rgba(124,77,255,.72));
      color:#021019;
      font-weight:1000;
      letter-spacing:.5px;
      box-shadow: var(--shadow2);
      user-select:none;
    }
    .brand h1{margin:0;font-size:16px;line-height:1.15}
    .sub{margin-top:3px;color:var(--muted);font-size:12px}

    .top-actions{
      display:flex;align-items:center;justify-content:flex-end;
      gap:10px;flex-wrap:wrap;
    }
    .pill{
      font-size:12px;
      border:1px solid var(--line);
      background: rgba(10,14,22,.35);
      padding:7px 10px;border-radius:999px;
      color:var(--muted);
      display:flex;align-items:center;gap:8px;
      white-space:nowrap;
    }
    .dot{
      width:8px;height:8px;border-radius:50%;
      background: var(--a);
      box-shadow: 0 0 0 4px rgba(0,229,255,.10);
    }

    button{
      border:none;border-radius:14px;
      padding:11px 14px;
      font-weight:950;
      cursor:pointer;
      transition: transform var(--t) var(--e), filter var(--t) var(--e), background var(--t) var(--e);
    }
    .b-primary{
      background: linear-gradient(135deg, rgba(0,229,255,.95), rgba(124,77,255,.72));
      color:#021019;
      box-shadow: 0 14px 36px rgba(0,0,0,.25);
    }
    .b-ghost{
      background: rgba(10,14,22,.35);
      color: var(--text);
      border:1px solid var(--line);
    }
    .b-danger{
      background: rgba(255,92,92,.12);
      color: var(--r);
      border:1px solid rgba(255,92,92,.35);
    }
    button:hover{transform:translateY(-1px);filter:brightness(1.04)}
    button:active{transform:translateY(0px) scale(.99)}

    /* layout */
    .layout{
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 1020px){
      .layout{grid-template-columns:1fr}
      .brand{min-width:auto}
    }

    .card{
      background: linear-gradient(180deg, rgba(10,14,22,.72), rgba(10,14,22,.52));
      border:1px solid var(--line);
      border-radius: var(--r1);
      box-shadow: var(--shadow);
      padding:14px;
      position:relative;
      overflow:hidden;
    }
    .card::before{
      content:"";
      position:absolute;inset:-2px;
      background: radial-gradient(600px 300px at 10% 0%, rgba(0,229,255,.12), transparent 60%),
                  radial-gradient(500px 260px at 90% 20%, rgba(124,77,255,.10), transparent 60%);
      pointer-events:none;
    }
    .card > *{position:relative}

    .title{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px}
    .title h2{margin:0;font-size:16px}
    .muted{color:var(--muted);font-size:13px;line-height:1.55}
    .small{color:var(--muted);font-size:12px}
    .sep{height:1px;background: var(--line); margin:12px 0}
    .badge{
      font-size:12px;color:var(--muted);
      border:1px solid var(--line);
      background: rgba(10,14,22,.25);
      padding:6px 10px;border-radius:999px;
      white-space:nowrap;
    }
    .good{color:var(--g);font-weight:1000}
    .bad{color:var(--r);font-weight:1000}
    .warn{color:var(--w);font-weight:1000}
    .mono{font-family:var(--mono)}

    /* kpis */
    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .kpi{
      background: rgba(5,7,11,.22);
      border:1px solid var(--line);
      border-radius: var(--r2);
      padding:12px;
    }
    .kpi .lab{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:20px;font-weight:1000;margin-top:4px}
    .bar{
      height:10px;border-radius:999px;
      background: rgba(120,180,255,.10);
      overflow:hidden;margin-top:7px;
    }
    .bar > div{
      height:100%;width:0%;
      background: linear-gradient(90deg, var(--a), var(--a2));
      transition: width 420ms var(--e);
    }

    /* menu */
    .menu{display:grid;gap:8px}
    .tab{
      padding:12px;border-radius:14px;
      border:1px solid var(--line);
      background: rgba(5,7,11,.20);
      color:var(--text);
      text-align:left;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      transition: transform var(--t) var(--e), border-color var(--t) var(--e), background var(--t) var(--e);
    }
    .tab small{color:var(--muted);font-weight:700}
    .tab:hover{transform:translateY(-1px);border-color:rgba(0,229,255,.35)}
    .tab.active{
      background: rgba(0,229,255,.10);
      border-color: rgba(0,229,255,.45);
    }

    /* mobile city menu becomes compact */
    @media (max-width: 1020px){
      .menu{
        grid-template-columns:repeat(2, minmax(0,1fr));
      }
      .tab{padding:11px}
    }
    @media (max-width: 560px){
      .menu{grid-template-columns:1fr}
      .top-actions{gap:8px}
      .pill{padding:6px 9px}
      button{padding:10px 12px}
    }

    /* main */
    .main-grid{
      display:grid;
      grid-template-columns: 1.12fr .88fr;
      gap:14px;
    }
    @media (max-width: 1020px){
      .main-grid{grid-template-columns:1fr}
    }

    /* actions */
    .actions{display:grid;gap:10px}
    .action{
      background: rgba(5,7,11,.18);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      transition: transform var(--t) var(--e), border-color var(--t) var(--e);
    }
    .action:hover{transform:translateY(-1px);border-color:rgba(124,77,255,.30)}
    .action .row{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
    .action b{display:block;margin-bottom:4px}

    /* logs */
    .log{
      margin:0;padding:0;list-style:none;
      display:grid;gap:8px;
      max-height: 480px;
      overflow:auto;
      padding-right:4px;
    }
    .log li{
      background: rgba(5,7,11,.16);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px;
      font-size:13px;
      animation: pop 240ms var(--e) both;
    }
    @keyframes pop{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

    /* lists */
    .list{margin:0;padding:0;list-style:none;display:grid;gap:10px}
    .list li{
      background: rgba(5,7,11,.14);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }

    /* screen transition */
    .screen-inner{animation: fadeIn 260ms var(--e) both}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    /* slider ui */
    .sliderRow{
      display:flex;align-items:center;gap:10px;flex-wrap:wrap;
      border:1px solid var(--line);
      background: rgba(10,14,22,.25);
      border-radius:14px;
      padding:10px;
    }
    input[type="range"]{width:100%}
    input, select{
      width:100%;
      background: rgba(10,14,22,.35);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      color:var(--text);
      outline:none;
      transition:border-color var(--t) var(--e);
    }
    input:focus,select:focus{border-color: rgba(0,229,255,.40)}
    .row2{display:flex;gap:10px;flex-wrap:wrap}
    .row2>*{flex:1 1 160px}

    /* modal + toasts */
    .modal-backdrop{
      position:fixed;inset:0;z-index:100;
      background: rgba(0,0,0,.60);
      display:none;align-items:center;justify-content:center;
      padding:16px;
    }
    .modal-backdrop.open{display:flex}
    .modal{
      width:min(640px, 100%);
      background: linear-gradient(180deg, rgba(10,14,22,.92), rgba(10,14,22,.82));
      border:1px solid rgba(0,229,255,.22);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding:14px;
    }
    .modal h3{margin:0 0 6px}
    .close{
      float:right;
      background: rgba(10,14,22,.35);
      border:1px solid var(--line);
      color:var(--text);
      border-radius: 12px;
      padding:9px 12px;
      box-shadow:none;
    }

    .toasts{
      position:fixed;right:14px;bottom:14px;z-index:200;
      display:grid;gap:10px;
    }
    .toast{
      width:min(380px, calc(100vw - 28px));
      background: rgba(10,14,22,.92);
      border:1px solid rgba(124,77,255,.22);
      border-radius:16px;
      padding:12px;
      box-shadow: var(--shadow2);
      animation: toastIn 240ms var(--e) both;
      font-size:13px;
    }
    @keyframes toastIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .toast .t{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .toast .x{background:transparent;border:none;color:var(--muted);cursor:pointer;font-weight:900}

    footer{padding:18px 0 28px;color:var(--muted);text-align:center;font-size:12px}
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">5A</div>
        <div>
          <h1>FiveAir1337Life-Time</h1>
          <div class="sub">–Ω–µ–æ–Ω ‚Ä¢ –ø–ª–∞–≤–Ω–æ ‚Ä¢ –º–æ–±–∏–ª–∫–∞ ‚Ä¢ 100 —Ä–∞–±–æ—Ç ‚Ä¢ –ø–æ–≤–µ—Å—Ç–∫–∞ ‚Ä¢ –∫–ª–∞–Ω—ã ‚Ä¢ —Å–µ–º—å—è</div>
        </div>
      </div>
      <div class="top-actions">
        <div class="pill"><span class="dot"></span><span id="dayPill">–î–µ–Ω—å 1</span></div>
        <div class="pill">–ù–µ–¥–µ–ª—è: <b id="weekPill">1</b></div>
        <div class="pill">–†–∞–Ω–≥: <b id="rankPill">–ù–æ–≤–∏—á–æ–∫</b></div>
        <button class="b-primary" id="nextDayBtn">üìÖ –î–µ–Ω—å</button>
        <button class="b-ghost" id="saveBtn">üíæ</button>
        <button class="b-danger" id="resetBtn">‚ôªÔ∏è</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="layout">
      <!-- LEFT -->
      <aside class="card">
        <div class="title">
          <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
          <span class="badge" id="actionsLeft">–•–æ–¥—ã: 3/3</span>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="lab">üí∞ –ù–∞–ª–∏—á–Ω—ã–µ</div>
            <div class="val" id="money">0 ‚ÇΩ</div>
            <div class="small">—Ä–∞–±–æ—Ç–∞/–ø–æ–∫—É–ø–∫–∏</div>
          </div>
          <div class="kpi">
            <div class="lab">üè¶ –ë–∞–Ω–∫</div>
            <div class="val" id="bank">0 ‚ÇΩ</div>
            <div class="small">–¥–µ–ø–æ–∑–∏—Ç</div>
          </div>

          <div class="kpi">
            <div class="lab">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
            <div class="val" id="energy">100</div>
            <div class="bar"><div id="energyBar"></div></div>
          </div>

          <div class="kpi">
            <div class="lab">‚≠ê –£—Ä–æ–≤–µ–Ω—å</div>
            <div class="val"><span id="lvl">1</span> <span class="small mono">XP</span></div>
            <div class="bar"><div id="xpBar"></div></div>
            <div class="small"><span id="xpText">0/100</span></div>
          </div>

          <div class="kpi">
            <div class="lab">üß† –ù–∞–≤—ã–∫</div>
            <div class="val" id="skill">1</div>
            <div class="small">–æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—ã</div>
          </div>

          <div class="kpi">
            <div class="lab">üí≥ –î–æ–ª–≥</div>
            <div class="val" id="debt">0 ‚ÇΩ</div>
            <div class="small">–ø—Ä–æ—Ü–µ–Ω—Ç—ã/–¥–µ–Ω—å</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üó∫Ô∏è –ì–æ—Ä–æ–¥</h2>
          <span class="badge" id="netWorth">–ö–∞–ø–∏—Ç–∞–ª: 0 ‚ÇΩ</span>
        </div>

        <div class="menu" id="tabs">
          <button class="tab active" data-tab="home">üè† –î–æ–º <small id="homeSmall">–∞—Ä–µ–Ω–¥–∞</small></button>
          <button class="tab" data-tab="jobs">üíº –†–∞–±–æ—Ç—ã <small id="jobsSmall">–ø–æ–ª–∑—É–Ω–æ–∫</small></button>
          <button class="tab" data-tab="quests">üóø –ü–æ–≤–µ—Å—Ç–∫–∞ <small>–∫–≤–µ—Å—Ç—ã</small></button>
          <button class="tab" data-tab="study">üìë –û–±—É—á–µ–Ω–∏–µ <small>–Ω–∞–≤—ã–∫</small></button>
          <button class="tab" data-tab="biz">üöÄ –ë–∏–∑–Ω–µ—Å <small>–ø–∞—Å—Å–∏–≤</small></button>
          <button class="tab" data-tab="bank">üè¶ –ë–∞–Ω–∫ <small>–∫—Ä–µ–¥–∏—Ç—ã</small></button>
          <button class="tab" data-tab="shop">üè¨ –ú–∞–≥–∞–∑–∏–Ω <small>–±–∞—Ñ—ã</small></button>
          <button class="tab" data-tab="realty">üè¢ –ñ–∏–ª—å—ë <small>–∞—Ä–µ–Ω–¥–∞</small></button>
          <button class="tab" data-tab="crypto">üñ•üí∂ –ö—Ä–∏–ø—Ç–∞ <small>—Ä—ã–Ω–æ–∫</small></button>
          <button class="tab" data-tab="arena">ü§∫ –î—É—ç–ª—å <small>—Ä–∏—Å–∫</small></button>
          <button class="tab" data-tab="heist">ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ <small>–æ—á. —Ä–∏—Å–∫</small></button>
          <button class="tab" data-tab="family">üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è <small>–ó–ê–ì–°</small></button>
          <button class="tab" data-tab="clan">üõ° –ö–ª–∞–Ω <small>—Å–∫–ª–∞–¥</small></button>
          <button class="tab" data-tab="tops">Forbes üòéüíµ <small>—Ç–æ–ø—ã</small></button>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
          <span class="badge" id="invBadge">‚Äî</span>
        </div>
        <ul class="list" id="inventoryList"></ul>

        <div class="sep"></div>

        <div class="title">
          <h2>üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
          <span class="badge" id="achvBadge">0/0</span>
        </div>
        <ul class="list" id="achievements"></ul>
      </aside>

      <!-- RIGHT -->
      <main class="main-grid">
        <section class="card">
          <div class="screen-inner" id="screenRoot">
            <div class="title">
              <h2 id="screenTitle">üè† –î–æ–º</h2>
              <span class="badge" id="screenHint">‚Äî</span>
            </div>
            <div class="muted" id="screenDesc"></div>
            <div class="sep"></div>
            <div class="actions" id="screenActions"></div>
          </div>
        </section>

        <section class="card">
          <div class="title">
            <h2>üì∞ –°–æ–±—ã—Ç–∏—è</h2>
            <span class="badge" id="economyHint">‚Äî</span>
          </div>
          <ul class="log" id="log"></ul>
          <div class="sep"></div>
          <div class="small">üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ + –∫–Ω–æ–ø–∫–∞ üíæ. –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ</div>
        </section>
      </main>
    </div>

    <footer>¬© FiveAir1337Life-Time ‚Ä¢ Life Simulator</footer>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <button class="close" id="modalClose">‚úï</button>
      <h3 id="modalTitle">‚Äî</h3>
      <p class="muted" id="modalText">‚Äî</p>
      <div class="actions" id="modalActions"></div>
    </div>
  </div>

  <!-- TOASTS -->
  <div class="toasts" id="toasts"></div>

<script>
/* =========================
   FiveAir1337Life-Time v4
   - New neon UI + mobile
   - Jobs: slider pages (no long scroll)
   - Daily quests (–ü–æ–≤–µ—Å—Ç–∫–∞)
   ========================= */

const KEY = "fa_lifetime_v4";
const $ = (id)=>document.getElementById(id);

const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));
const rub=(n)=>Number(n||0).toLocaleString("ru-RU")+" ‚ÇΩ";
const escapeHtml=(s)=>String(s||"")
  .replaceAll("&","&amp;").replaceAll("<","&lt;")
  .replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;");

function toast(msg, type="info"){
  const box = $("toasts");
  const t = document.createElement("div");
  t.className="toast";
  t.innerHTML = `
    <div class="t">
      <div>${type==="good"?"‚úÖ":type==="bad"?"‚ö†Ô∏è":type==="warn"?"üí≥":"‚Ä¢"} ${escapeHtml(msg)}</div>
      <button class="x">‚úï</button>
    </div>
  `;
  t.querySelector(".x").onclick=()=>t.remove();
  box.appendChild(t);
  setTimeout(()=>{ if(t.isConnected) t.remove(); }, 4200);
}

function openModal(title, text, buttons=[]){
  $("modalTitle").textContent = title;
  $("modalText").textContent = text;
  const a = $("modalActions");
  a.innerHTML="";
  buttons.forEach(b=>{
    const btn = document.createElement("button");
    btn.className = b.kind==="danger" ? "b-danger"
                 : b.kind==="ghost"  ? "b-ghost"
                 : "b-primary";
    btn.textContent = b.text;
    btn.onclick = ()=>{ closeModal(); b.onClick && b.onClick(); };
    a.appendChild(btn);
  });
  $("modalBackdrop").classList.add("open");
}
function closeModal(){ $("modalBackdrop").classList.remove("open"); }
$("modalClose").onclick=closeModal;
$("modalBackdrop").addEventListener("click",(e)=>{ if(e.target.id==="modalBackdrop") closeModal(); });

/* ---------- 100 jobs ---------- */
function buildJobs(){
  const tiers = [
    {tier:1,  needLvl:1,  needSkill:1,  title:"–°—Ç–∞—Ä—Ç"},
    {tier:2,  needLvl:2,  needSkill:2,  title:"–ü—Ä–æ—Å—Ç–æ–π"},
    {tier:3,  needLvl:3,  needSkill:3,  title:"–û–ø—ã—Ç"},
    {tier:4,  needLvl:4,  needSkill:4,  title:"–£–≤–µ—Ä–µ–Ω–Ω—ã–π"},
    {tier:5,  needLvl:6,  needSkill:5,  title:"–ü—Ä–æ—Ñ–∏"},
    {tier:6,  needLvl:8,  needSkill:6,  title:"–°–∏–ª—å–Ω—ã–π"},
    {tier:7,  needLvl:10, needSkill:7,  title:"–≠–∫—Å–ø–µ—Ä—Ç"},
    {tier:8,  needLvl:12, needSkill:8,  title:"–¢–æ–ø"},
    {tier:9,  needLvl:14, needSkill:9,  title:"–≠–ª–∏—Ç–∞"},
    {tier:10, needLvl:16, needSkill:10, title:"–õ–µ–≥–µ–Ω–¥–∞"},
  ];
  const templates = [
    ["–ö—É—Ä—å–µ—Ä", "–ø–æ–¥—Ä–∞–±–æ—Ç–∫–∞"],
    ["–û–ø–µ—Ä–∞—Ç–æ—Ä", "–æ—Ñ–∏—Å"],
    ["–ü–æ–º–æ—â–Ω–∏–∫", "—Å–µ—Ä–≤–∏—Å"],
    ["–ú–µ–Ω–µ–¥–∂–µ—Ä", "–ø—Ä–æ–¥–∞–∂–∏"],
    ["–ú–æ–Ω—Ç–∞–∂—ë—Ä", "–∫–æ–Ω—Ç–µ–Ω—Ç"],
    ["–î–∏–∑–∞–π–Ω–µ—Ä", "–∫—Ä–µ–∞—Ç–∏–≤"],
    ["–í–µ—Ä—Å—Ç–∞–ª—å—â–∏–∫", "web"],
    ["–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫", "–∫–æ–¥"],
    ["–ú–∞—Ä–∫–µ—Ç–æ–ª–æ–≥", "—Ç—Ä–∞—Ñ–∏–∫"],
    ["–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", "—Ä—ã–Ω–æ–∫"],
  ];
  const jobs = [];
  for(const t of tiers){
    for(let i=0;i<10;i++){
      const [role, tag] = templates[i];
      const basePay = Math.floor(120 + t.tier*92 + i*20);
      const energy = clamp(18 + t.tier*3 + Math.floor(i/2), 18, 58);
      const risk = (i>=7 ? 0.22 : i>=4 ? 0.12 : 0.05) + t.tier*0.01;
      const xp = Math.floor(18 + t.tier*8 + i*2);
      jobs.push({
        id: `T${t.tier}-${i}`,
        tier: t.tier,
        name: `${role} ‚Ä¢ ${t.title} #${i+1}`,
        tag,
        needLvl: t.needLvl,
        needSkill: t.needSkill,
        basePay,
        energy,
        risk: clamp(risk, 0.03, 0.35),
        xp
      });
    }
  }
  return jobs;
}
const JOBS = buildJobs();

/* ---------- Achievements ---------- */
const ACH = [
  {id:"a1",  name:"üíº –ü–µ—Ä–≤–∞—è —Ä–∞–±–æ—Ç–∞", desc:"–í—ã–ø–æ–ª–Ω–∏ 1 —Ä–∞–±–æ—Ç—É", ok:S=>S.stats.jobsDone>=1},
  {id:"a2",  name:"‚≠ê –£—Ä–æ–≤–µ–Ω—å 5",     desc:"–î–æ—Å—Ç–∏–≥–Ω–∏ —É—Ä–æ–≤–Ω—è 5", ok:S=>S.lvl>=5},
  {id:"a3",  name:"üß† –ù–∞–≤—ã–∫ 5",       desc:"–ù–∞–≤—ã–∫ 5+", ok:S=>S.skill>=5},
  {id:"a4",  name:"üè¶ –î–µ–ø–æ–∑–∏—Ç",       desc:"–ë–∞–Ω–∫ 5 000 ‚ÇΩ+", ok:S=>S.bank>=5000},
  {id:"a5",  name:"üè¢ –ñ–∏–ª—å—ë",         desc:"–ö–æ–º–Ω–∞—Ç–∞ –∏–ª–∏ –≤—ã—à–µ", ok:S=>S.homeLevel>=1},
  {id:"a6",  name:"üöÄ –ë–∏–∑–Ω–µ—Å 3",      desc:"–ë–∏–∑–Ω–µ—Å 3+", ok:S=>S.biz>=3},
  {id:"a7",  name:"üñ•üí∂ –ö—Ä–∏–ø—Ç–∞",       desc:"–ö—É–ø–∏ –∫—Ä–∏–ø—Ç—É", ok:S=>S.crypto.coins>0},
  {id:"a8",  name:"ü§∫ –ü–æ–±–µ–¥–∞",        desc:"–í—ã–∏–≥—Ä–∞–π –¥—É—ç–ª—å", ok:S=>S.stats.duelsWin>=1},
  {id:"a9",  name:"ü™ì –†–∏—Å–∫–æ–≤–∞–Ω–Ω—ã–π",   desc:"–£—Å–ø–µ—à–Ω–æ–µ –æ–≥—Ä–∞–±–ª–µ–Ω–∏–µ", ok:S=>S.stats.heistsWin>=1},
  {id:"a10", name:"üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è",     desc:"–ù–∞–π–¥–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞", ok:S=>S.family.partner},
  {id:"a11", name:"üë´ –ó–ê–ì–°",          desc:"–û—Ñ–æ—Ä–º–∏ –±—Ä–∞–∫", ok:S=>S.family.married},
  {id:"a12", name:"üõ° –ö–ª–∞–Ω",          desc:"–°–æ–∑–¥–∞–π –∫–ª–∞–Ω", ok:S=>!!S.clan.name},
  {id:"a13", name:"üòéüíµ Forbes",      desc:"–ö–∞–ø–∏—Ç–∞–ª 200 000 ‚ÇΩ+", ok:S=>netWorth(S)>=200000},
];

/* ---------- State ---------- */
function defaultState(){
  return {
    day: 1,
    actionsLeft: 3,
    money: 900,
    bank: 0,
    debt: 0,
    energy: 100,

    lvl: 1,
    xp: 0,
    xpNeed: 100,

    skill: 1,
    biz: 0,

    homeLevel: 0,
    rentDueIn: 7,

    wanted: 0,
    safe: 0,

    inv: { food: 0, tech: 0, gear: 0, car: 0 },

    crypto: { price: 120, coins: 0 },

    family: { partner:false, married:false, kids:0 },

    clan: { name:"", level:0, storage:0 },

    // quests
    quests: { daySeed: 1, done: {q1:false,q2:false,q3:false} },

    stats: { jobsDone:0, duelsWin:0, duelsLose:0, heistsWin:0, heistsLose:0 },

    tops: { bestNW:0, bestCrypto:0, donations:0 },

    log: [{t:"–ì–æ—Ç–æ–≤–æ ‚úÖ UI –æ–±–Ω–æ–≤–ª—ë–Ω. –ó–∞–π–¥–∏ –≤ ¬´–†–∞–±–æ—Ç—ã¬ª ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–∞–º –ø–æ–ª–∑—É–Ω–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü, –±–µ–∑ –∞–¥—Å–∫–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏.", type:"good"}]
  };
}

function load(){
  try{ const v = localStorage.getItem(KEY); return v ? JSON.parse(v) : defaultState(); }
  catch(e){ return defaultState(); }
}
function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }

let S = load();
let currentTab = "home";

/* ---------- Helpers ---------- */
function week(){ return Math.floor((S.day-1)/7)+1; }

function netWorth(state=S){
  const cryptoVal = Math.floor(state.crypto.coins * state.crypto.price);
  const carVal = state.inv.car * 12000;
  const techVal = state.inv.tech * 2500;
  const homeVal = [0, 8000, 25000, 65000][state.homeLevel] || 0;
  const clanVal = state.clan.storage || 0;
  return Math.max(0, (state.money + state.bank + state.safe + cryptoVal + carVal + techVal + homeVal + clanVal) - state.debt);
}

const RANKS = [
  {name:"–ù–æ–≤–∏—á–æ–∫", nw:0},
  {name:"–†–∞–±–æ—Ç—è–≥–∞", nw:6000},
  {name:"–î–µ–ª–µ—Ü", nw:20000},
  {name:"–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", nw:55000},
  {name:"–ë–∏–∑–Ω–µ—Å–º–µ–Ω", nw:120000},
  {name:"Forbes üòéüíµ", nw:200000},
];
function rankName(){
  const nw = netWorth();
  let r = RANKS[0].name;
  for(const x of RANKS){ if(nw >= x.nw) r = x.name; }
  return r;
}

function weeklyCosts(){
  const base = 650 + (S.skill-1)*140;
  const homeMul = [1.0, 1.25, 1.55, 2.1][S.homeLevel] || 1.0;
  const fam = (S.family.partner ? 1.2 : 1.0) * (S.family.married ? 1.1 : 1.0) * (1 + S.family.kids*0.15);
  return Math.floor(base * homeMul * fam);
}
function passiveIncome(){
  const techB = Math.min(0.30, S.inv.tech * 0.03);
  const carB  = Math.min(0.25, S.inv.car * 0.05);
  const eff = 1 + techB + carB;
  // –º–∞–ª–µ–Ω—å–∫–∏–π –±–æ–Ω—É—Å –∑–∞ –±—Ä–∞–∫ (—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å)
  const familyB = S.family.married ? 1.05 : 1.0;
  return Math.floor((S.biz * (420 + S.skill*55)) * eff * familyB);
}
function dailyDebtInterest(){
  if(S.debt<=0) return 0;
  const k = 0.03 + Math.min(0.02, S.wanted*0.002);
  return Math.floor(S.debt * k);
}

function addXP(x){
  S.xp += x;
  while(S.xp >= S.xpNeed){
    S.xp -= S.xpNeed;
    S.lvl += 1;
    S.xpNeed = Math.floor(100 + (S.lvl-1)*35);
    const bonus = 250 + S.lvl*25;
    S.money += bonus;
    addLog(`–õ–ï–í–ï–õ –ê–ü ‚≠ê ${S.lvl} (–±–æ–Ω—É—Å +${rub(bonus)})`, "good");
    toast(`–û—Ç–∫—Ä—ã—Ç —É—Ä–æ–≤–µ–Ω—å ${S.lvl}!`, "good");
  }
}
function addLog(text, type="info"){
  S.log.unshift({t:text, type});
  if(S.log.length>90) S.log.pop();
  save(); render();
}
function useAction(energyCost){
  if(S.actionsLeft<=0){ addLog("–•–æ–¥–æ–≤ –Ω–µ—Ç. –ñ–º–∏ ¬´–î–µ–Ω—å¬ª.","bad"); return false; }
  if(S.energy<energyCost){ addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏. –ö—É–ø–∏ –µ–¥—É/–æ—Ç–¥–æ—Ö–Ω–∏.","bad"); return false; }
  S.actionsLeft -= 1;
  S.energy = clamp(S.energy - energyCost, 0, 100);
  return true;
}

/* ---------- Crypto ---------- */
function nextCryptoPrice(){
  const change = (Math.random()*0.22 - 0.10);
  S.crypto.price = Math.max(20, Math.floor(S.crypto.price*(1+change)));
}

/* ---------- Quests (–ü–æ–≤–µ—Å—Ç–∫–∞) ---------- */
function ensureDailyQuests(){
  if(S.quests.daySeed !== S.day){
    S.quests.daySeed = S.day;
    S.quests.done = {q1:false,q2:false,q3:false};
    addLog("–ü–æ–≤–µ—Å—Ç–∫–∞ –æ–±–Ω–æ–≤–∏–ª–∞—Å—å üóø (–Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è).", "info");
  }
}
function questsStatus(){
  // 3 –ø—Ä–æ—Å—Ç—ã—Ö –∫–≤–µ—Å—Ç–∞
  const q1 = {id:"q1", name:"–°–¥–µ–ª–∞–π 2 —Ä–∞–±–æ—Ç—ã", desc:"–í—ã–ø–æ–ª–Ω–∏ 2 —Ä–∞–±–æ—Ç—ã –∑–∞ –¥–µ–Ω—å", reward: ()=>({money:600,xp:35}),
    ok: ()=> (S.stats.jobsDoneToday||0) >= 2
  };
  const q2 = {id:"q2", name:"–£—á—ë–±–∞ 1 —Ä–∞–∑", desc:"–ó–∞–π–º–∏—Å—å –æ–±—É—á–µ–Ω–∏–µ–º 1 —Ä–∞–∑", reward: ()=>({money:350,xp:30}),
    ok: ()=> (S.stats.studyToday||0) >= 1
  };
  const q3 = {id:"q3", name:"–ù–µ –≤–ª–µ–∑–∞–π –≤ –¥–æ–ª–≥", desc:"–ó–∞–∫–æ–Ω—á–∏—Ç—å –¥–µ–Ω—å –±–µ–∑ –Ω–æ–≤–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–∞", reward: ()=>({money:250,xp:25}),
    ok: ()=> (S.stats.loanToday||0) === 0
  };
  return [q1,q2,q3];
}
function claimQuest(q){
  if(S.quests.done[q.id]) return toast("–£–∂–µ –∑–∞–±—Ä–∞–Ω–æ", "warn");
  if(!q.ok()) return toast("–£—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã", "bad");
  const r = q.reward();
  S.money += r.money;
  addXP(r.xp);
  S.quests.done[q.id] = true;
  addLog(`–ü–æ–≤–µ—Å—Ç–∫–∞: –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ "${q.name}" +${rub(r.money)} –∏ XP +${r.xp}`, "good");
  toast("–ù–∞–≥—Ä–∞–¥–∞ –ø–æ–ª—É—á–µ–Ω–∞!", "good");
  save(); render();
}

/* ---------- UI ---------- */
function setTab(tab){
  currentTab = tab;
  document.querySelectorAll(".tab").forEach(b=>{
    b.classList.toggle("active", b.getAttribute("data-tab")===tab);
  });
  const root = $("screenRoot");
  root.classList.remove("screen-inner"); void root.offsetWidth; root.classList.add("screen-inner");
  renderScreen();
}

function actionCard({title, text, cost, btnText, onClick, extraHTML="", disabled=false}){
  const w = document.createElement("div");
  w.className="action";
  w.innerHTML = `
    <div class="row">
      <div style="min-width:0">
        <b>${title}</b>
        <div class="muted">${text}</div>
        <div class="small" style="margin-top:6px">${cost}</div>
        ${extraHTML ? `<div style="margin-top:10px">${extraHTML}</div>` : ""}
      </div>
      <button class="${disabled ? "b-ghost" : "b-primary"}" ${disabled?"disabled":""} style="${disabled?"opacity:.55;cursor:not-allowed":""}">
        ${btnText}
      </button>
    </div>
  `;
  const btn = w.querySelector("button");
  if(!disabled) btn.onclick = onClick;
  return w;
}

function screenTemplate(title, desc, hint, actions){
  $("screenTitle").textContent = title;
  $("screenDesc").innerHTML = desc;
  $("screenHint").textContent = hint;
  const box = $("screenActions");
  box.innerHTML="";
  actions.forEach(a=>box.appendChild(a));
}

/* ---------- JOBS: slider pages (no endless scroll) ---------- */
const JOBS_PER_PAGE = 6;
let jobsTierFilter = "all";
let jobsSort = "pay";
let jobsPage = 1;

function jobsUnlockedCount(){
  return JOBS.filter(j => S.lvl>=j.needLvl && S.skill>=j.needSkill).length;
}
function jobsFilteredSorted(){
  let items = JOBS.slice();
  if(jobsTierFilter !== "all") items = items.filter(j=>String(j.tier)===jobsTierFilter);
  items.sort((a,b)=>{
    if(jobsSort==="pay") return (b.basePay - a.basePay);
    if(jobsSort==="risk") return (a.risk - b.risk);
    if(jobsSort==="energy") return (a.energy - b.energy);
    return 0;
  });
  return items;
}
function jobsTotalPages(items){
  return Math.max(1, Math.ceil(items.length / JOBS_PER_PAGE));
}
function jobsPageSlice(items){
  const total = jobsTotalPages(items);
  jobsPage = clamp(jobsPage, 1, total);
  const start = (jobsPage-1)*JOBS_PER_PAGE;
  return {slice: items.slice(start, start+JOBS_PER_PAGE), total};
}

function doJob(job){
  if(!useAction(job.energy)) return;

  const techB = Math.min(0.30, S.inv.tech*0.03);
  const carB  = Math.min(0.25, S.inv.car*0.05);
  const bonus = 1 + techB + carB;
  const pay = Math.floor(job.basePay * bonus);

  const fail = Math.random() < job.risk;
  if(fail){
    const got = Math.floor(pay * 0.35);
    S.money += got;
    addXP(Math.floor(job.xp * 0.50));
    addLog(`–†–∞–±–æ—Ç–∞ –Ω–µ –∑–∞–¥–∞–ª–∞—Å—å üòµ (${job.name}) +${rub(got)} ‚Ä¢ XP +${Math.floor(job.xp*0.5)}`, "bad");
    toast("–ü—Ä–æ–≤–∞–ª —Ä–∞–±–æ—Ç—ã", "warn");
  } else {
    S.money += pay;
    addXP(job.xp);
    addLog(`–†–∞–±–æ—Ç–∞: ${job.name} +${rub(pay)} ‚Ä¢ XP +${job.xp}`, "good");
  }

  S.stats.jobsDone += 1;
  S.stats.jobsDoneToday = (S.stats.jobsDoneToday||0) + 1;

  if(Math.random() < 0.08){
    S.skill += 1;
    addLog(`–ù–∞–≤—ã–∫ –≤—ã—Ä–æ—Å üß† ‚Üí ${S.skill}`, "good");
    toast("–ù–∞–≤—ã–∫ +1", "good");
  }

  save(); render();
  renderScreen(); // —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏–ª—Å—è —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü
}

/* ---------- Screens ---------- */
function renderScreen(){
  ensureDailyQuests();

  const actions=[];
  const nw = netWorth();
  const wkCost = weeklyCosts();
  const pass = passiveIncome();
  const debtInt = dailyDebtInterest();

  if(currentTab==="home"){
    const homeName = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"][S.homeLevel] || "–ê—Ä–µ–Ω–¥–∞";

    actions.push(actionCard({
      title:"üçé –°—ä–µ—Å—Ç—å –µ–¥—É",
      text:"–ï–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é.",
      cost:"–•–æ–¥ -1 ‚Ä¢ 1√ó–ï–¥–∞ ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è +30",
      btnText:"–°—ä–µ—Å—Ç—å",
      disabled: S.inv.food<=0,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤.","bad");
        if(S.inv.food<=0) return addLog("–ï–¥—ã –Ω–µ—Ç. –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ üè¨","bad");
        S.actionsLeft-=1;
        S.inv.food-=1;
        S.energy = clamp(S.energy+30, 0, 100);
        addLog("–¢—ã –ø–æ–µ–ª üçé –≠–Ω–µ—Ä–≥–∏—è +30.", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üõå –û—Ç–¥—ã—Ö",
      text:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏–ª—ã.",
      cost:"–•–æ–¥ -1 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è +45",
      btnText:"–û—Ç–¥—ã—Ö–∞—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤.","bad");
        S.actionsLeft-=1;
        S.energy=clamp(S.energy+45,0,100);
        addLog("–û—Ç–¥—ã—Ö üõå –≠–Ω–µ—Ä–≥–∏—è +45.", "good");
        save(); render();
      }
    }));

    actions.push(actionCard({
      title:"üí∏ –ö–æ–ø–∏–ª–∫–∞",
      text:"–ü–µ—Ä–µ–≤–µ—Å—Ç–∏/—Å–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏ (–≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–µ).",
      cost:`–ö–æ–ø–∏–ª–∫–∞ —Å–µ–π—á–∞—Å: <b class="mono">${rub(S.safe)}</b>`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>{
        openModal("–ö–æ–ø–∏–ª–∫–∞ üí∏","–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ:",[
          {text:"+500", kind:"primary", onClick:()=>safeMove(+500)},
          {text:"+1000", kind:"primary", onClick:()=>safeMove(+1000)},
          {text:"–°–Ω—è—Ç—å 500", kind:"ghost", onClick:()=>safeMove(-500)},
          {text:"–°–Ω—è—Ç—å 1000", kind:"ghost", onClick:()=>safeMove(-1000)},
        ]);
      }
    }));

    function safeMove(v){
      if(v>0){
        if(S.money < v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö", "bad");
        S.money -= v; S.safe += v;
        addLog(`–ö–æ–ø–∏–ª–∫–∞: +${rub(v)}`, "good");
      }else{
        const x = Math.abs(v);
        if(S.safe < x) return toast("–í –∫–æ–ø–∏–ª–∫–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç", "bad");
        S.safe -= x; S.money += x;
        addLog(`–ö–æ–ø–∏–ª–∫–∞: —Å–Ω—è—Ç–∏–µ -${rub(x)}`, "good");
      }
      save(); render();
    }

    screenTemplate(
      "üè† –î–æ–º",
      `–ö–∞–ø–∏—Ç–∞–ª: <b class="good">${rub(nw)}</b> ‚Ä¢ –†–∞—Å—Ö–æ–¥/–Ω–µ–¥: <b class="bad">${rub(wkCost)}</b> ‚Ä¢ –ü–∞—Å—Å–∏–≤/–Ω–µ–¥: <b class="good">${rub(pass)}</b> ‚Ä¢ %/–¥–µ–Ω—å: <b class="warn">${rub(debtInt)}</b>`,
      `${homeName} ‚Ä¢ –†–æ–∑—ã—Å–∫: ${S.wanted}`,
      actions
    );
    return;
  }

  if(currentTab==="jobs"){
    const unlocked = jobsUnlockedCount();
    const items = jobsFilteredSorted();
    const {slice, total} = jobsPageSlice(items);

    const top = document.createElement("div");
    top.className="action";
    top.innerHTML = `
      <div style="display:grid;gap:10px">
        <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:12px">
          <div>
            <b>üíº –†–∞–±–æ—Ç—ã (100) ‚Äî –±–µ–∑ –¥–ª–∏–Ω–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ ‚úÖ</b>
            <div class="muted">–î–æ—Å—Ç—É–ø–Ω–æ: <b class="good">${unlocked}</b> / ${JOBS.length}. –§–∏–ª—å—Ç—Ä/—Å–æ—Ä—Ç + –ø–æ–ª–∑—É–Ω–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü.</div>
          </div>
          <button class="b-ghost" id="jobsHelp">?</button>
        </div>

        <div class="row2">
          <select id="jobTier">
            <option value="all">–í—Å–µ —Ç–∏—Ä—ã</option>
            ${[1,2,3,4,5,6,7,8,9,10].map(t=>`<option value="${t}">–¢–∏—Ä ${t}</option>`).join("")}
          </select>

          <select id="jobSort">
            <option value="pay">–°–æ—Ä—Ç: –¥–æ—Ö–æ–¥</option>
            <option value="risk">–°–æ—Ä—Ç: —Ä–∏—Å–∫</option>
            <option value="energy">–°–æ—Ä—Ç: —ç–Ω–µ—Ä–≥–∏—è</option>
          </select>
        </div>

        <div class="sliderRow">
          <button class="b-ghost" id="prevPage">‚óÄ</button>
          <div class="badge" style="min-width:120px;text-align:center">–°—Ç—Ä. <b id="pageNum">${jobsPage}</b> / <b id="pageTotal">${total}</b></div>
          <button class="b-ghost" id="nextPage">‚ñ∂</button>
          <div style="flex:1 1 220px">
            <input id="pageSlider" type="range" min="1" max="${total}" value="${jobsPage}" />
            <div class="small">–¥–≤–∏–≥–∞–π –ø–æ–ª–∑—É–Ω–æ–∫ ‚Äî –ª–∏—Å—Ç–∞–π —Ä–∞–±–æ—Ç—ã</div>
          </div>
        </div>
      </div>
    `;
    actions.push(top);

    const list = document.createElement("div");
    list.className="actions";
    slice.forEach(j=>{
      const ok = (S.lvl>=j.needLvl && S.skill>=j.needSkill);
      const techB = Math.min(0.30, S.inv.tech*0.03);
      const carB  = Math.min(0.25, S.inv.car*0.05);
      const pay = Math.floor(j.basePay * (1 + techB + carB));
      const riskPct = Math.round(j.risk*100);

      list.appendChild(actionCard({
        title:`${ok ? "‚úÖ" : "üîí"} ${j.name}`,
        text:`–¢–∏—Ä ${j.tier} ‚Ä¢ ${j.tag} ‚Ä¢ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: ‚≠ê${j.needLvl}+ –∏ üß†${j.needSkill}+`,
        cost:`–≠–Ω–µ—Ä–≥–∏—è: -${j.energy} ‚Ä¢ –î–æ—Ö–æ–¥: ~${rub(pay)} ‚Ä¢ –†–∏—Å–∫: ${riskPct}% ‚Ä¢ XP: +${j.xp}`,
        btnText: ok ? "–†–∞–±–æ—Ç–∞—Ç—å" : "–ó–∞–∫—Ä—ã—Ç–æ",
        disabled: !ok,
        onClick: ()=>doJob(j)
      }));
    });
    actions.push(list);

    screenTemplate(
      "üíº –†–∞–±–æ—Ç—ã",
      `–£—Ä–æ–≤–µ–Ω—å: <b>${S.lvl}</b> ‚Ä¢ –ù–∞–≤—ã–∫: <b>${S.skill}</b> ‚Ä¢ –•–æ–¥—ã: <b>${S.actionsLeft}</b> ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: <b>${S.energy}</b>`,
      "–õ–∏—Å—Ç–∞–π —Ä–∞–±–æ—Ç—ã –ø–æ–ª–∑—É–Ω–∫–æ–º",
      actions
    );

    // bind controls
    setTimeout(()=>{
      const tier = document.getElementById("jobTier");
      const sort = document.getElementById("jobSort");
      const slider = document.getElementById("pageSlider");
      const prev = document.getElementById("prevPage");
      const next = document.getElementById("nextPage");
      const help = document.getElementById("jobsHelp");

      if(tier){ tier.value = jobsTierFilter; tier.onchange = ()=>{ jobsTierFilter = tier.value; jobsPage = 1; renderScreen(); }; }
      if(sort){ sort.value = jobsSort; sort.onchange = ()=>{ jobsSort = sort.value; jobsPage = 1; renderScreen(); }; }
      if(slider){ slider.oninput = ()=>{ jobsPage = Number(slider.value); renderScreen(); }; }
      if(prev){ prev.onclick = ()=>{ jobsPage = Math.max(1, jobsPage-1); renderScreen(); }; }
      if(next){ next.onclick = ()=>{ jobsPage = Math.min(total, jobsPage+1); renderScreen(); }; }
      if(help){
        help.onclick = ()=>openModal("–†–∞–±–æ—Ç—ã üíº",
          "–¢–µ–ø–µ—Ä—å –Ω–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏: —Ñ–∏–ª—å—Ç—Ä/—Å–æ—Ä—Ç + –ø–æ–ª–∑—É–Ω–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü. –ß–µ–º –≤—ã—à–µ —É—Ä–æ–≤–µ–Ω—å/–Ω–∞–≤—ã–∫ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ –æ—Ç–∫—Ä—ã—Ç–æ.",
          [{text:"–û–∫", kind:"primary", onClick:()=>{}}]
        );
      }
    },0);

    return;
  }

  if(currentTab==="quests"){
    const qs = questsStatus();

    const host = document.createElement("div");
    host.className="actions";

    qs.forEach(q=>{
      const done = !!S.quests.done[q.id];
      const ok = q.ok();
      const rew = q.reward();
      host.appendChild(actionCard({
        title:`üóø ${q.name} ${done ? "‚úÖ" : ""}`,
        text:q.desc,
        cost:`–ù–∞–≥—Ä–∞–¥–∞: +${rub(rew.money)} –∏ XP +${rew.xp}`,
        btnText: done ? "–ó–∞–±—Ä–∞–Ω–æ" : (ok ? "–ó–∞–±—Ä–∞—Ç—å" : "–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ"),
        disabled: done || !ok,
        onClick: ()=>claimQuest(q)
      }));
    });

    screenTemplate(
      "üóø –ü–æ–≤–µ—Å—Ç–∫–∞ (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)",
      "–ö–∞–∂–¥—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è. –î–µ–ª–∞–π –∏—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–æ—Å—Ç–∞ üí•",
      "–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å",
      [host]
    );
    return;
  }

  /* –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±–∞–∑–æ–≤—ã–µ (–∫–æ—Ä–æ—Ç–∫–æ), —á—Ç–æ–±—ã –Ω–µ —Ä–∞–∑–¥—É–≤–∞—Ç—å –∫–æ–¥.
     –û–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚Äî –≥–ª–∞–≤–Ω–æ–µ: UI+—Ä–∞–±–æ—Ç—ã+–º–æ–±–∏–ª–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. */

  if(currentTab==="study"){
    actions.push(actionCard({
      title:"üìë –£—á—ë–±–∞",
      text:"–î–∞—Å—Ç XP –∏ —à–∞–Ω—Å –ø–æ–¥–Ω—è—Ç—å –Ω–∞–≤—ã–∫.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è -25 ‚Ä¢ XP +40 ‚Ä¢ –®–∞–Ω—Å –ù–∞–≤—ã–∫ +1",
      btnText:"–£—á–∏—Ç—å—Å—è",
      onClick: ()=>{
        if(!useAction(25)) return;
        S.stats.studyToday = (S.stats.studyToday||0)+1;
        addXP(40);
        if(Math.random()<0.45){ S.skill += 1; addLog(`–£—á—ë–±–∞: –Ω–∞–≤—ã–∫ ‚Üí ${S.skill}`, "good"); toast("–ù–∞–≤—ã–∫ +1", "good"); }
        else addLog("–£—á—ë–±–∞: XP –ø–æ–ª—É—á–µ–Ω.", "info");
        save(); render();
      }
    }));
    screenTemplate("üìë –û–±—É—á–µ–Ω–∏–µ","–ö–∞—á–∞–π –Ω–∞–≤—ã–∫ –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–±–æ—Ç.","–£—á—ë–±–∞ = —É—Å–∫–æ—Ä–µ–Ω–∏–µ",actions);
    return;
  }

  if(currentTab==="biz"){
    const price = 1500*(S.biz+1);
    actions.push(actionCard({
      title:"üöÄ –£–ª—É—á—à–∏—Ç—å –±–∏–∑–Ω–µ—Å",
      text:"–î–∞—Å—Ç –ø–∞—Å—Å–∏–≤ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é.",
      cost:`–¶–µ–Ω–∞ ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è -30 ‚Ä¢ –ë–∏–∑–Ω–µ—Å +1`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      onClick: ()=>{
        if(!useAction(30)) return;
        if(S.money<price){ S.actionsLeft+=1; S.energy=clamp(S.energy+30,0,100); return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥.","bad"); }
        S.money-=price; S.biz+=1; addXP(30);
        addLog(`–ë–∏–∑–Ω–µ—Å ‚Üí ${S.biz}`, "good");
        save(); render();
      }
    }));
    screenTemplate("üöÄ –ë–∏–∑–Ω–µ—Å",`–ü–∞—Å—Å–∏–≤/–Ω–µ–¥: <b class="good">${rub(passiveIncome())}</b>`,`–£—Ä–æ–≤–µ–Ω—å: ${S.biz}`,actions);
    return;
  }

  if(currentTab==="bank"){
    actions.push(actionCard({
      title:"üè¶ –î–µ–ø–æ–∑–∏—Ç",
      text:"–ü–æ–ª–æ–∂–∏—Ç—å/—Å–Ω—è—Ç—å –¥–µ–Ω—å–≥–∏.",
      cost:`–ë–∞–Ω–∫: ${rub(S.bank)}`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>openModal("–ë–∞–Ω–∫ üè¶","–í—ã–±–µ—Ä–∏:",[
        {text:"+1000", kind:"primary", onClick:()=>bankMove(+1000)},
        {text:"+5000", kind:"primary", onClick:()=>bankMove(+5000)},
        {text:"–°–Ω—è—Ç—å 1000", kind:"ghost", onClick:()=>bankMove(-1000)},
        {text:"–°–Ω—è—Ç—å 5000", kind:"ghost", onClick:()=>bankMove(-5000)},
      ])
    }));
    actions.push(actionCard({
      title:"üí≥ –ö—Ä–µ–¥–∏—Ç",
      text:"–ü—Ä–æ—Ü–µ–Ω—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (–∏–≥—Ä–æ–≤–æ–µ).",
      cost:`–î–æ–ª–≥: ${rub(S.debt)} ‚Ä¢ %/–¥–µ–Ω—å: ${rub(dailyDebtInterest())}`,
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>openModal("–ö—Ä–µ–¥–∏—Ç üí≥","–í—ã–±–µ—Ä–∏:",[
        {text:"–í–∑—è—Ç—å 2000", kind:"primary", onClick:()=>loan(+2000)},
        {text:"–í–∑—è—Ç—å 10000", kind:"primary", onClick:()=>loan(+10000)},
        {text:"–ü–æ–≥–∞—Å–∏—Ç—å 500", kind:"ghost", onClick:()=>loan(-500)},
        {text:"–ü–æ–≥–∞—Å–∏—Ç—å 2000", kind:"ghost", onClick:()=>loan(-2000)},
      ])
    }));
    function bankMove(v){
      if(v>0){ if(S.money<v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad"); S.money-=v; S.bank+=v; addLog(`–ë–∞–Ω–∫: +${rub(v)}`,"good"); }
      else{ const x=Math.abs(v); if(S.bank<x) return toast("–í –±–∞–Ω–∫–µ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç","bad"); S.bank-=x; S.money+=x; addLog(`–ë–∞–Ω–∫: —Å–Ω—è—Ç–∏–µ -${rub(x)}`,"good");}
      save(); render();
    }
    function loan(v){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
      if(v>0){
        S.actionsLeft-=1;
        S.money+=v;
        S.stats.loanToday = (S.stats.loanToday||0)+1;
        const add = Math.floor(v*1.10);
        S.debt+=add;
        addLog(`–ö—Ä–µ–¥–∏—Ç: +${rub(v)} (–¥–æ–ª–≥ +${rub(add)})`,"warn");
      } else {
        const x=Math.abs(v);
        if(S.money<x) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
        if(S.debt<=0) return toast("–î–æ–ª–≥–æ–≤ –Ω–µ—Ç","good");
        S.actionsLeft-=1;
        S.money-=x;
        S.debt=Math.max(0,S.debt-x);
        addLog(`–ü–æ–≥–∞—à–µ–Ω–∏–µ: -${rub(x)} (–¥–æ–ª–≥ ${rub(S.debt)})`,"good");
      }
      save(); render();
    }
    screenTemplate("üè¶ –ë–∞–Ω–∫","–î–µ–ø–æ–∑–∏—Ç—ã –∏ –∫—Ä–µ–¥–∏—Ç—ã.","–ë—É–¥—å –∞–∫–∫—É—Ä–∞—Ç–µ–Ω —Å –¥–æ–ª–≥–∞–º–∏",actions);
    return;
  }

  if(currentTab==="shop"){
    actions.push(actionCard({
      title:"üçé –ï–¥–∞",
      text:"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–Ω–µ—Ä–≥–∏–∏ –¥–æ–º–∞.",
      cost:"–¶–µ–Ω–∞ 150 ‚ÇΩ ‚Ä¢ +1 –µ–¥–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<150) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 150 ‚ÇΩ","bad");
        S.actionsLeft-=1; S.money-=150; S.inv.food+=1;
        addLog("–ö—É–ø–∏–ª –µ–¥—É üçé","good"); save(); render();
      }
    }));
    actions.push(actionCard({
      title:"üñ• –¢–µ—Ö–Ω–∏–∫–∞",
      text:"–ë–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥–∞–º/–ø–∞—Å—Å–∏–≤—É (–¥–æ 30%).",
      cost:"–¶–µ–Ω–∞ 2500 ‚ÇΩ ‚Ä¢ +1 —Ç–µ—Ö–Ω–∏–∫–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<2500) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 2500 ‚ÇΩ","bad");
        S.actionsLeft-=1; S.money-=2500; S.inv.tech+=1;
        addLog("–ö—É–ø–∏–ª —Ç–µ—Ö–Ω–∏–∫—É üñ•","good"); save(); render();
      }
    }));
    screenTemplate("üè¨ –ú–∞–≥–∞–∑–∏–Ω","–ü–æ–∫—É–ø–∫–∏. –ï–¥–∞ = —ç–Ω–µ—Ä–≥–∏—è, —Ç–µ—Ö–Ω–∏–∫–∞ = –±—É—Å—Ç.","",actions);
    return;
  }

  if(currentTab==="realty"){
    const names=["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"];
    const nextLvl=Math.min(3,S.homeLevel+1);
    const price=[0,8000,17000,40000][nextLvl]||0;

    actions.push(actionCard({
      title:"üè¢ –£–ª—É—á—à–∏—Ç—å –∂–∏–ª—å—ë",
      text:`–°–µ–π—á–∞—Å: ${names[S.homeLevel]} ‚Üí –°–ª–µ–¥—É—é—â–µ–µ: ${names[nextLvl]}`,
      cost:`–¶–µ–Ω–∞ ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è -25`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      disabled: nextLvl===S.homeLevel,
      onClick: ()=>{
        if(!useAction(25)) return;
        if(S.money<price){ S.actionsLeft+=1; S.energy=clamp(S.energy+25,0,100); return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥","bad"); }
        S.money-=price; S.homeLevel=nextLvl; S.rentDueIn=Math.min(21,S.rentDueIn+3); addXP(35);
        addLog(`–ñ–∏–ª—å—ë: ${names[S.homeLevel]}`,"good"); save(); render();
      }
    }));
    screenTemplate("üè¢ –ñ–∏–ª—å—ë","–ñ–∏–ª—å—ë –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã, –Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª.","–î–æ –æ–ø–ª–∞—Ç—ã: "+S.rentDueIn+" –¥–Ω",actions);
    return;
  }

  if(currentTab==="crypto"){
    actions.push(actionCard({
      title:"üñ•üí∂ –ö—Ä–∏–ø—Ç–∞",
      text:`–¶–µ–Ω–∞: ${rub(S.crypto.price)} ‚Ä¢ –ú–æ–Ω–µ—Ç: ${S.crypto.coins}`,
      cost:"–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ —Ç—Ä–∞—Ç–∏—Ç 1 —Ö–æ–¥",
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      onClick: ()=>openModal("–ö—Ä–∏–ø—Ç–∞ üñ•üí∂","–í—ã–±–µ—Ä–∏:",[
        {text:"–ö—É–ø–∏—Ç—å 1", kind:"primary", onClick:()=>cryptoBuy(1)},
        {text:"–ö—É–ø–∏—Ç—å 5", kind:"primary", onClick:()=>cryptoBuy(5)},
        {text:"–ü—Ä–æ–¥–∞—Ç—å 1", kind:"ghost", onClick:()=>cryptoSell(1)},
        {text:"–ü—Ä–æ–¥–∞—Ç—å 5", kind:"ghost", onClick:()=>cryptoSell(5)},
      ])
    }));
    function cryptoBuy(q){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
      const cost=q*S.crypto.price; if(S.money<cost) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
      S.actionsLeft-=1; S.money-=cost; S.crypto.coins+=q; addXP(10);
      addLog(`–ö—Ä–∏–ø—Ç–∞: –∫—É–ø–∏–ª +${q} (-${rub(cost)})`,"good"); save(); render();
    }
    function cryptoSell(q){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
      if(S.crypto.coins<q) return toast("–ú–æ–Ω–µ—Ç –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç","bad");
      const gain=q*S.crypto.price;
      S.actionsLeft-=1; S.crypto.coins-=q; S.money+=gain; addXP(10);
      addLog(`–ö—Ä–∏–ø—Ç–∞: –ø—Ä–æ–¥–∞–ª -${q} (+${rub(gain)})`,"good"); save(); render();
    }
    screenTemplate("üñ•üí∂ –ö—Ä–∏–ø—Ç–∞","–¶–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.","",actions);
    return;
  }

  if(currentTab==="arena"){
    const gearB=Math.min(0.20,S.inv.gear*0.04);
    const baseWin=clamp(0.45+(S.lvl*0.01)+(S.skill*0.015)+gearB-(S.wanted*0.01),0.08,0.92);
    const prize=350+S.lvl*45;

    actions.push(actionCard({
      title:"ü§∫ –î—É—ç–ª—å (–∏–≥—Ä–æ–≤–∞—è)",
      text:"–®–∞–Ω—Å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è/–Ω–∞–≤—ã–∫–∞/—ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è -25 ‚Ä¢ –®–∞–Ω—Å ${Math.round(baseWin*100)}% ‚Ä¢ –ù–∞–≥—Ä–∞–¥–∞ +${rub(prize)}`,
      btnText:"–î—Ä–∞—Ç—å—Å—è",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(25)) return;
        const win=Math.random()<baseWin;
        if(win){ S.money+=prize; S.stats.duelsWin++; addXP(55); addLog(`–î—É—ç–ª—å –≤—ã–∏–≥—Ä–∞–Ω–∞ +${rub(prize)}`,"good"); toast("–ü–æ–±–µ–¥–∞!","good"); }
        else{ const loss=Math.floor(prize*0.75); S.money=Math.max(0,S.money-loss); S.stats.duelsLose++; addXP(15); addLog(`–î—É—ç–ª—å –ø—Ä–æ–∏–≥—Ä–∞–Ω–∞ -${rub(loss)}`,"bad"); toast("–ü—Ä–æ–∏–≥—Ä—ã—à","bad"); }
        save(); render();
      }
    }));
    screenTemplate("ü§∫ –î—É—ç–ª—å","–®–∞–Ω—Å–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ (–±–µ–∑ —Ä–µ–∞–ª–∞).","",actions);
    return;
  }

  if(currentTab==="heist"){
    const gearB=Math.min(0.22,S.inv.gear*0.045);
    const base=clamp(0.25+(S.skill*0.02)+(S.lvl*0.012)+gearB-(S.wanted*0.02),0.03,0.80);
    const loot=900+S.lvl*110+S.skill*45;
    const fine=1000+S.wanted*220;

    actions.push(actionCard({
      title:"ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ (–∏–≥—Ä–æ–≤–æ–π —Ä–∏—Å–∫)",
      text:"–û—á–µ–Ω—å —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ. –ü—Ä–∏ –ø—Ä–æ–≤–∞–ª–µ —à—Ç—Ä–∞—Ñ –∏ —Ä–æ—Å—Ç —Ä–æ–∑—ã—Å–∫–∞.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è -40 ‚Ä¢ –®–∞–Ω—Å ${Math.round(base*100)}% ‚Ä¢ –õ—É—Ç +${rub(Math.floor(loot))} ‚Ä¢ –ü—Ä–æ–≤–∞–ª -${rub(fine)}`,
      btnText:"–†–∏—Å–∫–Ω—É—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(40)) return;
        const ok=Math.random()<base;
        if(ok){ const gain=Math.floor(loot); S.money+=gain; S.stats.heistsWin++; addXP(85); S.wanted+=1; addLog(`–£—Å–ø–µ—Ö +${rub(gain)} (—Ä–æ–∑—ã—Å–∫ +1)`,"good"); toast("–£—Å–ø–µ—Ö!","good"); }
        else{ S.money=Math.max(0,S.money-fine); S.stats.heistsLose++; addXP(20); S.wanted+=2; addLog(`–ü—Ä–æ–≤–∞–ª -${rub(fine)} (—Ä–æ–∑—ã—Å–∫ +2)`,"bad"); toast("–ü—Ä–æ–≤–∞–ª","bad"); }
        save(); render();
      }
    }));
    screenTemplate("ü™ì –û–≥—Ä–∞–±–ª–µ–Ω–∏–µ","–¢–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–æ–π –∏–≤–µ–Ω—Ç.","–†–æ–∑—ã—Å–∫: "+S.wanted,actions);
    return;
  }

  if(currentTab==="family"){
    actions.push(actionCard({
      title:"üë©‚Äç‚ù§Ô∏è‚Äçüë® –ü–∞—Ä—Ç–Ω—ë—Ä",
      text:"–û—Ç–∫—Ä—ã–≤–∞–µ—Ç –ó–ê–ì–° –∏ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã.",
      cost:"–•–æ–¥ -1 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è -15 ‚Ä¢ XP +40",
      btnText: S.family.partner ? "–ï—Å—Ç—å" : "–ù–∞–π—Ç–∏",
      disabled: S.family.partner,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(!useAction(15)) return;
        S.family.partner=true; addXP(40);
        addLog("–ü–∞—Ä—Ç–Ω—ë—Ä –Ω–∞–π–¥–µ–Ω üë©‚Äç‚ù§Ô∏è‚Äçüë®","good"); save(); render();
      }
    }));
    actions.push(actionCard({
      title:"üë´ –ó–ê–ì–°",
      text:"–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –±—Ä–∞–∫ (–∏–≥—Ä–æ–≤–æ–µ).",
      cost:"–¶–µ–Ω–∞ 3000 ‚ÇΩ ‚Ä¢ –•–æ–¥ -1 ‚Ä¢ XP +60",
      btnText: S.family.married ? "–£–∂–µ" : "–ñ–µ–Ω–∏—Ç—å—Å—è",
      disabled: !S.family.partner || S.family.married,
      onClick: ()=>{
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        if(S.money<3000) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 3000 ‚ÇΩ","bad");
        S.actionsLeft-=1; S.money-=3000; S.family.married=true; addXP(60);
        addLog("–ë—Ä–∞–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω üëë","good"); save(); render();
      }
    }));
    screenTemplate("üë©‚Äç‚ù§Ô∏è‚Äçüë® –°–µ–º—å—è / –ó–ê–ì–°",`–ü–∞—Ä—Ç–Ω—ë—Ä: ${S.family.partner?"–¥–∞":"–Ω–µ—Ç"} ‚Ä¢ –ë—Ä–∞–∫: ${S.family.married?"–¥–∞":"–Ω–µ—Ç"} ‚Ä¢ –î–µ—Ç–∏: ${S.family.kids}`,"",actions);
    return;
  }

  if(currentTab==="clan"){
    actions.push(actionCard({
      title:"üõ° –ö–ª–∞–Ω",
      text:"–õ–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ).",
      cost:`–ö–ª–∞–Ω: ${S.clan.name||"–Ω–µ—Ç"} ‚Ä¢ –£—Ä: ${S.clan.level} ‚Ä¢ –°–∫–ª–∞–¥: ${rub(S.clan.storage)}`,
      btnText:"–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ",
      onClick: ()=>{
        if(!S.clan.name){
          return openModal("–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω üõ°","–°–æ–∑–¥–∞—Ç—å –∑–∞ 2000 ‚ÇΩ?",[
            {text:"–°–æ–∑–¥–∞—Ç—å", kind:"primary", onClick:()=>{ if(S.money<2000) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç","bad"); if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad"); S.actionsLeft--; S.money-=2000; S.clan={name:"FiveClan",level:1,storage:0}; addXP(40); addLog("–ö–ª–∞–Ω —Å–æ–∑–¥–∞–Ω üõ° FiveClan","good"); save(); render(); }},
            {text:"–û—Ç–º–µ–Ω–∞", kind:"ghost", onClick:()=>{}}
          ]);
        }
        openModal("–ö–ª–∞–Ω üõ°","–í—ã–±–µ—Ä–∏:",[
          {text:"+1000 –≤ —Å–∫–ª–∞–¥", kind:"primary", onClick:()=>clanStore(+1000)},
          {text:"–°–Ω—è—Ç—å 1000", kind:"ghost", onClick:()=>clanStore(-1000)},
          {text:"–ê–ø–≥—Ä–µ–π–¥", kind:"primary", onClick:()=>clanUp()},
        ]);
      }
    }));
    function clanStore(v){
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
      if(v>0){ if(S.money<v) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç","bad"); S.actionsLeft--; S.money-=v; S.clan.storage+=v; addLog(`–°–∫–ª–∞–¥ +${rub(v)}`,"good"); }
      else{ const x=Math.abs(v); if(S.clan.storage<x) return toast("–í —Å–∫–ª–∞–¥–µ –º–∞–ª–æ","bad"); S.actionsLeft--; S.clan.storage-=x; S.money+=x; addLog(`–°–∫–ª–∞–¥ —Å–Ω—è—Ç–∏–µ -${rub(x)}`,"good"); }
      save(); render();
    }
    function clanUp(){
      const price=2500+S.clan.level*1800;
      if(S.actionsLeft<=0) return toast("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
      if(S.money<price) return toast("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç","bad");
      S.actionsLeft--; S.money-=price; S.clan.level++; addXP(60);
      addLog(`–ö–ª–∞–Ω ‚Üí —É—Ä ${S.clan.level} (-${rub(price)})`,"good");
      save(); render();
    }
    screenTemplate("üõ° –ö–ª–∞–Ω","–ö–ª–∞–Ω/—Å–∫–ª–∞–¥/—É—Ä–æ–≤–µ–Ω—å.","",actions);
    return;
  }

  if(currentTab==="tops"){
    const cryptoVal = Math.floor(S.crypto.coins * S.crypto.price);
    S.tops.bestNW = Math.max(S.tops.bestNW, netWorth());
    S.tops.bestCrypto = Math.max(S.tops.bestCrypto, cryptoVal);

    const box = document.createElement("div");
    box.className="action";
    box.innerHTML = `
      <b>Forbes üòéüíµ</b>
      <div class="muted">–ü–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ (–≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ). –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –æ–Ω–ª–∞–π–Ω–∞ –Ω—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä.</div>
      <div class="sep"></div>
      <ul class="list">
        <li><div><b>–¢–æ–ø –±–∞–ª–∞–Ω—Å üí≥</b><div class="small">—Ä–µ–∫–æ—Ä–¥ –∫–∞–ø–∏—Ç–∞–ª–∞</div></div><span class="badge">${rub(S.tops.bestNW)}</span></li>
        <li><div><b>–¢–æ–ø –∫—Ä–∏–ø—Ç–∞ üñ•üí∂</b><div class="small">–ª—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ</div></div><span class="badge">${rub(S.tops.bestCrypto)}</span></li>
      </ul>
    `;
    screenTemplate("Forbes üòéüíµ","–†–µ–∫–æ—Ä–¥—ã –∞–∫–∫–∞—É–Ω—Ç–∞ (–ª–æ–∫–∞–ª—å–Ω–æ).","", [box]);
    save();
    return;
  }

  screenTemplate("‚Äî","‚Äî","‚Äî",[]);
}

/* ---------- Next day tick ---------- */
function nextDay(){
  // reset day counters for quests
  S.stats.jobsDoneToday = 0;
  S.stats.studyToday = 0;
  S.stats.loanToday = 0;

  const di = dailyDebtInterest();
  if(di>0){
    S.debt += di;
    addLog(`–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É: +${rub(di)} (–¥–æ–ª–≥ ${rub(S.debt)})`, "warn");
  }

  const prev = S.crypto.price;
  nextCryptoPrice();
  if(S.crypto.price>prev) addLog(`–ö—Ä–∏–ø—Ç–∞ üìà ${rub(prev)} ‚Üí ${rub(S.crypto.price)}`, "good");
  else if(S.crypto.price<prev) addLog(`–ö—Ä–∏–ø—Ç–∞ üìâ ${rub(prev)} ‚Üí ${rub(S.crypto.price)}`, "bad");

  S.rentDueIn -= 1;

  S.day += 1;
  S.actionsLeft = 3;
  S.energy = clamp(S.energy + 25, 0, 100);
  addLog(`–ù–æ–≤—ã–π –¥–µ–Ω—å: ${S.day}. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å.`, "info");

  if(S.rentDueIn <= 0){
    const fine = 900 + S.homeLevel*260 + (S.family.kids*120);
    S.money = Math.max(0, S.money - fine);
    S.rentDueIn = 7;
    addLog(`–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –∂–∏–ª—å—è üßæ –®—Ç—Ä–∞—Ñ -${rub(fine)}.`, "bad");
    toast("–®—Ç—Ä–∞—Ñ –∑–∞ –∂–∏–ª—å—ë!", "bad");
  }

  if(S.wanted>0 && Math.random()<0.55){
    S.wanted = Math.max(0, S.wanted-1);
    addLog("–†–æ–∑—ã—Å–∫ —Å–Ω–∏–∑–∏–ª—Å—è üßº (-1)", "info");
  }

  if((S.day-1) % 7 === 0){
    const cost = weeklyCosts();
    const pass = passiveIncome();
    S.money = Math.max(0, S.money - cost + pass);
    addLog(`–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏: —Ä–∞—Å—Ö–æ–¥—ã -${rub(cost)}.`, "bad");
    if(pass>0) addLog(`–ü–∞—Å—Å–∏–≤: +${rub(pass)} ‚úÖ`, "good");
    addXP(25);
  }

  S.tops.bestNW = Math.max(S.tops.bestNW, netWorth());
  S.tops.bestCrypto = Math.max(S.tops.bestCrypto, Math.floor(S.crypto.coins * S.crypto.price));

  save(); render();
}

/* ---------- Render ---------- */
function renderInventory(){
  const ul = $("inventoryList");
  ul.innerHTML="";
  const rows = [
    ["–ï–¥–∞ üçé", S.inv.food],
    ["–¢–µ—Ö–Ω–∏–∫–∞ üñ•", S.inv.tech],
    ["–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ üõ°", S.inv.gear],
    ["–ú–∞—à–∏–Ω–∞ üöó", S.inv.car],
  ];
  rows.forEach(([name,val])=>{
    const li = document.createElement("li");
    li.innerHTML = `<div><b>${name}</b><div class="small">–∫–æ–ª-–≤–æ</div></div><span class="badge">${val}</span>`;
    ul.appendChild(li);
  });
  $("invBadge").textContent = `–ö–æ–ø–∏–ª–∫–∞: ${rub(S.safe)} ‚Ä¢ –ö—Ä–∏–ø—Ç–∞: ${S.crypto.coins}ü™ô`;
}
function renderAchievements(){
  const ul = $("achievements");
  ul.innerHTML="";
  let done=0;
  ACH.forEach(a=>{
    const ok = a.ok(S);
    if(ok) done++;
    const li = document.createElement("li");
    li.innerHTML = `
      <div style="min-width:0">
        <b>${a.name} ${ok?'<span class="good">‚úì</span>':''}</b>
        <div class="small">${a.desc}</div>
      </div>
      <span class="badge">${ok?"–û—Ç–∫—Ä—ã—Ç–æ":"–ó–∞–∫—Ä—ã—Ç–æ"}</span>
    `;
    ul.appendChild(li);
  });
  $("achvBadge").textContent = `${done}/${ACH.length}`;
}

function render(){
  $("dayPill").textContent = `–î–µ–Ω—å ${S.day}`;
  $("weekPill").textContent = String(week());
  $("rankPill").textContent = rankName();
  $("actionsLeft").textContent = `–•–æ–¥—ã: ${S.actionsLeft}/3`;

  $("money").textContent = rub(S.money);
  $("bank").textContent = rub(S.bank);
  $("debt").textContent = rub(S.debt);
  $("energy").textContent = String(S.energy);
  $("lvl").textContent = String(S.lvl);
  $("skill").textContent = String(S.skill);

  $("netWorth").textContent = `–ö–∞–ø–∏—Ç–∞–ª: ${rub(netWorth())}`;
  const homeName = ["–∞—Ä–µ–Ω–¥–∞","–∫–æ–º–Ω–∞—Ç–∞","–∫–≤–∞—Ä—Ç–∏—Ä–∞","–¥–æ–º"][S.homeLevel] || "–∞—Ä–µ–Ω–¥–∞";
  $("homeSmall").textContent = homeName;

  $("energyBar").style.width = `${Math.round((S.energy/100)*100)}%`;
  $("xpBar").style.width = `${Math.round((S.xp / S.xpNeed)*100)}%`;
  $("xpText").textContent = `${S.xp}/${S.xpNeed}`;

  $("economyHint").textContent = `–†–∞—Å—Ö–æ–¥/–Ω–µ–¥: ${rub(weeklyCosts())} ‚Ä¢ –ü–∞—Å—Å–∏–≤/–Ω–µ–¥: ${rub(passiveIncome())} ‚Ä¢ %/–¥–µ–Ω—å: ${rub(dailyDebtInterest())}`;

  const ul = $("log");
  ul.innerHTML="";
  S.log.forEach(x=>{
    const li = document.createElement("li");
    li.innerHTML = x.type==="good" ? `‚úÖ <span class="good">${escapeHtml(x.t)}</span>`
      : x.type==="bad" ? `‚ö†Ô∏è <span class="bad">${escapeHtml(x.t)}</span>`
      : x.type==="warn"? `üí≥ <span class="warn">${escapeHtml(x.t)}</span>`
      : `‚Ä¢ ${escapeHtml(x.t)}`;
    ul.appendChild(li);
  });

  renderInventory();
  renderAchievements();
  renderScreen();
}

/* ---------- Events ---------- */
$("tabs").addEventListener("click",(e)=>{
  const b = e.target.closest("[data-tab]");
  if(!b) return;
  setTab(b.getAttribute("data-tab"));
});
$("nextDayBtn").onclick = nextDay;
$("saveBtn").onclick = ()=>{ save(); toast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ üíæ","good"); };
$("resetBtn").onclick = ()=>{
  openModal("–°–±—Ä–æ—Å ‚ôªÔ∏è","–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª–Ω–æ—Å—Ç—å—é?",[
    {text:"–°–±—Ä–æ—Å–∏—Ç—å", kind:"danger", onClick:()=>{ localStorage.removeItem(KEY); S = defaultState(); save(); toast("–°–±—Ä–æ—à–µ–Ω–æ","warn"); render(); setTab("home"); }},
    {text:"–û—Ç–º–µ–Ω–∞", kind:"ghost", onClick:()=>{}}
  ]);
};

/* ---------- Init ---------- */
render();
</script>
</body>
</html>
