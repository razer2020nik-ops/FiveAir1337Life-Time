<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FiveAir1337Life-Time ‚Äî Life Simulator</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#0f1620;
      --panel2:#101b28;
      --text:#e7eef7;
      --muted:#9db0c7;
      --line:#223042;
      --accent:#2d7cff;
      --good:#43d17a;
      --bad:#ff5c5c;
      --warn:#ffcc66;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --r:18px;
      --r2:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 15% 0%, rgba(45,124,255,.22), transparent 60%),
        radial-gradient(900px 500px at 90% 20%, rgba(122,169,255,.14), transparent 55%),
        var(--bg);
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .topbar{
      position:sticky;top:0;z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(11,15,20,.72);
      border-bottom:1px solid rgba(34,48,66,.65);
    }
    .topbar-inner{
      max-width:1200px;margin:0 auto;padding:12px 16px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:42px;height:42px;border-radius:16px;
      display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(45,124,255,.95), rgba(122,169,255,.55));
      color:#06101d;font-weight:1000;box-shadow:var(--shadow);
      letter-spacing:.4px;
    }
    .brand h1{margin:0;font-size:16px}
    .brand .sub{margin:2px 0 0;color:var(--muted);font-size:12px}
    .top-actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    button{
      border:none;border-radius:14px;padding:11px 14px;
      cursor:pointer;font-weight:900;
      transition:.15s;
    }
    .b-primary{background:var(--accent);color:#07101b;box-shadow:0 10px 25px rgba(0,0,0,.18)}
    .b-ghost{background:rgba(11,15,20,.25);color:var(--text);border:1px solid rgba(34,48,66,.9)}
    .b-danger{background:rgba(255,92,92,.12);color:var(--bad);border:1px solid rgba(255,92,92,.35)}
    .b-primary:hover,.b-ghost:hover,.b-danger:hover{transform:translateY(-1px)}
    .pill{
      font-size:12px;border:1px solid rgba(34,48,66,.85);
      padding:6px 10px;border-radius:999px;color:var(--muted);
      background:rgba(15,22,32,.35);
      white-space:nowrap;
    }

    .layout{display:grid;grid-template-columns: 320px 1fr;gap:14px;margin-top:14px}
    @media (max-width: 980px){ .layout{grid-template-columns:1fr} }

    .card{
      background:linear-gradient(180deg, rgba(16,27,40,.90), rgba(15,22,32,.88));
      border:1px solid rgba(34,48,66,.85);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:14px;
    }
    .title{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      margin-bottom:10px;
    }
    .title h2{margin:0;font-size:16px}
    .muted{color:var(--muted);font-size:13px;line-height:1.55}

    .kpis{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .kpi{
      border:1px solid rgba(34,48,66,.85);
      border-radius:var(--r2);
      padding:12px;background:rgba(11,15,20,.20);
    }
    .kpi .lab{font-size:12px;color:var(--muted)}
    .kpi .val{font-size:20px;font-weight:1000;margin-top:4px}
    .bar{height:10px;border-radius:999px;background:rgba(34,48,66,.75);overflow:hidden;margin-top:7px}
    .bar > div{height:100%;background:var(--accent);width:0%}
    .sep{height:1px;background:rgba(34,48,66,.7);margin:12px 0}

    .menu{display:grid;gap:8px;margin-top:10px}
    .tab{
      padding:12px;border-radius:14px;
      border:1px solid rgba(34,48,66,.85);
      background:rgba(11,15,20,.18);
      color:var(--text);
      text-align:left;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .tab small{color:var(--muted);font-weight:700}
    .tab.active{
      border-color:rgba(45,124,255,.90);
      background:rgba(45,124,255,.12);
    }

    .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width: 980px){ .grid2{grid-template-columns:1fr} }

    .actions{display:grid;gap:10px}
    .action{
      border:1px solid rgba(34,48,66,.85);
      border-radius:14px;
      padding:12px;background:rgba(11,15,20,.18);
    }
    .action .row{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .action b{display:block;margin-bottom:4px}
    .small{font-size:12px;color:var(--muted)}
    .good{color:var(--good);font-weight:1000}
    .bad{color:var(--bad);font-weight:1000}
    .warn{color:var(--warn);font-weight:1000}

    input, select{
      width:100%;
      background:rgba(11,15,20,.28);
      border:1px solid rgba(34,48,66,.9);
      border-radius:14px;
      padding:12px 12px;
      color:var(--text);
      outline:none;
    }
    .row2{display:flex;gap:10px;flex-wrap:wrap}
    .row2 > *{flex:1 1 160px}

    .log{
      margin:0;padding:0;list-style:none;display:grid;gap:8px;
      max-height:340px;overflow:auto;
    }
    .log li{
      border:1px solid rgba(34,48,66,.8);
      background:rgba(11,15,20,.18);
      border-radius:14px;padding:10px;
      font-size:13px;
    }

    .list{
      margin:0;padding:0;list-style:none;display:grid;gap:10px;
    }
    .list li{
      border:1px solid rgba(34,48,66,.85);
      background:rgba(11,15,20,.16);
      border-radius:14px;padding:12px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .badge{
      font-size:12px;color:var(--muted);
      border:1px solid rgba(34,48,66,.85);
      padding:4px 8px;border-radius:999px;
      background:rgba(15,22,32,.25);
      white-space:nowrap;
    }
    footer{
      padding:18px 0 28px;
      color:var(--muted);
      text-align:center;
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">5A</div>
        <div>
          <h1>FiveAir1337Life-Time</h1>
          <div class="sub">Life Simulator ‚Ä¢ –≥–æ—Ä–æ–¥ ‚Ä¢ –¥–µ–Ω—å–≥–∏ ‚Ä¢ –±–∏–∑–Ω–µ—Å ‚Ä¢ —Ä–∞–Ω–≥–∏</div>
        </div>
      </div>
      <div class="top-actions">
        <div class="pill" id="dayPill">–î–µ–Ω—å 1</div>
        <div class="pill" id="weekPill">–ù–µ–¥–µ–ª—è 1</div>
        <div class="pill" id="rankPill">–†–∞–Ω–≥: –ù–æ–≤–∏—á–æ–∫</div>
        <button class="b-primary" id="nextDayBtn">üìÖ –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å</button>
        <button class="b-danger" id="resetBtn">‚ôªÔ∏è –°–±—Ä–æ—Å</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="layout">
      <!-- LEFT: profile + city -->
      <aside class="card">
        <div class="title">
          <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
          <span class="badge" id="actionsLeft">–•–æ–¥–æ–≤: 3/3</span>
        </div>

        <div class="kpis">
          <div class="kpi">
            <div class="lab">üí∞ –ù–∞–ª–∏—á–Ω—ã–µ</div>
            <div class="val" id="money">0 ‚ÇΩ</div>
            <div class="small">–¢—Ä–∞—Ç–∞/–¥–æ—Ö–æ–¥ –≤ –¥–µ–π—Å—Ç–≤–∏—è—Ö</div>
          </div>
          <div class="kpi">
            <div class="lab">üè¶ –ë–∞–Ω–∫</div>
            <div class="val" id="bank">0 ‚ÇΩ</div>
            <div class="small">–î–µ–ø–æ–∑–∏—Ç/—Å–Ω—è—Ç–∏–µ</div>
          </div>
          <div class="kpi">
            <div class="lab">‚ö° –≠–Ω–µ—Ä–≥–∏—è</div>
            <div class="val" id="energy">100</div>
            <div class="bar"><div id="energyBar"></div></div>
          </div>
          <div class="kpi">
            <div class="lab">üß† –ù–∞–≤—ã–∫</div>
            <div class="val" id="skill">1</div>
            <div class="small">–í–ª–∏—è–µ—Ç –Ω–∞ –¥–æ—Ö–æ–¥</div>
          </div>
          <div class="kpi">
            <div class="lab">üè¢ –ë–∏–∑–Ω–µ—Å</div>
            <div class="val" id="biz">0</div>
            <div class="small">–ü–∞—Å—Å–∏–≤ –≤ –Ω–µ–¥–µ–ª—é</div>
          </div>
          <div class="kpi">
            <div class="lab">üí≥ –î–æ–ª–≥</div>
            <div class="val" id="debt">0 ‚ÇΩ</div>
            <div class="small">–ü—Ä–æ—Ü–µ–Ω—Ç—ã –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è</div>
          </div>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üó∫Ô∏è –ì–æ—Ä–æ–¥</h2>
          <span class="badge" id="netWorth">–ö–∞–ø–∏—Ç–∞–ª: 0 ‚ÇΩ</span>
        </div>

        <div class="menu" id="tabs">
          <button class="tab active" data-tab="home">üè† –î–æ–º <small id="homeSmall"></small></button>
          <button class="tab" data-tab="work">üíº –†–∞–±–æ—Ç–∞ <small>–¥–æ—Ö–æ–¥</small></button>
          <button class="tab" data-tab="study">üìë –û–±—É—á–µ–Ω–∏–µ <small>–Ω–∞–≤—ã–∫</small></button>
          <button class="tab" data-tab="biz">üöÄ –ë–∏–∑–Ω–µ—Å <small>–ø–∞—Å—Å–∏–≤</small></button>
          <button class="tab" data-tab="bank">üè¶ –ë–∞–Ω–∫ <small>–¥–µ–ø–æ–∑–∏—Ç/–∫—Ä–µ–¥–∏—Ç</small></button>
          <button class="tab" data-tab="shop">üè¨ –ú–∞–≥–∞–∑–∏–Ω <small>–µ–¥–∞/—Ç–µ—Ö–Ω–∏–∫–∞</small></button>
          <button class="tab" data-tab="cars">üöò –ê–≤—Ç–æ—Å–∞–ª–æ–Ω <small>–º–∞—à–∏–Ω—ã</small></button>
          <button class="tab" data-tab="realty">üè¢ –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å <small>—É–ª—É—á—à–µ–Ω–∏–µ</small></button>
          <button class="tab" data-tab="crypto">üñ•üí∂ –ö—Ä–∏–ø—Ç–∞ <small>—Ä—ã–Ω–æ–∫</small></button>
          <button class="tab" data-tab="tops">Forbes üòéüíµ <small>—Ç–æ–ø—ã</small></button>
        </div>

        <div class="sep"></div>

        <div class="title">
          <h2>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
          <span class="badge" id="invBadge">‚Äî</span>
        </div>
        <ul class="list" id="inventoryList"></ul>

        <footer style="padding:14px 0 0;text-align:left">
          üíæ –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
        </footer>
      </aside>

      <!-- RIGHT: content + log -->
      <main class="grid2">
        <section class="card">
          <div class="title">
            <h2 id="screenTitle">üè† –î–æ–º</h2>
            <span class="badge" id="screenHint">–í—ã–±–µ—Ä–∏ –¥–µ–π—Å—Ç–≤–∏–µ</span>
          </div>

          <div class="muted" id="screenDesc"></div>
          <div class="sep"></div>

          <div class="actions" id="screenActions"></div>

          <div class="sep"></div>
          <div class="title">
            <h2>üéØ –¶–µ–ª–∏ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
            <span class="badge" id="achvBadge">0/0</span>
          </div>
          <ul class="list" id="achievements"></ul>
        </section>

        <section class="card">
          <div class="title">
            <h2>üì∞ –°–æ–±—ã—Ç–∏—è</h2>
            <span class="badge" id="weekEconomy">‚Äî</span>
          </div>
          <ul class="log" id="log"></ul>
        </section>
      </main>
    </div>

    <footer>¬© FiveAir1337Life-Time ‚Ä¢ Life Simulator</footer>
  </div>

<script>
/* =========================
   FiveAir1337Life-Time SIM
   ========================= */

const KEY = "fa_lifetime_sim_v2";
const $ = (id) => document.getElementById(id);

const RANKS = [
  {name:"–ù–æ–≤–∏—á–æ–∫", nw:0},
  {name:"–†–∞–±–æ—Ç—è–≥–∞", nw:5000},
  {name:"–°—Ç–∞–∂—ë—Ä –±–∏–∑–Ω–µ—Å–∞", nw:15000},
  {name:"–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", nw:40000},
  {name:"–ë–∏–∑–Ω–µ—Å–º–µ–Ω", nw:90000},
  {name:"Forbes üòéüíµ", nw:200000},
];

const defaultState = () => ({
  day: 1,
  actionsLeft: 3,
  money: 500,
  bank: 0,
  debt: 0,
  energy: 100,
  skill: 1,
  biz: 0,
  homeLevel: 0,     // 0 –∞—Ä–µ–Ω–¥–∞, 1 –∫–æ–º–Ω–∞—Ç–∞, 2 –∫–≤–∞—Ä—Ç–∏—Ä–∞, 3 –¥–æ–º
  rentDueIn: 7,     // –¥–Ω–µ–π –¥–æ –æ–ø–ª–∞—Ç—ã –∞—Ä–µ–Ω–¥—ã/–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
  donations: 0,
  // crypto
  cryptoCash: 0, // —Å–∫–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç
  cryptoPrice: 120, // ‚ÇΩ –∑–∞ –º–æ–Ω–µ—Ç—É
  // inventory
  inv: {
    food: 0,
    tech: 0,
    car: 0,
    gear: 0
  },
  // simple "transfer" (–∫–æ–ø–∏–ª–∫–∞)
  safe: 0,
  // logs
  log: [
    {t:"–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏ –ª–æ–∫–∞—Ü–∏—é —Å–ª–µ–≤–∞ –∏ –¥–µ–ª–∞–π –¥–µ–π—Å—Ç–≤–∏—è. 3 —Ö–æ–¥–∞ –≤ –¥–µ–Ω—å.", type:"info"}
  ],
  // local "tops"
  tops: {
    bestNetWorth: 0,
    bestDonations: 0,
    bestCryptoValue: 0
  }
});

let S = loadState();
let currentTab = "home";

/* ---------- storage ---------- */
function loadState(){
  try{
    const v = localStorage.getItem(KEY);
    return v ? JSON.parse(v) : defaultState();
  }catch(e){
    return defaultState();
  }
}
function saveState(){
  localStorage.setItem(KEY, JSON.stringify(S));
}

/* ---------- utils ---------- */
function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }
function rub(n){ return Number(n||0).toLocaleString("ru-RU")+" ‚ÇΩ"; }
function week(){ return Math.floor((S.day-1)/7)+1; }
function netWorth(){
  // –∫–∞–ø–∏—Ç–∞–ª = –Ω–∞–ª–∏—á–Ω—ã–µ + –±–∞–Ω–∫ + –∫–æ–ø–∏–ª–∫–∞ + —Ü–µ–Ω–Ω–æ—Å—Ç—å –∫—Ä–∏–ø—Ç—ã + —Ü–µ–Ω–Ω–æ—Å—Ç—å –∞–≤—Ç–æ/—Ç–µ—Ö–Ω–∏–∫–∏/–∂–∏–ª—å—è - –¥–æ–ª–≥
  const cryptoVal = Math.floor(S.cryptoCash * S.cryptoPrice);
  const carVal = S.inv.car * 12000;
  const techVal = S.inv.tech * 2500;
  const homeVal = [0, 8000, 25000, 65000][S.homeLevel] || 0;
  return Math.max(0, (S.money + S.bank + S.safe + cryptoVal + carVal + techVal + homeVal) - S.debt);
}
function rankName(){
  const nw = netWorth();
  let r = RANKS[0].name;
  for(const x of RANKS){ if(nw >= x.nw) r = x.name; }
  return r;
}
function addLog(text, type="info"){
  S.log.unshift({t:text, type});
  if(S.log.length>70) S.log.pop();
  saveState();
  render();
}
function useAction(energyCost){
  if(S.actionsLeft<=0){ addLog("–•–æ–¥–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ—Ç. –ñ–º–∏ ¬´–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å¬ª.","bad"); return false; }
  if(S.energy<energyCost){ addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏–∏. –°—ä–µ—à—å –µ–¥—É –∏–ª–∏ –æ—Ç–¥–æ—Ö–Ω–∏.","bad"); return false; }
  S.actionsLeft -= 1;
  S.energy = clamp(S.energy - energyCost, 0, 100);
  return true;
}
function ensureNonNegative(){
  S.money = Math.max(0, S.money);
  S.bank = Math.max(0, S.bank);
  S.debt = Math.max(0, S.debt);
  S.safe = Math.max(0, S.safe);
}

/* ---------- economy rules ---------- */
function weeklyCosts(){
  // —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –∂–∏–∑–Ω—å —Ä–∞—Å—Ç—É—Ç —Å —É—Ä–æ–≤–Ω–µ–º –∂–∏–ª—å—è –∏ –Ω–∞–≤—ã–∫–æ–º
  const base = 600 + (S.skill-1)*140;
  const homeMul = [1.0, 1.25, 1.55, 2.1][S.homeLevel] || 1.0;
  return Math.floor(base * homeMul);
}
function passiveIncome(){
  // –±–∏–∑–Ω–µ—Å –¥–∞—ë—Ç –ø–∞—Å—Å–∏–≤ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é
  return Math.floor(S.biz * (420 + S.skill*55));
}
function dailyDebtInterest(){
  // –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ –¥–æ–ª–≥—É –≤ –¥–µ–Ω—å (–Ω–µ –∂—ë—Å—Ç–∫–∏–π, –Ω–æ –æ—â—É—Ç–∏–º—ã–π)
  if(S.debt<=0) return 0;
  return Math.floor(S.debt * 0.03); // 3% –≤ –¥–µ–Ω—å (–∏–≥—Ä–æ–≤–æ–µ)
}

/* ---------- crypto market ---------- */
function nextCryptoPrice(){
  // –Ω–µ–±–æ–ª—å—à–∞—è —Å–ª—É—á–∞–π–Ω–∞—è –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
  const change = (Math.random()*0.22 - 0.10); // -10%..+12%
  const p = Math.max(20, Math.floor(S.cryptoPrice * (1+change)));
  S.cryptoPrice = p;
}

/* ---------- achievements/goals ---------- */
const ACH = [
  {id:"a1", name:"üíº –ü–µ—Ä–≤–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞", desc:"–ó–∞—Ä–∞–±–æ—Ç–∞–π 1 000 ‚ÇΩ", ok: ()=> (S.money + S.bank + S.safe) >= 1000},
  {id:"a2", name:"üß† –ü—Ä–æ–∫–∞—á–∫–∞", desc:"–ù–∞–≤—ã–∫ 5+", ok: ()=> S.skill >= 5},
  {id:"a3", name:"üè¢ –ë–∏–∑–Ω–µ—Å —Å—Ç–∞—Ä—Ç", desc:"–ë–∏–∑–Ω–µ—Å 1+", ok: ()=> S.biz >= 1},
  {id:"a4", name:"üè† –£–ª—É—á—à–∏–ª –∂–∏–ª—å—ë", desc:"–ñ–∏–ª—å—ë 1+", ok: ()=> S.homeLevel >= 1},
  {id:"a5", name:"üöò –ü–µ—Ä–≤–∞—è –º–∞—à–∏–Ω–∞", desc:"–ö—É–ø–∏ 1 –∞–≤—Ç–æ", ok: ()=> S.inv.car >= 1},
  {id:"a6", name:"üè¶ –í –±–∞–Ω–∫–µ –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏", desc:"–î–µ–ø–æ–∑–∏—Ç 5 000 ‚ÇΩ+", ok: ()=> S.bank >= 5000},
  {id:"a7", name:"üñ•üí∂ –ö—Ä–∏–ø—Ç–æ-–∏–Ω–≤–µ—Å—Ç–æ—Ä", desc:"–ö—É–ø–∏ –∫—Ä–∏–ø—Ç—É", ok: ()=> S.cryptoCash > 0},
  {id:"a8", name:"üòéüíµ Forbes", desc:"–ö–∞–ø–∏—Ç–∞–ª 200 000 ‚ÇΩ+", ok: ()=> netWorth() >= 200000},
];

/* ---------- screens ---------- */
function setTab(tab){
  currentTab = tab;
  document.querySelectorAll(".tab").forEach(b=>{
    b.classList.toggle("active", b.getAttribute("data-tab")===tab);
  });
  renderScreen();
}

function screenTemplate(title, desc, hint, actions){
  $("screenTitle").textContent = title;
  $("screenDesc").textContent = desc;
  $("screenHint").textContent = hint;
  const box = $("screenActions");
  box.innerHTML = "";
  actions.forEach(a => box.appendChild(a));
}

function actionCard({title, text, cost, btnText, onClick, extraHTML=""}){
  const wrap = document.createElement("div");
  wrap.className = "action";
  wrap.innerHTML = `
    <div class="row">
      <div>
        <b>${title}</b>
        <div class="muted">${text}</div>
        <div class="small" style="margin-top:6px">${cost}</div>
        ${extraHTML ? `<div style="margin-top:10px">${extraHTML}</div>` : ""}
      </div>
      <button class="b-primary">${btnText}</button>
    </div>
  `;
  wrap.querySelector("button").onclick = onClick;
  return wrap;
}

/* ---------- location logic ---------- */
function renderScreen(){
  const nw = netWorth();
  const wkCost = weeklyCosts();
  const pass = passiveIncome();
  const debtInt = dailyDebtInterest();
  const cryptoVal = Math.floor(S.cryptoCash * S.cryptoPrice);

  if(currentTab === "home"){
    const homeName = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"][S.homeLevel] || "–ê—Ä–µ–Ω–¥–∞";
    const rentText = `–î–æ –æ–ø–ª–∞—Ç—ã: ${S.rentDueIn} –¥–Ω. ‚Ä¢ –†–∞—Å—Ö–æ–¥ –≤ –Ω–µ–¥–µ–ª—é: ${rub(wkCost)} ‚Ä¢ –ü–∞—Å—Å–∏–≤: ${rub(pass)}`;
    const actions = [];

    actions.push(actionCard({
      title:"üçé –ï–¥–∞ (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç–Ω–µ—Ä–≥–∏—é)",
      text:"–ï—Å–ª–∏ —ç–Ω–µ—Ä–≥–∏—è –Ω–∏–∑–∫–∞—è ‚Äî –µ–¥–∞ —Å–ø–∞—Å–∞–µ—Ç. –ï–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è.",
      cost:`–¢—Ä–µ–±—É–µ—Ç: 1√ó–ï–¥–∞ ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +30`,
      btnText:"–°—ä–µ—Å—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0){ addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤. –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.","bad"); return; }
        if(S.inv.food<=0){ addLog("–ï–¥—ã –Ω–µ—Ç. –ö—É–ø–∏ –≤ –º–∞–≥–∞–∑–∏–Ω–µ üè¨","bad"); return; }
        S.actionsLeft -= 1;
        S.inv.food -= 1;
        S.energy = clamp(S.energy + 30, 0, 100);
        addLog("–¢—ã –ø–æ–µ–ª üçé –≠–Ω–µ—Ä–≥–∏—è +30.","good");
        saveState(); render();
      }
    }));

    actions.push(actionCard({
      title:"üõå –û—Ç–¥—ã—Ö",
      text:"–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é. –ü–æ–ª–µ–∑–Ω–æ –µ—Å–ª–∏ —Ç—ã –≤—ã–∂–∞—Ç.",
      cost:"–•–æ–¥: -1 ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: +45",
      btnText:"–û—Ç–¥—ã—Ö–∞—Ç—å",
      onClick: ()=>{
        if(S.actionsLeft<=0){ addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤. –°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å.","bad"); return; }
        S.actionsLeft -= 1;
        S.energy = clamp(S.energy + 45, 0, 100);
        addLog("–û—Ç–¥–æ—Ö–Ω—É–ª üõå –≠–Ω–µ—Ä–≥–∏—è +45.","good");
        saveState(); render();
      }
    }));

    actions.push(actionCard({
      title:"üí∏ –ü–µ—Ä–µ–≤–æ–¥ –≤ –∫–æ–ø–∏–ª–∫—É",
      text:"–ü–µ—Ä–µ–≤–µ–¥–∏ —á–∞—Å—Ç—å –¥–µ–Ω–µ–≥ –≤ –∫–æ–ø–∏–ª–∫—É (—á–∏—Å—Ç–æ –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä—ã).",
      cost:"–ù–∞–ª–∏—á–Ω—ã–µ ‚Üí –ö–æ–ø–∏–ª–∫–∞",
      btnText:"–ü–µ—Ä–µ–≤–µ—Å—Ç–∏",
      extraHTML: `
        <div class="row2">
          <input id="safeAmt" type="number" placeholder="–°—É–º–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 500)" />
          <button class="b-ghost" id="safeDo">–û–∫</button>
        </div>
      `,
      onClick: ()=>{}
    }));

    // bind safe transfer
    setTimeout(()=>{
      const doBtn = document.getElementById("safeDo");
      if(doBtn){
        doBtn.onclick = ()=>{
          const v = Number(document.getElementById("safeAmt").value || 0);
          if(v<=0) return addLog("–í–≤–µ–¥–∏ —Å—É–º–º—É > 0","bad");
          if(v>S.money) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
          S.money -= v; S.safe += v;
          addLog(`–ü–µ—Ä–µ–≤–æ–¥ üí∏ +${rub(v)} –≤ –∫–æ–ø–∏–ª–∫—É.`, "good");
          saveState(); render();
        };
      }
    }, 0);

    screenTemplate(
      `üè† –î–æ–º ‚Äî ${homeName}`,
      `–¢—É—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –µ–¥–∞, –∫–æ–ø–∏–ª–∫–∞. ${rentText}`,
      `–ö–∞–ø–∏—Ç–∞–ª: ${rub(nw)} ‚Ä¢ –ö—Ä–∏–ø—Ç–∞: ${rub(cryptoVal)} ‚Ä¢ % –ø–æ –¥–æ–ª–≥—É/–¥–µ–Ω—å: ${rub(debtInt)}`,
      actions
    );
    return;
  }

  if(currentTab === "work"){
    const actions = [];
    actions.push(actionCard({
      title:"üíº –ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞",
      text:"–ù–∞–¥—ë–∂–Ω–æ, –Ω–æ –Ω–µ –∂–∏—Ä–Ω–æ. –•–æ—Ä–æ—à–æ –¥–ª—è —Å—Ç–∞—Ä—Ç–∞.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è: -20 ‚Ä¢ –î–æ—Ö–æ–¥: 140√ó–ù–∞–≤—ã–∫ = ${rub(140*S.skill)}`,
      btnText:"–†–∞–±–æ—Ç–∞—Ç—å",
      onClick: ()=>{
        if(!useAction(20)) return;
        const inc = 140*S.skill;
        S.money += inc;
        addLog(`–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞: +${rub(inc)} ‚úÖ`, "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üßë‚Äçüíª –†–∞–±–æ—Ç–∞",
      text:"–°—Ç–∞–±–∏–ª—å–Ω–æ. –õ—É—á—à–µ –ø–æ–¥—Ä–∞–±–æ—Ç–∫–∏.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è: -30 ‚Ä¢ –î–æ—Ö–æ–¥: 260√ó–ù–∞–≤—ã–∫ = ${rub(260*S.skill)}`,
      btnText:"–†–∞–±–æ—Ç–∞—Ç—å",
      onClick: ()=>{
        if(!useAction(30)) return;
        const inc = 260*S.skill;
        S.money += inc;
        addLog(`–†–∞–±–æ—Ç–∞: +${rub(inc)} ‚úÖ`, "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üöÄ –ü—Ä–æ–µ–∫—Ç/—Ñ—Ä–∏–ª–∞–Ω—Å",
      text:"–†–∏—Å–∫: —à–∞–Ω—Å –ø—Ä–æ–≤–∞–ª–∞ 25%, –∑–∞—Ç–æ –¥–æ—Ö–æ–¥ –≤—ã—à–µ.",
      cost:`–≠–Ω–µ—Ä–≥–∏—è: -40 ‚Ä¢ –î–æ—Ö–æ–¥: 420√ó–ù–∞–≤—ã–∫ = ${rub(420*S.skill)}`,
      btnText:"–î–µ–ª–∞—Ç—å",
      onClick: ()=>{
        if(!useAction(40)) return;
        const fail = Math.random() < 0.25;
        if(fail){
          const loss = 120*S.skill;
          S.money = Math.max(0, S.money - loss);
          addLog(`–§—Ä–∏–ª–∞–Ω—Å —Å–æ—Ä–≤–∞–ª—Å—è üòµ -${rub(loss)}`, "bad");
        } else {
          const inc = 420*S.skill;
          S.money += inc;
          addLog(`–§—Ä–∏–ª–∞–Ω—Å: +${rub(inc)} ‚úÖ`, "good");
        }
        saveState(); render();
      }
    }));
    screenTemplate(
      "üíº –†–∞–±–æ—Ç–∞",
      "–î–µ–ª–∞–π –¥–µ–Ω—å–≥–∏. –ù–∞–≤—ã–∫ —É—Å–∏–ª–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥.",
      "–°–æ–≤–µ—Ç: —É—á–∏—Å—å üìë, —á—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ.",
      actions
    );
    return;
  }

  if(currentTab === "study"){
    const actions = [];
    actions.push(actionCard({
      title:"üìë –û–±—É—á–µ–Ω–∏–µ",
      text:"–ü–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞–≤—ã–∫. –≠—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç –¥–æ—Ö–æ–¥–∞ –∏ –±–∏–∑–Ω–µ—Å–∞.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è: -25 ‚Ä¢ –ù–∞–≤—ã–∫: +1",
      btnText:"–£—á–∏—Ç—å—Å—è",
      onClick: ()=>{
        if(!useAction(25)) return;
        S.skill += 1;
        addLog(`–£—á—ë–±–∞: –Ω–∞–≤—ã–∫ —Å—Ç–∞–ª ${S.skill} üß†`, "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üß† –ò–Ω—Ç–µ–Ω—Å–∏–≤",
      text:"–°–∏–ª—å–Ω–µ–µ –ø—Ä–æ–∫–∞—á–∫–∞, –Ω–æ –¥–æ—Ä–æ–∂–µ –ø–æ —ç–Ω–µ—Ä–≥–∏–∏.",
      cost:"–≠–Ω–µ—Ä–≥–∏—è: -45 ‚Ä¢ –ù–∞–≤—ã–∫: +2",
      btnText:"–í–æ–π—Ç–∏",
      onClick: ()=>{
        if(!useAction(45)) return;
        S.skill += 2;
        addLog(`–ò–Ω—Ç–µ–Ω—Å–∏–≤: –Ω–∞–≤—ã–∫ —Å—Ç–∞–ª ${S.skill} üî•`, "good");
        saveState(); render();
      }
    }));
    screenTemplate(
      "üìë –û–±—É—á–µ–Ω–∏–µ",
      "–ù–∞–≤—ã–∫ = –±–æ–ª—å—à–µ –¥–µ–Ω–µ–≥. –≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –±—É—Å—Ç.",
      "–°–æ–≤–µ—Ç: –∫–æ–º–±–∏–Ω–∏—Ä—É–π —É—á–µ–±—É + —Ä–∞–±–æ—Ç—É.",
      actions
    );
    return;
  }

  if(currentTab === "biz"){
    const actions = [];
    const price = 1200 * (S.biz + 1);
    actions.push(actionCard({
      title:"üöÄ –ó–∞–ø—É—Å–∫ / —É–ª—É—á—à–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞",
      text:"–ü–æ–¥–Ω–∏–º–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å –±–∏–∑–Ω–µ—Å–∞. –ü–∞—Å—Å–∏–≤ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.",
      cost:`–¶–µ–Ω–∞: ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: -30 ‚Ä¢ –ë–∏–∑–Ω–µ—Å: +1`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      onClick: ()=>{
        if(!useAction(30)) return;
        if(S.money < price){
          // –≤–µ—Ä–Ω—É—Ç—å —Ö–æ–¥ —á–µ—Å—Ç–Ω–æ
          S.actionsLeft += 1;
          S.energy = clamp(S.energy + 30, 0, 100);
          addLog(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥. –ù—É–∂–Ω–æ ${rub(price)}.`, "bad");
          saveState(); render();
          return;
        }
        S.money -= price;
        S.biz += 1;
        addLog(`–ë–∏–∑–Ω–µ—Å –≤—ã—Ä–æ—Å –¥–æ ${S.biz} ‚úÖ (-${rub(price)})`, "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üí∞ –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ (—Ç–æ–ø –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è)",
      text:"–ß–∏—Å—Ç–æ –∏–≥—Ä–æ–≤–∞—è —à—Ç—É–∫–∞ ‚Äî –ø–æ–ø–æ–ª–Ω—è–µ—Ç '–¢–æ–ø –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è'.",
      cost:"–ù–∞–ª–∏—á–Ω—ã–µ: -500 ‚ÇΩ ‚Ä¢ –ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è +500",
      btnText:"–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å",
      onClick: ()=>{
        if(S.money < 500){ addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 500 ‚ÇΩ","bad"); return; }
        if(S.actionsLeft<=0){ addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤.","bad"); return; }
        S.actionsLeft -= 1;
        S.money -= 500;
        S.donations += 500;
        addLog("–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–µ üí∞ +500 (–≤ —Ä–µ–π—Ç–∏–Ω–≥).", "good");
        saveState(); render();
      }
    }));
    screenTemplate(
      "üöÄ –ë–∏–∑–Ω–µ—Å",
      `–ü–∞—Å—Å–∏–≤ –≤ –Ω–µ–¥–µ–ª—é —Å–µ–π—á–∞—Å: ${rub(passiveIncome())}. –£—Ä–æ–≤–µ–Ω—å –±–∏–∑–Ω–µ—Å–∞: ${S.biz}.`,
      "–§–∏—à–∫–∞: –±–∏–∑–Ω–µ—Å —É–º–µ–Ω—å—à–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ä–∞–±–æ—Ç—ã.",
      actions
    );
    return;
  }

  if(currentTab === "bank"){
    const actions = [];

    actions.push(actionCard({
      title:"üè¶ –î–µ–ø–æ–∑–∏—Ç",
      text:"–ü–æ–ª–æ–∂–∏—Ç—å –Ω–∞–ª–∏—á–Ω—ã–µ –≤ –±–∞–Ω–∫. –ú–æ–∂–Ω–æ —Å–Ω—è—Ç—å –≤ –ª—é–±–æ–π –¥–µ–Ω—å.",
      cost:"–ù–∞–ª–∏—á–Ω—ã–µ ‚Üí –ë–∞–Ω–∫",
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      extraHTML: `
        <div class="row2">
          <input id="depAmt" type="number" placeholder="–°—É–º–º–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 1000)" />
          <button class="b-ghost" id="depDo">–ü–æ–ª–æ–∂–∏—Ç—å</button>
          <button class="b-ghost" id="wdDo">–°–Ω—è—Ç—å</button>
        </div>
        <div class="small" style="margin-top:8px">–°–Ω—è—Ç–∏–µ: –ë–∞–Ω–∫ ‚Üí –ù–∞–ª–∏—á–Ω—ã–µ</div>
      `,
      onClick: ()=>{}
    }));

    actions.push(actionCard({
      title:"üí≥ –ö—Ä–µ–¥–∏—Ç",
      text:"–ë–µ—Ä—ë—à—å –¥–µ–Ω—å–≥–∏ —Å—Ä–∞–∑—É, –Ω–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∫–∞–ø–∞—é—Ç –ø—Ä–æ—Ü–µ–Ω—Ç—ã (–∏–≥—Ä–æ–≤—ã–µ).",
      cost:"–ö—Ä–µ–¥–∏—Ç ‚Üí –î–æ–ª–≥ (–ø—Ä–æ—Ü–µ–Ω—Ç—ã/–¥–µ–Ω—å)",
      btnText:"–û—Ç–∫—Ä—ã—Ç—å",
      extraHTML: `
        <div class="row2">
          <input id="loanAmt" type="number" placeholder="–í–∑—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä 2000)" />
          <button class="b-ghost" id="loanDo">–í–∑—è—Ç—å</button>
        </div>
        <div style="height:8px"></div>
        <div class="row2">
          <input id="payAmt" type="number" placeholder="–ü–æ–≥–∞—Å–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä 500)" />
          <button class="b-ghost" id="payDo">–ü–æ–≥–∞—Å–∏—Ç—å</button>
        </div>
        <div class="small" style="margin-top:8px">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ –¥–æ–ª–≥—É/–¥–µ–Ω—å: ${rub(dailyDebtInterest())}</div>
      `,
      onClick: ()=>{}
    }));

    // bind bank
    setTimeout(()=>{
      const depDo = document.getElementById("depDo");
      const wdDo  = document.getElementById("wdDo");
      if(depDo){
        depDo.onclick = ()=>{
          const v = Number(document.getElementById("depAmt").value || 0);
          if(v<=0) return addLog("–í–≤–µ–¥–∏ —Å—É–º–º—É > 0","bad");
          if(v>S.money) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
          S.money -= v; S.bank += v;
          addLog(`–î–µ–ø–æ–∑–∏—Ç üè¶ +${rub(v)}`, "good");
          saveState(); render();
        };
      }
      if(wdDo){
        wdDo.onclick = ()=>{
          const v = Number(document.getElementById("depAmt").value || 0);
          if(v<=0) return addLog("–í–≤–µ–¥–∏ —Å—É–º–º—É > 0","bad");
          if(v>S.bank) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ –±–∞–Ω–∫–µ","bad");
          S.bank -= v; S.money += v;
          addLog(`–°–Ω—è—Ç–∏–µ üè¶ -${rub(v)} (–≤ –Ω–∞–ª–∏—á–Ω—ã–µ)`, "good");
          saveState(); render();
        };
      }

      const loanDo = document.getElementById("loanDo");
      const payDo = document.getElementById("payDo");
      if(loanDo){
        loanDo.onclick = ()=>{
          const v = Number(document.getElementById("loanAmt").value || 0);
          if(v<=0) return addLog("–í–≤–µ–¥–∏ —Å—É–º–º—É > 0","bad");
          if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
          S.actionsLeft -= 1;
          S.money += v;
          S.debt += Math.floor(v * 1.10); // 10% "–∫–æ–º–∏—Å—Å–∏—è" –≤ –¥–æ–ª–≥
          addLog(`–ö—Ä–µ–¥–∏—Ç üí≥ +${rub(v)} (–¥–æ–ª–≥ –≤—ã—Ä–æ—Å).`, "warn");
          saveState(); render();
        };
      }
      if(payDo){
        payDo.onclick = ()=>{
          const v = Number(document.getElementById("payAmt").value || 0);
          if(v<=0) return addLog("–í–≤–µ–¥–∏ —Å—É–º–º—É > 0","bad");
          if(v>S.money) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
          if(S.debt<=0) return addLog("–î–æ–ª–≥–æ–≤ –Ω–µ—Ç ‚úÖ","good");
          if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
          S.actionsLeft -= 1;
          S.money -= v;
          S.debt = Math.max(0, S.debt - v);
          addLog(`–ü–æ–≥–∞—à–µ–Ω–∏–µ üí≥ -${rub(v)}. –î–æ–ª–≥: ${rub(S.debt)}`, "good");
          saveState(); render();
        };
      }
    }, 0);

    screenTemplate(
      "üè¶ –ë–∞–Ω–∫",
      "–¢—É—Ç –¥–µ–ø–æ–∑–∏—Ç, —Å–Ω—è—Ç–∏–µ –∏ –∫—Ä–µ–¥–∏—Ç—ã. –ö—Ä–µ–¥–∏—Ç—ã –æ–ø–∞—Å–Ω—ã –∏–∑-–∑–∞ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.",
      `–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É —Å–µ–≥–æ–¥–Ω—è: ${rub(dailyDebtInterest())}`,
      actions
    );
    return;
  }

  if(currentTab === "shop"){
    const actions = [];
    actions.push(actionCard({
      title:"üçé –ï–¥–∞",
      text:"–ù—É–∂–Ω–∞ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –¥–æ–º–∞.",
      cost:"–¶–µ–Ω–∞: 150 ‚ÇΩ ‚Ä¢ +1 –µ–¥–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.money < 150) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 150 ‚ÇΩ","bad");
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        S.actionsLeft -= 1;
        S.money -= 150;
        S.inv.food += 1;
        addLog("–ö—É–ø–∏–ª –µ–¥—É üçé +1", "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üñ• –¢–µ—Ö–Ω–∏–∫–∞",
      text:"–¢–µ—Ö–Ω–∏–∫–∞ —Å–ª–µ–≥–∫–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (–ø—Ä–∏–±–∞–≤–∫–∞ –∫ –¥–æ—Ö–æ–¥—É/–ø–∞—Å—Å–∏–≤—É).",
      cost:"–¶–µ–Ω–∞: 2 500 ‚ÇΩ ‚Ä¢ +1 —Ç–µ—Ö–Ω–∏–∫–∞ ‚Ä¢ –±–æ–Ω—É—Å –∫ –¥–æ—Ö–æ–¥—É",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.money < 2500) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 2 500 ‚ÇΩ","bad");
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        S.actionsLeft -= 1;
        S.money -= 2500;
        S.inv.tech += 1;
        addLog("–ö—É–ø–∏–ª —Ç–µ—Ö–Ω–∏–∫—É üñ• +1", "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üõ° –≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ (–∏–≥—Ä–æ–≤–∞—è)",
      text:"–ß–∏—Å—Ç–æ –¥–ª—è —Å–∏–º—É–ª—è—Ç–æ—Ä–∞ ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è/–º–∏–Ω–∏-–∏–≤–µ–Ω—Ç—ã –ø–æ–∑–∂–µ.",
      cost:"–¶–µ–Ω–∞: 1 800 ‚ÇΩ ‚Ä¢ +1 —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.money < 1800) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 1 800 ‚ÇΩ","bad");
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        S.actionsLeft -= 1;
        S.money -= 1800;
        S.inv.gear += 1;
        addLog("–ö—É–ø–∏–ª —ç–∫–∏–ø–∏—Ä–æ–≤–∫—É üõ° +1", "good");
        saveState(); render();
      }
    }));

    screenTemplate(
      "üè¨ –ú–∞–≥–∞–∑–∏–Ω",
      "–ü–æ–∫—É–ø–∞–π –µ–¥—É/—Ç–µ—Ö–Ω–∏–∫—É/—ç–∫–∏–ø–∏—Ä–æ–≤–∫—É. –ï–¥–∞ ‚Äî –ª—É—á—à–∏–π —Å–ø–æ—Å–æ–± –¥–µ—Ä–∂–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é.",
      "–°–æ–≤–µ—Ç: —Ç–µ—Ö–Ω–∏–∫–∞ —É—Å–∫–æ—Ä—è–µ—Ç —Ä–æ—Å—Ç –∫–∞–ø–∏—Ç–∞–ª–∞.",
      actions
    );
    return;
  }

  if(currentTab === "cars"){
    const actions = [];
    actions.push(actionCard({
      title:"üöó –ú–∞—à–∏–Ω–∞ (–±–∞–∑–æ–≤–∞—è)",
      text:"–î–∞—ë—Ç –±–æ–Ω—É—Å –∫ –∑–∞—Ä–∞–±–æ—Ç–∫—É (–º–µ–Ω—å—à–µ —Ç—Ä–∞—Ç –≤—Ä–µ–º–µ–Ω–∏).",
      cost:"–¶–µ–Ω–∞: 12 000 ‚ÇΩ ‚Ä¢ +1 –∞–≤—Ç–æ ‚Ä¢ –±–æ–Ω—É—Å –¥–æ—Ö–æ–¥–∞",
      btnText:"–ö—É–ø–∏—Ç—å",
      onClick: ()=>{
        if(S.money < 12000) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 12 000 ‚ÇΩ","bad");
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        S.actionsLeft -= 1;
        S.money -= 12000;
        S.inv.car += 1;
        addLog("–ö—É–ø–∏–ª –º–∞—à–∏–Ω—É üöó +1", "good");
        saveState(); render();
      }
    }));
    screenTemplate(
      "üöò –ê–≤—Ç–æ—Å–∞–ª–æ–Ω",
      "–ê–≤—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –∫–∞–ø–∏—Ç–∞–ª (–≤ —Ä–∞–Ω–≥–µ —Ç–æ–∂–µ –≤–ª–∏—è–µ—Ç).",
      "–ü–æ–∫—É–ø–∫–∞ –∞–≤—Ç–æ ‚Äî –≤–∞–∂–Ω–∞—è —Ü–µ–ª—å üéØ",
      actions
    );
    return;
  }

  if(currentTab === "realty"){
    const actions = [];
    const nextLvl = Math.min(3, S.homeLevel + 1);
    const price = [0, 8000, 17000, 40000][nextLvl] || 0;
    const names = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"];
    actions.push(actionCard({
      title:"üè† –£–ª—É—á—à–∏—Ç—å –∂–∏–ª—å—ë",
      text:`–°–µ–π—á–∞—Å: ${names[S.homeLevel]}. –°–ª–µ–¥—É—é—â–µ–µ: ${names[nextLvl]}.`,
      cost:`–¶–µ–Ω–∞: ${rub(price)} ‚Ä¢ –≠–Ω–µ—Ä–≥–∏—è: -25 ‚Ä¢ –ñ–∏–ª—å—ë: +1`,
      btnText:"–£–ª—É—á—à–∏—Ç—å",
      onClick: ()=>{
        if(nextLvl === S.homeLevel) return addLog("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∂–∏–ª—å—è ‚úÖ","good");
        if(!useAction(25)) return;
        if(S.money < price){
          // –≤–µ—Ä–Ω—É—Ç—å —Ö–æ–¥ —á–µ—Å—Ç–Ω–æ
          S.actionsLeft += 1;
          S.energy = clamp(S.energy + 25, 0, 100);
          addLog(`–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥. –ù—É–∂–Ω–æ ${rub(price)}.`, "bad");
          saveState(); render();
          return;
        }
        S.money -= price;
        S.homeLevel = nextLvl;
        addLog(`–ñ–∏–ª—å—ë —É–ª—É—á—à–µ–Ω–æ: ${names[S.homeLevel]} üè†`, "good");
        saveState(); render();
      }
    }));
    actions.push(actionCard({
      title:"üßæ –û–ø–ª–∞—Ç–∏—Ç—å –∞—Ä–µ–Ω–¥—É/–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∑–∞—Ä–∞–Ω–µ–µ",
      text:"–ï—Å–ª–∏ –Ω–µ –æ–ø–ª–∞—Ç–∏—Ç—å –≤–æ–≤—Ä–µ–º—è ‚Äî —à—Ç—Ä–∞—Ñ –∏ —Å—Ç—Ä–µ—Å—Å.",
      cost:"–¶–µ–Ω–∞: 700 ‚ÇΩ ‚Ä¢ –°–¥–≤–∏–≥ –æ–ø–ª–∞—Ç—ã +7 –¥–Ω–µ–π",
      btnText:"–û–ø–ª–∞—Ç–∏—Ç—å",
      onClick: ()=>{
        if(S.money < 700) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 700 ‚ÇΩ","bad");
        if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
        S.actionsLeft -= 1;
        S.money -= 700;
        S.rentDueIn = Math.min(14, S.rentDueIn + 7);
        addLog("–û–ø–ª–∞—Ç–∏–ª –∂–∏–ª—å—ë üßæ (–ø–ª—é—Å –¥–Ω–µ–π –¥–æ –æ–ø–ª–∞—Ç—ã).", "good");
        saveState(); render();
      }
    }));
    screenTemplate(
      "üè¢ –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å",
      "–ñ–∏–ª—å—ë –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å—Ö–æ–¥—ã –≤ –Ω–µ–¥–µ–ª—é, –Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞–ø–∏—Ç–∞–ª –∏ –∫–æ–º—Ñ–æ—Ä—Ç.",
      "–ë–∞–ª–∞–Ω—Å: —É–ª—É—á—à–∞–π –∂–∏–ª—å—ë, –Ω–æ —Å–ª–µ–¥–∏ –∑–∞ —Ä–∞—Å—Ö–æ–¥–∞–º–∏.",
      actions
    );
    return;
  }

  if(currentTab === "crypto"){
    const actions = [];
    const price = S.cryptoPrice;
    const ownedVal = Math.floor(S.cryptoCash * price);
    actions.push(actionCard({
      title:"üñ•üí∂ –†—ã–Ω–æ–∫ –∫—Ä–∏–ø—Ç—ã",
      text:`–¶–µ–Ω–∞ —Å–µ–π—á–∞—Å: ${rub(price)} –∑–∞ 1 –º–æ–Ω–µ—Ç—É. –£ —Ç–µ–±—è: ${S.cryptoCash} –º–æ–Ω–µ—Ç (‚âà ${rub(ownedVal)}).`,
      cost:"–ü–æ–∫—É–ø–∫–∞/–ø—Ä–æ–¥–∞–∂–∞ –∑–∞ –Ω–∞–ª–∏—á–Ω—ã–µ",
      btnText:"–û–∫",
      extraHTML: `
        <div class="row2">
          <input id="cAmt" type="number" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä 3)" />
          <button class="b-ghost" id="cBuy">–ö—É–ø–∏—Ç—å</button>
          <button class="b-ghost" id="cSell">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
      `,
      onClick: ()=>{}
    }));

    setTimeout(()=>{
      const buy = document.getElementById("cBuy");
      const sell = document.getElementById("cSell");
      if(buy){
        buy.onclick = ()=>{
          const q = Number(document.getElementById("cAmt").value||0);
          if(q<=0) return addLog("–í–≤–µ–¥–∏ –∫–æ–ª-–≤–æ > 0","bad");
          if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
          const cost = q * S.cryptoPrice;
          if(cost > S.money) return addLog("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –Ω–∞–ª–∏—á–Ω—ã—Ö","bad");
          S.actionsLeft -= 1;
          S.money -= cost;
          S.cryptoCash += q;
          addLog(`–ö—É–ø–∏–ª –∫—Ä–∏–ø—Ç—É üñ•üí∂ +${q} (-${rub(cost)})`, "good");
          saveState(); render();
        };
      }
      if(sell){
        sell.onclick = ()=>{
          const q = Number(document.getElementById("cAmt").value||0);
          if(q<=0) return addLog("–í–≤–µ–¥–∏ –∫–æ–ª-–≤–æ > 0","bad");
          if(S.actionsLeft<=0) return addLog("–ù–µ—Ç —Ö–æ–¥–æ–≤","bad");
          if(q > S.cryptoCash) return addLog("–£ —Ç–µ–±—è –Ω–µ—Ç —Å—Ç–æ–ª—å–∫–æ –º–æ–Ω–µ—Ç","bad");
          const gain = q * S.cryptoPrice;
          S.actionsLeft -= 1;
          S.cryptoCash -= q;
          S.money += gain;
          addLog(`–ü—Ä–æ–¥–∞–ª –∫—Ä–∏–ø—Ç—É üñ•üí∂ -${q} (+${rub(gain)})`, "good");
          saveState(); render();
        };
      }
    }, 0);

    screenTemplate(
      "üñ•üí∂ –ö—Ä–∏–ø—Ç–∞",
      "–¶–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. –ú–æ–∂–Ω–æ –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å, —Ç–∞–∫ –∏ —Å–ª–∏—Ç—å—Å—è üòÖ",
      "–°–æ–≤–µ—Ç: –Ω–µ –≤–ª–µ–∑–∞–π –≤ –¥–æ–ª–≥ —Ä–∞–¥–∏ –∫—Ä–∏–ø—Ç—ã.",
      actions
    );
    return;
  }

  if(currentTab === "tops"){
    const actions = [];

    const cryptoValue = Math.floor(S.cryptoCash * S.cryptoPrice);
    // –æ–±–Ω–æ–≤–∏–º —Ä–µ–∫–æ—Ä–¥—ã
    S.tops.bestNetWorth = Math.max(S.tops.bestNetWorth, netWorth());
    S.tops.bestDonations = Math.max(S.tops.bestDonations, S.donations);
    S.tops.bestCryptoValue = Math.max(S.tops.bestCryptoValue, cryptoValue);

    actions.push(actionCard({
      title:"Forbes üòéüíµ",
      text:"–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–æ–ø—ã (–≤ —Ç–≤–æ—ë–º –±—Ä–∞—É–∑–µ—Ä–µ). –≠—Ç–æ –∫–∞–∫ —Ä–µ–∫–æ—Ä–¥—ã –∞–∫–∫–∞—É–Ω—Ç–∞.",
      cost:"‚Äî",
      btnText:"–ü–æ–∫–∞–∑–∞—Ç—å",
      onClick: ()=>{},
      extraHTML: `
        <ul class="list" style="margin-top:10px">
          <li><div><b>–¢–æ–ø –±–∞–ª–∞–Ω—Å üí≥</b><div class="small">–†–µ–∫–æ—Ä–¥ –∫–∞–ø–∏—Ç–∞–ª–∞</div></div><span class="badge">${rub(S.tops.bestNetWorth)}</span></li>
          <li><div><b>–¢–æ–ø –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è üí∞</b><div class="small">–°–∫–æ–ª—å–∫–æ –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–ª –≤—Å–µ–≥–æ</div></div><span class="badge">${rub(S.tops.bestDonations)}</span></li>
          <li><div><b>–¢–æ–ø –∫—Ä–∏–ø—Ç–∞ üñ•üí∂</b><div class="small">–õ—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç—ã</div></div><span class="badge">${rub(S.tops.bestCryptoValue)}</span></li>
        </ul>
      `
    }));

    screenTemplate(
      "Forbes üòéüíµ",
      "–¢—É—Ç —Ä–µ–∫–æ—Ä–¥—ã: –∫–∞–ø–∏—Ç–∞–ª, –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏—è, –∫—Ä–∏–ø—Ç–∞. –ú–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω–æ –ø–æ–∑–∂–µ (—á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä).",
      "–ü–æ–∫–∞ —ç—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã ‚Äî –∑–∞—Ç–æ –±–µ—Å–ø–ª–∞—Ç–Ω–æ ‚úÖ",
      actions
    );
    saveState();
    return;
  }

  // fallback
  screenTemplate("‚Äî", "‚Äî", "‚Äî", []);
}

/* ---------- achievements UI ---------- */
function renderAchievements(){
  const ul = $("achievements");
  ul.innerHTML = "";
  let done = 0;

  ACH.forEach(a=>{
    const ok = a.ok();
    if(ok) done++;
    const li = document.createElement("li");
    li.innerHTML = `
      <div>
        <b>${a.name} ${ok ? '<span class="good">‚úì</span>' : ''}</b>
        <div class="small">${a.desc}</div>
      </div>
      <span class="badge">${ok ? "–û—Ç–∫—Ä—ã—Ç–æ" : "–ó–∞–∫—Ä—ã—Ç–æ"}</span>
    `;
    ul.appendChild(li);
  });

  $("achvBadge").textContent = `${done}/${ACH.length}`;
}

/* ---------- inventory UI ---------- */
function renderInventory(){
  const ul = $("inventoryList");
  ul.innerHTML = "";
  const items = [
    {k:"food", name:"–ï–¥–∞ üçé", v:S.inv.food},
    {k:"tech", name:"–¢–µ—Ö–Ω–∏–∫–∞ üñ•", v:S.inv.tech},
    {k:"car",  name:"–ú–∞—à–∏–Ω–∞ üöó", v:S.inv.car},
    {k:"gear", name:"–≠–∫–∏–ø–∏—Ä–æ–≤–∫–∞ üõ°", v:S.inv.gear},
  ];
  items.forEach(x=>{
    const li = document.createElement("li");
    li.innerHTML = `<div><b>${x.name}</b><div class="small">–ö–æ–ª-–≤–æ</div></div><span class="badge">${x.v}</span>`;
    ul.appendChild(li);
  });
  $("invBadge").textContent = `–ö–æ–ø–∏–ª–∫–∞: ${rub(S.safe)} ‚Ä¢ –ö—Ä–∏–ø—Ç–∞: ${S.cryptoCash} ü™ô`;
}

/* ---------- main render ---------- */
function render(){
  ensureNonNegative();

  // bonuses from items (–ø—Ä–æ—Å—Ç—ã–µ, —á—Ç–æ–±—ã –∏–≥—Ä–∞–ª–∞—Å—å)
  // —Ç–µ—Ö–Ω–∏–∫–∞ –¥–∞—ë—Ç +3% –∫ –¥–æ—Ö–æ–¥–∞–º/–ø–∞—Å—Å–∏–≤—É –∑–∞ —à—Ç—É–∫—É (–∫–∞–ø 30%)
  const techBonus = Math.min(0.30, S.inv.tech * 0.03);
  // –∞–≤—Ç–æ –¥–∞—ë—Ç +5% –∫ –¥–æ—Ö–æ–¥—É (–∫–∞–ø 25%)
  const carBonus = Math.min(0.25, S.inv.car * 0.05);

  // –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É —ç–∫–æ–Ω–æ–º–∏–∫–∏ –Ω–µ–¥–µ–ª–∏
  const wkCost = weeklyCosts();
  const pass = passiveIncome();
  $("weekEconomy").textContent = `–†–∞—Å—Ö–æ–¥/–Ω–µ–¥: ${rub(wkCost)} ‚Ä¢ –ü–∞—Å—Å–∏–≤/–Ω–µ–¥: ${rub(pass)}`;

  // –ø—Ä–∏–º–µ–Ω–∏–º –±–æ–Ω—É—Å—ã –∫ —ç–∫—Ä–∞–Ω–∞–º —Ä–∞–±–æ—Ç—ã/–ø–∞—Å—Å–∏–≤—É (–ø—Ä–æ—Å—Ç–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏–∏ –±—É–¥–µ–º —É—á–∏—Ç—ã–≤–∞—Ç—å –≤ nextDay –∏ work)
  // –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –±–æ–Ω—É—Å—ã —É—á—Ç—ë–º —Ç–∞–∫:
  // - –±–æ–Ω—É—Å –æ—Ç —Ç–µ—Ö–Ω–∏–∫–∏/–∞–≤—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –∫ –Ω–∞–ª–∏—á–Ω—ã–º –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —á–µ—Ä–µ–∑ –º–Ω–æ–∂–∏—Ç–µ–ª—å
  // –î–ª—è —ç—Ç–æ–≥–æ: –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ? –ù–µ –Ω–∞–¥–æ. –°–¥–µ–ª–∞–µ–º –≤ nextDay –∏ –≤ action handlers:
  // (—É–ø—Ä–æ—Å—Ç–∏–º) ‚Äî –±–æ–Ω—É—Å—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤ endOfDay –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è—Ö, –∞ —Ä–∞–±–æ—Ç–∞ —É–∂–µ –Ω–æ—Ä–º.
  // –ß—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å: –±–æ–Ω—É—Å—ã —É—á—Ç—ë–º –≤ –∫–æ–Ω—Ü–µ –¥–Ω—è –∫–∞–∫ "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å".
  // (–î–∞, —ç—Ç–æ —á—É—Ç—å —É—Å–ª–æ–≤–Ω–æ, –∑–∞—Ç–æ –ø—Ä–æ—Å—Ç–æ.)

  $("money").textContent = rub(S.money);
  $("bank").textContent = rub(S.bank);
  $("debt").textContent = rub(S.debt);
  $("energy").textContent = String(S.energy);
  $("skill").textContent = String(S.skill);
  $("biz").textContent = String(S.biz);

  $("dayPill").textContent = `–î–µ–Ω—å ${S.day}`;
  $("weekPill").textContent = `–ù–µ–¥–µ–ª—è ${week()}`;
  $("rankPill").textContent = `–†–∞–Ω–≥: ${rankName()}`;
  $("actionsLeft").textContent = `–•–æ–¥–æ–≤: ${S.actionsLeft}/3`;
  $("netWorth").textContent = `–ö–∞–ø–∏—Ç–∞–ª: ${rub(netWorth())}`;

  const ePct = Math.round((S.energy/100)*100);
  $("energyBar").style.width = ePct + "%";

  // home small label
  const homeName = ["–ê—Ä–µ–Ω–¥–∞","–ö–æ–º–Ω–∞—Ç–∞","–ö–≤–∞—Ä—Ç–∏—Ä–∞","–î–æ–º"][S.homeLevel] || "–ê—Ä–µ–Ω–¥–∞";
  $("homeSmall").textContent = homeName;

  // log
  const ul = $("log");
  ul.innerHTML = "";
  S.log.forEach(x=>{
    const li = document.createElement("li");
    li.innerHTML = x.type==="good" ? `‚úÖ <span class="good">${escapeHtml(x.t)}</span>`
              : x.type==="bad"  ? `‚ö†Ô∏è <span class="bad">${escapeHtml(x.t)}</span>`
              : x.type==="warn" ? `üí≥ <span class="warn">${escapeHtml(x.t)}</span>`
              : `‚Ä¢ ${escapeHtml(x.t)}`;
    ul.appendChild(li);
  });

  renderInventory();
  renderAchievements();
  renderScreen();
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;").replaceAll("<","&lt;")
    .replaceAll(">","&gt;").replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ---------- next day (core tick) ---------- */
function nextDay(){
  // –∫–æ–Ω–µ—Ü –¥–Ω—è: –ø—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É
  const int = dailyDebtInterest();
  if(int>0){
    S.debt += int;
    addLog(`–ü—Ä–æ—Ü–µ–Ω—Ç—ã –ø–æ –¥–æ–ª–≥—É: +${rub(int)} (–∏—Ç–æ–≥–æ –¥–æ–ª–≥ ${rub(S.debt)})`, "warn");
  }

  // —Ü–µ–Ω–∞ –∫—Ä–∏–ø—Ç—ã –º–µ–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
  const prev = S.cryptoPrice;
  nextCryptoPrice();
  if(S.cryptoPrice > prev) addLog(`–ö—Ä–∏–ø—Ç–∞ –≤—ã—Ä–æ—Å–ª–∞ üìà ${rub(prev)} ‚Üí ${rub(S.cryptoPrice)}`, "good");
  if(S.cryptoPrice < prev) addLog(`–ö—Ä–∏–ø—Ç–∞ —É–ø–∞–ª–∞ üìâ ${rub(prev)} ‚Üí ${rub(S.cryptoPrice)}`, "bad");

  // –¥–≤–∏–∂–µ–Ω–∏–µ –∞—Ä–µ–Ω–¥—ã
  S.rentDueIn -= 1;

  // –Ω–æ—á—å: –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
  S.day += 1;
  S.actionsLeft = 3;
  S.energy = clamp(S.energy + 25, 0, 100);

  addLog(`–ù–æ–≤—ã–π –¥–µ–Ω—å: ${S.day}. –≠–Ω–µ—Ä–≥–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å.`, "info");

  // –µ—Å–ª–∏ –ø—Ä–æ—Å—Ä–æ—á–∏–ª –∂–∏–ª—å—ë
  if(S.rentDueIn <= 0){
    const fine = 900 + S.homeLevel*250;
    S.money = Math.max(0, S.money - fine);
    S.rentDueIn = 7;
    addLog(`–ü—Ä–æ—Å—Ä–æ—á–∫–∞ –∂–∏–ª—å—è üßæ –®—Ç—Ä–∞—Ñ -${rub(fine)}.`, "bad");
  }

  // –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é: —Ä–∞—Å—Ö–æ–¥—ã + –ø–∞—Å—Å–∏–≤
  if((S.day-1) % 7 === 0){
    const cost = weeklyCosts();
    const pass = passiveIncome();

    // –±–æ–Ω—É—Å—ã (–ø—Ä–æ—Å—Ç–æ –∏ –ø—Ä–∏—è—Ç–Ω–æ)
    const techBonus = Math.min(0.30, S.inv.tech * 0.03);
    const carBonus  = Math.min(0.25, S.inv.car * 0.05);
    const eff = 1 + techBonus + carBonus;
    const passEff = Math.floor(pass * eff);

    S.money = Math.max(0, S.money - cost + passEff);

    addLog(`–ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏: —Ä–∞—Å—Ö–æ–¥—ã -${rub(cost)}.`, cost ? "bad":"info");
    if(passEff>0) addLog(`–ü–∞—Å—Å–∏–≤ –±–∏–∑–Ω–µ—Å–∞: +${rub(passEff)} ‚úÖ`, "good");

    // –æ–±–Ω–æ–≤–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ—Ä–¥—ã
    const cryptoValue = Math.floor(S.cryptoCash * S.cryptoPrice);
    S.tops.bestNetWorth = Math.max(S.tops.bestNetWorth, netWorth());
    S.tops.bestDonations = Math.max(S.tops.bestDonations, S.donations);
    S.tops.bestCryptoValue = Math.max(S.tops.bestCryptoValue, cryptoValue);
  }

  saveState();
  render();
}

/* ---------- tab binds ---------- */
$("tabs").addEventListener("click", (e)=>{
  const btn = e.target.closest("[data-tab]");
  if(!btn) return;
  setTab(btn.getAttribute("data-tab"));
});

/* ---------- global buttons ---------- */
$("nextDayBtn").onclick = nextDay;
$("resetBtn").onclick = ()=>{
  if(!confirm("–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?")) return;
  localStorage.removeItem(KEY);
  S = defaultState();
  saveState();
  render();
};

/* ---------- init ---------- */
render();
</script>
</body>
</html>
